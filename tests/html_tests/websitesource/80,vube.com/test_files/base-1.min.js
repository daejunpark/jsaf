/* 2013-07-03 */
function validate_email(a){var b=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);return b.test(a)}function urlencode(a){return encodeURIComponent(a).replace(/%20/g,"+").replace(/~/g,"%7E")}function getUrlVars(){for(var a,b=[],c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++)a=c[d].split("="),b.push(a[0]),b[a[0]]=a[1];return b}function nl2br(a,b){var c=b||"undefined"==typeof b?"<br />":"<br>";return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+c+"$2")}function br2nl(a){return a.replace(/<br\s*\/?>/g,"\r")}function strip_tags(a){var b=document.createElement("DIV");return b.innerHTML=a,b.textContent||b.innerText}function htmlspecialchars_decode(a,b){var c=0,d=0,e=!1;"undefined"==typeof b&&(b=2),a=a.toString().replace(/&lt;/g,"<").replace(/&gt;/g,">");var f={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(0===b&&(e=!0),"number"!=typeof b){for(b=[].concat(b),d=0;d<b.length;d++)0===f[b[d]]?e=!0:f[b[d]]&&(c|=f[b[d]]);b=c}return b&f.ENT_HTML_QUOTE_SINGLE&&(a=a.replace(/&#0*39;/g,"'")),e||(a=a.replace(/&quot;/g,'"')),a=a.replace(/&amp;/g,"&")}function show_user_login(a,b){return"undefined"!=typeof logged_in&&logged_in?(b(),void 0):(logged_in=!1,loginbox=document.getElementById("loginbox"),div=document.getElementById("modal-login-message"),a?($(div).text(a),div.style.display=""):div.style.display="none",ajax_login_callback=b,$("#loginbox").modal({show:!0}),$form=$("#login-form"),$form.replaceWith($form.html()),$("#FormUserLogin_email_address").focus(),$(".form input").keypress(function(a){($("#FormUserLogin_email_address").is(":focus")||$("#FormUserLogin_password").is(":focus"))&&($("#loginSubmitBtn").is(":disabled")?13!=a.which&&$("#loginSubmitBtn").removeAttr("disabled"):13==a.which&&($(this).blur(),$("#loginSubmitBtn").focus().click()))}),!1)}function login_user(){document.getElementById("FormUserLogin_email_address").validator.is_valid(function(a){a._is_valid&&(document.getElementById("loginSubmitBtn").setAttribute("disabled","disabled"),$.ajax({type:"POST",data:"FormUserLogin[email_address]="+encodeURIComponent($("#FormUserLogin_email_address").val())+"&FormUserLogin[password]="+encodeURIComponent($("#FormUserLogin_password").val())+"&FormUserLogin[rememberMe]="+($("#FormUserLogin_rememberMe").is(":checked")?"1":"0")+"&ajax=1",dataType:"JSON",error:function(){var a="Internal Login Error";errorelem=document.getElementById("FormUserLogin_error"),errorelem.innerHtml=a,errorelem.style.display=""},success:function(a){if(parseInt(a.bad_login)){var b="Bad credentials";return errorelem=document.getElementById("FormUserLogin_error"),errorelem.innerHTML=b,errorelem.style.display="",!1}$("#loginbox").modal("hide"),e=document.getElementById("nav-sign-in"),eparent=e.parentNode,eparent.removeChild(e),eparent.innerHTML=a.html+eparent.innerHTML,logged_in=!0,user.is_verified=a.is_verified,user.id=a.id,Math.round((new Date).getTime()/1e3);var c="?t=s&u="+a.user_URL_id;$("#channel_page_h1").append('<span class="little_butt">'+a.t_Edit+"</span>"),$("#modal-share-link").val(window.location.hostname+location.pathname+c);var d=new Date;d.setTime(d.getTime()+1728e5),"; expires="+d.toGMTString(),$.cookie("u",a.user_URL_id,{path:"/",expires:2e6}),$.cookie("t","s",{path:"/",expires:2});var f=window.location.href,g=c.replace(/\?/g,"\\?"),h=f.match(new RegExp(g));h||window.location.replace(location.pathname+c),$("#URL_id")[0]&&($.ajax({type:"GET",dataType:"json",async:!1,url:"/api/video/"+$("#URL_id").val()+"/vote/mine",success:function(a){null!==a.like&&(a.like===!0?$("#like").addClass("voted"):a.like===!1&&$("#hate").addClass("voted"))}}),$.ajax({type:"GET",url:"/api/channel/"+$("#channel_id").val()+"/user/"+user.id,async:!1,success:function(){btn=$("#btn_subscribe"),btn.text(btn.data("lang-subscribed"))}})),"function"==typeof ajax_login_callback?ajax_login_callback(user.is_verified):void 0}}))})}function on_change_language(a){newlang=a.value,vform=document.createElement("form"),nlang=document.createElement("input"),nlang.name="lang",nlang.value=newlang,vform.appendChild(nlang),vform.method="POST",vform.style.display="none",document.getElementsByTagName("body")[0].appendChild(vform),vform.submit()}function add_message(a,b){document.getElementById("messagebox").innerHTML+='<div class="alert alert-'+a+'">'+'<button class="close" data-dismiss="alert">x</button>'+b+"</div>"}function attempt_upload(){user.is_verified?window.location="/video/upload":add_message("error","Sorry, you must verify your account by email before uploading a video")}function Validator(a){this.inputs=new Array,this.errors=new Array,this.rules=new Array,this.updated=new Array,this._is_valid=!1;for(i in a)if(a[i][0]){if(field=document.getElementById(a[i][0]),error=null!=field?document.getElementById(field.getAttribute("data-error-field")):null,reason=a[i][1],args=a[i][2],!field)throw Error("Couldn't create Validator for '"+a[i][0]+"' couldn't be found.");field.id in this.rules||(this.rules[field.id]=new Array),field.validator=this,dovalidate=function(){this.validator.hasupdate(this)},field.onblur=dovalidate,this.inputs[field.id]=field,this.errors[field.id]=error,this.rules[field.id].push([reason,args])}}var imageLoadError=function(a){var b=$(a),c=b.parent();b.remove(),$("<div>").css({height:128,background:"#333"}).appendTo(c)},allVars=getUrlVars(),ajax_login_callback=null;loginbox=null,$(function(){$("#loginbox").on("shown",function(){}),$("#search").on("keydown",function(a){13==a.which&&(a.preventDefault(),$(this).parent().submit(),$(this).blur())}),$("#edit_channel_description").on({mouseover:function(){$(this).css("cursor","pointer")},click:function(){oldDescription=document.getElementById("description").innerText,desc=document.getElementById("description"),newdesc=document.createElement("input"),newdesc.id="new_channel_description",newdesc.type="text",newdesc.setAttribute("value",oldDescription),desc.innerHTML="",desc.appendChild(newdesc),$("#edit_channel_description").html('<span id="save">Save</span> <span id="cancel">Cancel</span>'),$("#edit_channel_description #save").on({click:function(a){a.stopPropagation();var b=$("#new_channel_description").val();$("#channel_id").val(),$.ajax({type:"POST",url:"/channel/editDescription",data:"new_channel_description="+b+"&channel_id="+$("#channel_id").val(),success:function(a){0==a||(a=$.parseJSON(a),$("#description").text(b),$("#edit_channel_description").html("Edit"))}})}}),$("#edit_channel_description #cancel").on({click:function(a){a.stopPropagation(),$("#description").html(oldDescription),$("#edit_channel_description").html("Edit")}})}}),$(".banner-close-button").click(function(){$(this).parents(".banner-message").slideUp(function(){$(this).remove()})})});var applyPolyfills=function(a){Modernizr.input.placeholder||(a?$("[placeholder]",a).placeholder():$("[placeholder]").placeholder())};if($(function(){applyPolyfills()}),"object"!=typeof vube)var vube={};vube.api=function(a){var b=this;if(this.config=a,!this.config.initialQuery&&this.config.dom.sortTriggers)return this.bindTriggers(this.config.dom.sortTriggers),void 0;if(this.url=this.config.url.api,this.ajaxBusy=!1,this.xhrRef=!1,this.threshold=50,this.queryVars={limit:this.config.initialQuery.limit?this.config.initialQuery.limit:12,offset:this.config.initialQuery.offset?this.config.initialQuery.offset:0,sort:{property:this.config.initialQuery.sortBy?this.config.initialQuery.sortBy:"id",direction:this.config.initialQuery.descending?"DESC":"ASC"}},this.config.initialQuery.noSort&&delete this.queryVars.sort,this.nextRequest=!1,this.stopTrying=!1,this.container=this.config.dom.resultsContainer,this.countContainer=this.config.dom.countContainer,this.container.appendCount=0,this.itemsPerRow=this.config.dom.resultsPerRow?this.config.dom.resultsPerRow:3,this.videoContainerClass=this.config.dom.videoContainerClass?this.config.dom.videoContainerClass:"video-container",this.contTitle=$(".vube-header h2"),this.searchForm=this.config.dom.searchForm?this.config.dom.searchForm:!1,this.trigger=this.config.dom.trigger?this.config.dom.trigger:!1,this.config.dom.sortTriggers&&this.bindTriggers(this.config.dom.sortTriggers),this.imageQueue=[],!this.trigger)return this.monitor(),this.loadLabel=$("<h3>").append('<span class="loading"></span><span>'+this.config.locale.LOADING_MORE+"</span>"),this.loadLabel.prependTo(this.container),this.next(!1,!0),void 0;var c=$("<span>").text(this.config.locale.LOADING_MORE),d=$('<span class="loading">');if(this.trigger.append(d,c),this.updateText=function(a,b){b?d.css("display","inline"):d.css("display","none"),c.text(a)},this.loadWhenReached=this.config.dom.trigger,this.autoLoads=1,this.trigger.length>0&&this.trigger.on("click",function(a){a.preventDefault(),b.next(!0)}),this.searchForm.length>0&&this.searchForm.on("submit",function(a){var c=$('input[type="search"]',$(this)).val();a.preventDefault(),""!==c&&b.search(c)}),this.monitor(),this.config.query)this.search(this.config.query);else if(this.config.ignoreState)this.next();else{var e=$('[data-tab="'+this.cookieMonster().getCookie("tab")+'"]');e.length>0?e.trigger("click"):this.next()}},vube.api.prototype.bindTriggers=function(a){var b=this,c=this,d=function(a){b.reset(),b.queryVars.sort.property=a,b.next()};$.each(a,function(a,b){b.element.on("click",function(a){if(c.cookieMonster().setCookie("tab",$(this).data("tab")),a.preventDefault(),b.click)b.click($(this),c);else{var e=$(this);e.closest(".vube-header").find("h2.auto").text(e.text()),e.closest("ul").find("li.active").removeClass("active"),e.parent().addClass("active"),d(b.sortProperty)}})})},vube.api.prototype.cookieMonster=function(){var a=function(){for(var a=document.cookie.split("; "),b=[],c=0,d=a.length;d>c;c++){var e=a[c].split("="),f=e.splice(0,1)[0],g=e.join();b[f]=g}return b};return{setCookie:function(b,c,d){var e=new Date,c=escape(c);return c+=d?"; expires="+e.setDate(e.getDate()+d).toUTCString():"",c+="; path=/",document.cookie=b+"="+c,a()},getCookie:function(b){var c=a();return b in c?c[b]:!1}}},vube.api.prototype.search=function(a){this.ajaxBusy||(this.reset(),this.queryVars.q=a,this.contTitle.text("Results For "+a),$(".vube-header li.active").removeClass("active"),this.loadLabel=$("<h3>").append('<span class="loading"></span><span>'+this.config.locale.LOADING_MORE+"</span>"),this.loadLabel.prependTo(this.container),this.backToTop(),this.next())},vube.api.prototype.backToTop=function(){$("body","html").animate({scrollTop:0},1e3,"swing")},vube.api.prototype.reset=function(){this.queryVars={limit:this.config.initialQuery.limit?this.config.initialQuery.limit:12,offset:0,sort:{property:"id",direction:"DESC"}},this.nextRequest=!1,this.stopTrying=!1,this.autoLoads=1,this.monitor.pause=!1,this.imageQueue=[],this.container.appendCount=0,"object"==typeof popularResults&&popularResults.container.parent().remove(),$(".vid-row",this.container).remove()},vube.api.prototype.monitor=function(){var a,b=this;this.stopTrying||(this.monitored?!this.monitored.pause&&this.trigger&&(this.monitor.offset=Math.floor(100*(this.monitored.doc.scrollTop/(this.monitored.doc.scrollHeight-this.monitored.doc.clientHeight))),this.whereYOUAtDawg()):(this.monitored={pause:!1,win:window,doc:document.body},a=this.trigger?function(a){b.monitor(a),b.handleQueue()}:function(){b.handleQueue()},$(window).on("scroll",a)))},vube.api.prototype.whereYOUAtDawg=function(){if(this.loadWhenReached.length>0){var a;a=this.monitored.doc.scrollTop?this.monitored.doc.scrollTop:$("body, html").scrollTop();var b=this.loadWhenReached[0],c=this.monitored.win.innerHeight+a>=b.offsetTop+b.offsetHeight*(this.threshold/100);c&&this.next()}else this.monitor.offset>this.threshold&&this.next()},vube.api.prototype.handleQueue=function(a){if(!this.handleQueue.busy||a)if(this.imageQueue.length>0){var b,c;if(this.monitored.doc.scrollTop)b=this.monitored.doc.scrollTop;else try{b=$("body, html").scrollTop()}catch(d){b=$(document).scrollTop()}c=this.monitored.win.innerHeight?this.monitored.win.innerHeight:$(this.monitored.win).height();var e=this.imageQueue[0].element[0],f=c+b>=e.offsetTop;if(f){this.handleQueue.busy=!0;var g=this.imageQueue.splice(0,1)[0];return g.img.onerror=g.error,g.img.onload=g.load,g.src?g.img.src=g.src:g.error.call(g.img),this.handleQueue(!0)}this.handleQueue.busy=!1}else this.handleQueue.busy=!1},vube.api.prototype.formatNumber=function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},vube.api.prototype.appendVideo=function(a,b,c,d){if(this.config.specificTemplate)var e=this.config.specificTemplate(b,a,c,d);else{var f=this.config.url.base+urlencode(a._links.channel.title)+"/",g=f+a.URL_id,h=this.formatTimestamp(a.duration),e=$('<div class="'+this.videoContainerClass+'"></div>'),i=$('<div class="video-placeholder"></div>'),j=$('<a href="'+g+'"  class="video-play"></a>'),k=$('<a href="'+g+'"  class="vid-play"></a>'),l=$('<a href="'+g+'"  class="vid-duration"></a>'),m=$("<img>"),n=$('<div class="video-detail"></div>'),o=$('<div class="video-stats"></div>'),p=$('<div class="vid-views"></div>'),q=$('<div class="vid-likes"></div>'),r=$('<a class="title" href="'+g+'"></a>').text(a.title),s=$('<a class="upped-by" href="'+f+'"></a>').text("by "+a._links.channel.title),t=$('<div class="upped-ago"></div>').text(a.upload_time),u=a.approval_status?$("<div>").text(a.approval_status):!1,v=a.transcoding_status?$("<div>").text(a.transcoding_status):!1;i.append(m),o.append(q.text(this.formatNumber(a.rlike||0)),p.text(this.formatNumber(a.rview||0))),n.append(r,u?u:s,v,t),this.imageQueue.push({load:function(){i.addClass("loaded")},error:function(){i.addClass("loaded error"),$(this).remove()},img:m[0],src:a.thumbnail_src,element:e}),e.append(i.append(j,o,k,h?l.text(h):!1),n),b.append(e)}return this.config.modifyWrapper?this.config.modifyWrapper(e,a,c,d):e},vube.api.prototype.formatTimestamp=function(a){if(a){var b=parseInt(a/3600)%24,c=parseInt(a/60)%60,d=parseInt(a%60,10);return b=10>b?"0"+b:b,c=10>c?"0"+c:c,d=10>d?"0"+d:d,duration=("00"!=b?b+":":"")+c+":"+d}return!1},vube.api.prototype.process=function(a){var b=this,c=!1;if(void 0!=a.total&&this.countContainer&&this.countContainer.text(a.total),this.trigger&&(this.nextRequest=a._links.next?a._links.next.href:-1,-1==this.nextRequest?(this.trigger.css({display:"none"}),this.stopTrying=!0):this.updateText(this.config.locale.LOAD_MORE,!1),this.autoLoads--),this.loadLabel&&this.loadLabel.remove(),0==a.total)return this.queryVars.q&&this.contTitle.text(this.config.locale.NO_MORE),void 0;if(a._embedded){var d=a._embedded.comment?a._embedded.comment:a._embedded.video,e=a._embedded.comment?"comment-row":"vid-row";$.each(d,function(d,f){b.container.appendCount!=b.itemsPerRow&&b.container.appendCount||(c=$('<div class="'+e+'">'),b.container.appendCount=0,b.container.append(c)),b.appendVideo(f,c,d,a),b.container.appendCount++})}this.handleQueue(),this.trigger&&(this.monitored.pause=!1)},vube.api.prototype.uhOh=function(){this.trigger&&this.updateText(this.config.locale.LOAD_MORE,!1),this.monitored.pause=!1},vube.api.prototype.req=function(){if(this.nextRequest)return this.nextRequest;var a=this.url+"?";if(this.config.initialQuery&&this.config.initialQuery.string)return a+this.config.initialQuery.string;var b=function(a){return"id"==a?"recent":"view_count"==a?"popular":a};for(var c in this.queryVars)a+=c+"="+("object"!=typeof this.queryVars[c]?this.queryVars[c]:b(this.queryVars[c].property))+"&";return a.substring(0,a.length-1)},vube.api.prototype.next=function(a,b){var c=this;if(this.trigger){if(this.monitored.pause=!0,this.autoLoads<=0&&!a||this.stopTrying)return;a&&(this.autoLoads=1),this.updateText(this.config.locale.LOADING_MORE,!0)}return this.ajaxBusy=!0,this.xhrRef&&this.xhrRef.abort(),this.config.initialQuery&&this.config.initialQuery.json?(this.ajaxBusy=!1,this.process(this.config.initialQuery.json),void 0):(this.xhrRef=$.ajax({url:this.req(),error:function(a){c.ajaxBusy=!1;try{var e=$.parseJSON(a.responseText);if(e&&e._links)return b&&c.config.noData&&0===parseInt(d.total)&&c.config.noData(),c.process(e),void 0}catch(f){}c.uhOh()},success:function(a){b&&c.config.noData&&0===parseInt(a.total)&&c.config.noData(),c.process(a),c.ajaxBusy=!1}}),void 0)},Validator.prototype.is_valid=function(a,b){this.validate(!0,function(c){c._is_valid?a&&a(c):b&&b(c)})},Validator.prototype.validate=function(a,b){a=a||!1,list=0==this.updated.length?this.inputs:this.updated;for(i in list){can_remove=!0,error_element=document.getElementById(this.inputs[i].getAttribute("data-error-box")),error_element&&(error_element.innerHTML="");for(i2 in this.rules[i])instructions=this.rules[i][i2],rule=this.rules[i][i2][0],args=this.rules[i][i2][1],"ajax"==rule||"function"==typeof this["validator_"+rule]&&this["validator_"+rule](this.inputs[i],error_element,args);can_remove&&delete this.updated[i],error_element.style.display=error_element.innerHTML.length>0?"":"none"}this._is_valid=!0;for(i in this.inputs)if(error_element=document.getElementById(this.inputs[i].getAttribute("data-error-box")),error_element.innerHTML.length>0){this._is_valid=!1;break}b&&b(this)},Validator.prototype.hasupdate=function(a){var b=!1;for(id in this.updated)id==a.id&&(b=!0);b||(this.updated[a.id]=!0),this.validate(!0)},Validator.prototype.validator_length=function(a,b,c){val=a.value,c.min&&val.length<c.min?b.innerHTML+=a.getAttribute("data-error-too-short")+"<br/>":c.max&&val.length>c.max&&(b.innerHTML+=a.getAttribute("data-error-too-long")+"<br/>")},Validator.prototype.validator_required=function(a,b){val=a.value,val||b&&(b.innerHTML+=a.getAttribute("data-error-is-null")+"<br/>")},Validator.prototype.validator_regexp=function(a,b){val=a.value,val.match(/^\d+/)||(b.innerHTML+=a.getAttribute("data-error-regexp")+"<br/>")};