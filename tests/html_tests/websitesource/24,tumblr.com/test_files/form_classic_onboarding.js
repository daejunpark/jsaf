var SignupProcess=(function(){var H,Z,B,u,r,q,n,b,v,g,U,X,l,t=false,f=[],Q,D,P,a,S,s,z,A;var y=(document.location.protocol==="https:"),G="";b=[{name:"gmail.com",cost:0,share:30.2102985741},{name:"yahoo.com",cost:0,share:26.013029172},{name:"hotmail.com",cost:1,share:18.1002246857},{name:"aol.com",cost:6,share:3.03687405106},{name:"live.com",cost:9,share:2.06294942827},{name:"hotmail.co.uk",cost:10,share:1.95604539045},{name:"aim.com",cost:10,share:1.89339378918},{name:"mail.com",cost:17,share:1.2102985741},{name:"ymail.com",cost:18,share:1.0549753888},{name:"msn.com",cost:32,share:0.609550330148}];g=(window.devicePixelRatio)?true:false;function h(ab){var aa=ab.element();if(aa.hasClassName("login")){if(!y){return true}T("signup_account signup_birthday signup_register signup_waiting");c("signup_login")}if(aa.hasClassName("signup")){if(!y){return true}if($(document.body).hasClassName("has_login_captcha")){return true}T("signup_login signup_waiting");c("signup_account")}if(aa.hasClassName("cancel")){if($(document.body).hasClassName("has_login_captcha")){return true}if($(document.body).hasClassName("already_logged_in")){return true}T()}if(aa.hasClassName("logout")){return true}if(aa.parentNode.id=="logo"&&!n.current_view){return true}ab.stop();return false}function c(aa){n.current_view=aa;$(document.body).addClassName("show_form").addClassName(aa);Tumblr.KeyCommands.suspend();loading_next_page=true;k(aa);Tumblr.PlaceHolders.init();z.track_event("update_view",aa)}function T(aa){reset_form=(aa===undefined)?true:false;aa=aa||"show_form signup_account signup_birthday signup_register signup_login signup_waiting slow_motion now";$w(aa).each(function(ab){$(document.body).removeClassName(ab)});if($("signup_button_signup")){$("signup_button_signup").removeClassName("shallow").addClassName("other_blue")}Tumblr.KeyCommands.resume();loading_next_page=false;n.current_view=null;document.activeElement.blur();if(Tumblr.Glass.visible){Tumblr.Glass.hide()}u=null;if(reset_form){o()}if(reset_form){z.track_event("reset_view")}}function k(ab){var ac=$(ab),af,ae,ad;$("signup_forms_submit").removeClassName("changed");u=$$("#"+ab+" input");q.action=q.getAttribute("data-secure-ajax-action");m();Y();if(V(ab)){L();q.action=q.getAttribute("data-secure-action");u=$$('#signup_account input:not("#signup_username")');if($("signup_button_signup")){$("signup_button_signup").addClassName("shallow").removeClassName("other_blue")}if(g){$("signup_username").focus();$("signup_email").focus()}if(n.errors){e(n.errors);n.errors=null}if($(document.body).hasClassName("has_login_captcha")){Recaptcha.create($("recaptcha_public_key").value,"recaptcha_widget",{theme:"custom",custom_theme_widget:"recaptcha_widget",callback:function(){Recaptcha.focus_response_field;$("signup_forms_panel").style.display="none";$("signup_forms_panel").style.display="block"}})}}if(ab=="signup_account"){if(g){$("signup_username").focus();$("signup_email").focus()}if(s){if(!S){S=new Tumblr.PasswordStrengthMeter()}else{S.update()}}ac.observe("keydown",function(ah){af=ah.element();if(af.hasClassName("signup_username")){$("used_suggestion").value=0}})}if(ab=="signup_birthday"){setTimeout(function(){$("signup_age").focus()},500);R($("signup_age"));ac.observe("keyup",function(ah){af=ah.element();if(af.hasClassName("signup_age")){R(af)}});ac.observe("keydown",function(ah){af=ah.element();if(af.hasClassName("signup_age")){R(af)}});ac.observe("keypress",function(ah){af=ah.element();if(af.hasClassName("signup_age")){R(af)}})}if(ab=="signup_register"){if(g){setTimeout(function(){$("recaptcha_response_field").focus()},1000)}Recaptcha.create($("recaptcha_public_key").value,"recaptcha_widget",{theme:"custom",custom_theme_widget:"recaptcha_widget",callback:function(){Recaptcha.focus_response_field;$("signup_forms_panel").style.display="none";$("signup_forms_panel").style.display="block"}});ac.observe("keyup",function(){$("signup_forms_submit").addClassName("changed")})}if(ab=="signup_waiting"){if(A){var aa=new Tumblr.IllustratedLoader();aa.start_animation()}else{var ag=new Spinner(n.spinner_opts).spin();$("signup_waiting").appendChild(ag.el)}if($("failed_redirect_link")){$("failed_redirect_link").addClassName("show")}Event.stopObserving(window,"keydown");Event.stopObserving(window,"keyup")}}function Y(){$$("#"+n.current_view+" input").each(function(aa){aa.removeAttribute("disabled")})}function m(){$$("#signup_form .form_row input").each(function(aa){aa.setAttribute("disabled","disabled")})}function L(){$$("#signup_form .form_row input").each(function(aa){aa.removeAttribute("disabled")})}function I(){m();Y()}function R(aa){label=(aa.labels)?aa.labels[0]:aa.previous();slug=label.children[0];slug.innerHTML=aa.value;if(aa.value===""){aa.addClassName("is_empty");label.addClassName("is_empty")}else{aa.removeClassName("is_empty");label.removeClassName("is_empty")}if(parseInt(aa.value,10)>29){label.addClassName("years_young").removeClassName("years_old")}else{label.addClassName("years_old").removeClassName("years_young")}}function p(ab){var aa=$("suggested_usernames"),ac=$("suggested_usernames_container"),ad=ab.length;aa.innerHTML="";for(i=ad-1;i>=0;i--){new_username=document.createElement("li");new_username.className="popover_menu_item";new_username.innerHTML=ab[i];aa.appendChild(new_username)}ac.removeClassName("hidden");H=new Tumblr.Popover({el:"#suggested_usernames_container",direction:"left",skip_glass:true});H.show();new Tumblr.UsernameSuggester();$("seen_suggestion").value++}function W(ae){var ab=$("signup_form_errors"),ad=ae.length,aa,ac;ab.innerHTML="";for(ac=ad-1;ac>=0;ac--){aa=document.createElement("li");aa.className="error";aa.innerHTML=ae[ac];ab.appendChild(aa);z.track_event("error",ae[ac].stripTags())}}function e(ab){if(ab&&ab.length){W(ab);$("signup_forms").addClassName("has_errors")}if(n.current_view=="signup_register"){Recaptcha.reload()}if(!D){$("signup_forms_container").addClassName("shake").addClassName("animated")}var aa=setTimeout(function(){$("signup_forms_container").removeClassName("shake")},500)}function o(){$("signup_form").reset();Tumblr.PlaceHolders.init();O()}function O(){$("signup_forms_container").removeClassName("shake");$("signup_forms").removeClassName("has_errors")}function x(){var ab=u.length,ae=[],ad,ac,aa;for(aa=ab-1;aa>=0;aa--){ad=u[aa];if((ad.value===""||(ad.type=="checkbox"&&ad.checked===false))&&ad.getAttribute("data-required")){switch(ad.id){case"signup_email":ac=M(["Don't forget your email address!","You forgot to enter your email address!"]);break;case"signup_password":ac=M(["Don't forget your password!","You forgot to enter your password!"]);break;case"signup_username":ac=M(["Don't forget your username!","You forgot to enter your username!"]);break;case"signup_age":ac=M(["Don't forget to tell us your age!","You forgot to tell us your age."]);break;case"signup_tos":ac=M(["One more thing &ndash; please accept our Terms!","You must accept Tumblr's terms before proceeding."]);break;case"recaptcha_response_field":ac=M(["Don't forget to fill out the Captcha!","Please fill out the Captcha."]);break;default:ac=M(["There was an error. Please try again.","Oops. There was an error. Try again."])}ae.push(__(ac))}}if(ae.length){e(ae);return false}return true}function K(aj){if(V(n.current_view)){return true}aj=(aj.element)?aj.element():aj;var al=[],ac=aj.value,aa;if(aj.value!==""){if(aj.id=="signup_email"){var ae,ai,ag,ak,am,ab;Tumblr.SpellChecker.init(b,{costMultiplier:0.05});ag=(ai=ac.match(/[^@]+$/))?ai[0]:"";if(!/\@/.test(ac)){aa="That's not a valid email address. Please try again."}else{if(ac.toLowerCase().indexOf("@tumblr.com")!=-1){aa=M(["That email address is already in use. Please try again.","That email address is already associated with another account."])}else{if(!t&&(ae=Tumblr.SpellChecker.suggest(ag)).length){am=ac.split("@")[0]+"@"+ae[0];if(am!=ac){ab=__("Oops. Did you mean %1$s ?");email_placeholder="%1$s";ak='<a href="#" id="signup_email_suggestion">'+am+"</a>";aa=ab.replace(email_placeholder,ak,"g");t=true}}}}}if(aj.id=="signup_password"){if(ac.empty()||ac.blank()){aa="Don't forget your password!"}if(S&&S.block_registration_step){aa=S.block_registration_step}}if(aj.id=="signup_username"){if(ac.endsWith("-")){aa="Sorry, your username cannot end with a hyphen. Try again."}if(ac.startsWith("-")){aa="Sorry, your username cannot start with a hyphen. Try again."}if(ac.toLowerCase().indexOf("tumblr")!=-1){aa="Sorry, your username cannot contain Tumblr. Try another one."}}if(aj.id=="signup_age"){var af=parseInt(ac);var ah=new String(af);var ad=ac.replace(/^\s+|\s+$/g,"");if(!(ah==ad)){aa="Please enter your age as a number only!"}else{if(af<1){aa="Please enter a number!"}}}if(aa){al.push(__(aa))}}if(al.length){e(al);return false}O();return true}function C(){for(var aa=u.length-1;aa>=0;aa--){if(!K(u[aa])){return false}}return x()}function N(){if(H){$("suggested_usernames_container").addClassName("hidden");H.hide()}}function E(){O();if(V(n.current_view)){q.submit();return true}else{if(C()){N();L();q.request({parameters:{action:n.current_view,tracking_url:X,tracking_version:U,form_key:G},onFailure:function(aa){aa=JSON.parse(aa.responseText);if(aa.redirect){z.track_event("error","redirect");window.location.replace(aa.redirect)}else{e(aa.errors);if(aa.usernames){setTimeout(function(){p(aa.usernames)},750)}}if(n.current_view=="signup_register"){z.track_event("fail",l)}},onSuccess:function(aa){aa=JSON.parse(aa.responseText);if(aa.signup_success){z.track_event("success",l)}if(aa.redirect){c("signup_waiting");window.location.replace(aa.redirect)}else{c($(n.current_view).next().id)}}})}}}function F(aa){if(aa.target.id=="signup_email_suggestion"){$("signup_email").value=aa.target.innerHTML;$("signup_password").focus();O();aa.stop()}}function w(){var aa=document.activeElement,ab=(u)?u.length-1:false;if(aa&&ab&&u[ab]){return(aa.id==u[ab].id)?true:false}return}function d(){if(document.body.hasClassName("signup_login")){SignupProcess.update_view("signup_login")}else{if(document.body.hasClassName("signup_account")){SignupProcess.update_view("signup_account")}else{if(document.body.hasClassName("signup_waiting")){SignupProcess.update_view("signup_waiting")}}}}function J(){var aa=$("signup_subhead"),ab=$("signup_subhead_content"),ac;if(!aa){return}ac=aa.getWidth();if(ab.getWidth()>ac){aa.addClassName("medium");setTimeout(function(){if(ab.getWidth()>ac){aa.addClassName("small").removeClassName("medium");setTimeout(function(){if(ab.getWidth()>ac){aa.addClassName("infinitesimal").removeClassName("small")}},0)}},0)}}function j(){v=$$(".like_button, .reblog_button, .everyone_i_follow, .my_posts, .send_to_signup")}function V(aa){return(aa==="signup_login")}function M(aa){if(!aa.length){return}var ac=aa.length,ab=Math.floor(Math.random()*ac);return aa[ab]}return{initialize:function(aa){aa=aa||{};A=aa.use_illustrated_loader||false;G=document.getElementById("tumblr_form_key").getAttribute("content");Q=document.body.className.match("is_login_register");Q=(Q&&Q.length)?true:false;P=(document.body.hasClassName("is_tablet"));a=(document.body.hasClassName("is_mobile_handset"));D=(P||a);s=(document.body.hasClassName("show_password_strength"));q=$("signup_form");r=$("signup_forms_submit");Z=$$(".signup_buttons .login_signup_button, #logo");B=$$(".signup_view");signup_form_fields=$$("#signup_form input");n=this;U="modal";X=document.location.pathname;l="?url="+X+"&version="+U;j();z=new Tumblr.OnboardingBehaviors();Event.observe(document,"click",function(ab){if(v.indexOf(ab.target)!==-1){var ac=document.getElementById("signup_button_signup");if(ac){ac.click()}ab.stop()}});if(!Q&&q){Z.each(function(ab){Event.observe(ab,"click",h)});Event.observe(window,"keydown",function(ab){f[ab.keyCode]=1;if(f[16]){$(document.body).addClassName("slow_motion")}if(f[17]&&f[18]&&f[76]){$(document.body).removeClassName("slow_motion");c("signup_login");f=[];return false}});Event.observe(window,"keyup",function(ab){f[ab.keyCode]=0;if(ab.keyCode==16){$(document.body).removeClassName("slow_motion")}if(ab.keyCode==27){if($(document.body).hasClassName("lite")){return}if($(document.body).hasClassName("already_logged_in")){window.location="/dashboard"}else{T()}}})}if(q){signup_form_fields.each(function(ab){Event.observe(ab,"change",K)});Event.observe(q,"submit",function(ab){ab.stop();E()});Event.observe(q,"keydown",function(ab){if(ab.keyCode==9&&!ab.shiftKey){if(w()){ab.stop()}}if(ab.keyCode==13){ab.stop();E()}});Event.observe($("signup_form_errors"),"click",F);Event.observe(r,"click",function(){E()});Event.observe("signup_forms_container","scroll",function(ab){$("signup_forms_container").scrollLeft=0});d();if(n.errors){e(n.errors);n.errors=null}}J()},update_send_to_signup_links:j,reset_view:function(){T()},update_view:function(aa){T();c(aa)},current_view:null,spinner_opts:{lines:16,length:11,width:4,radius:17,color:"#fff",speed:0.9,trail:34,shadow:false,hwaccel:false,className:"signup_waiting_spinner spinner",zIndex:2000000000,top:"50",left:"auto"}}})();
(function(b,a){var c=Backbone.View.extend({el:"body",events:{},initialize:function(){b("#signup_form input").on("focus",function(d){if(!this.tracking_events){this.start_tracking_events();this.tracking_events=true}}.bind(this))},tracking_events:false,track_event:function(e,d){if(_gaq){_gaq.push(["_trackPageview","/signup/"+e])}},start_tracking_events:function(){b("body").on("click",function(d){var e=d.currentTarget,f=e.nodeName;f+=(e.id.length)?"-"+e.id:"";f+=(e.className.length)?"-"+e.className:"";this.track_event("clicked",f)}.bind(this));b(window).on("keyup",function(d){if(d.keyCode==27){this.track_event("keypress","esc")}}.bind(this))}});a.OnboardingBehaviors=c})(jQuery,Tumblr);
