var EventSelectors={start:function(b){this.rules=b||{};this.assign(this.rules)},assign:function(b){$H(b).each(function(a){$$(a[0]).collect(a[1])})}};var Keyboard={TAB:9,BACKSPACE:8,ENTER:13,SHIFT:16,CONTROL:17,ESCAPE:27,SPACE:32,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,COMMAND:91,SEMICOLON:59,COMA:188,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,is_an_input_modifier_key:function(a){return[Keyboard.ENTER,Keyboard.SHIFT,Keyboard.CONTROL,Keyboard.ESCAPE,Keyboard.SPACE,Keyboard.ARROW_LEFT,Keyboard.ARROW_UP,Keyboard.ARROW_RIGHT,Keyboard.ARROW_DOWN,Keyboard.COMMAND,Keyboard.TAB].indexOf(a)===-1}};var DM_Widget_Page={initEvents:function(){$j("span.linkable").each(function(){DM_Widget_Page.makeLinkable(this)})},makeLinkable:function(j){var f=$j(j);if(typeof j.outerHTML!="undefined"){var g=j.outerHTML;g=g.replace(/<span/i,"<a").replace(/<\/span>$/i,"</a>");if(f.hasClass("ajax_link")){g=g.replace("<a",'<a onclick="DM_Ajax.link(this); return false;"')}var b=document.createElement("div");b.innerHTML=g;e=$j(b.firstChild);var c=e.data("href");if(c){e.attr("href",c)}}else{var e=$j("<a>").html(j.innerHTML);for(var d=0;d<j.attributes.length;d++){var h=j.attributes[d].value,a=j.attributes[d].name;if(a=="data-href"){a="href"}e.attr(a,h)}if(f.hasClass("ajax_link")){e.attr("onclick","DM_Ajax.link(this); return false;")}}f.replaceWith(e)},notify:function(){var a=arguments;DM_JS.get("DM_Notify",function(){DM_Notify.notify.apply(DM_Notify,Array.prototype.slice.call(a))})},openLoginPopupForAction:function(a){DM_JS.get("DM_Widget_Popup",function(){var b=DM_Widget_Popup.getInstanceOrNew();b.loadPageItem("/pageitem/loginfull?restricted=1",document.location.pathname,{unlogged_action:a||""},function(){$j("#popupContent input[data-focus]").focus()})})},continuePendingActions:function(){var b;if(b=getCookie("dm_done")){deleteCookie("dm_done");window["DM_Widget_Page_"+b]&&DM_Widget_Page.notify(window["DM_Widget_Page_"+b],"info")}else{if(b=getCookie("dm_need")){deleteCookie("dm_need");var a=b.split(":");if(a.length>1&&a[0]=="popup"){DM_JS.get("DM_Widget_Popup",function(){var c=DM_Widget_Popup.getInstanceOrNew();c.loadPageItem(hex2str(a[1]),document.location.pathname)})}}}},initialize:function(){$j(function(){setCookie("timezoneOffset",new Date().getTimezoneOffset()*60,1);if(window.DM_WrongUserEmail){$j("#topwrapper").prepend(window.DM_WrongUserEmail)}DM_Widget_Page.continuePendingActions();DM_Widget_Page.initEvents()})}};DM_Widget_Page.initialize();var DM_Form_Inputs={inputs:{},getInstance:function(b,d){var c=b.getFormName(),a=$j(d).children(".dmco_form_input")[0].id;if(!DM_Form_Inputs.inputs[c]){DM_Form_Inputs.inputs[c]={}}if(!DM_Form_Inputs.inputs[c][a]){DM_Form_Inputs.inputs[c][a]=new DM_Form_Input(b,d)}return DM_Form_Inputs.inputs[c][a]},reset:function(a){var b=a.getFormName();if(!DM_Form_Inputs.inputs[b]){return}delete (DM_Form_Inputs.inputs[b])},getInstanceByFieldName:function(b,a){return DM_Form_Inputs.getInstance(b,b.getInputByName(a))}};(function(){var DM_Form_Input=function(dm_form,metaInput){this.observers=[];this.dm_form=dm_form;this._metaInputElement=metaInput;this.observedInputs={};this.changeObserved=false;this.$inputs=null;this.partialCheck=false;this.populateInputs();if($j(metaInput).findParamInClass("rule_visible")){this.initVisibility()}if(dm_form.liveCheck){this.liveCheckInit()}};DM_Form_Input.prototype={notify:function(msg){var that=this;$j.each(this.observers,function(){this.update(that,msg)})},register:function(observer){this.observers.push(observer)},liveCheckInit:function(){var that=this;this.$inputs.each(function(){var input=this,$input=$j(this);$input.on("blur",function(){$input.val($j.trim($input.val()));if(!/^\s*$/.test($input.val())){DM_Widget_Form.focus_id=null;that.validate()}});$input.on("focus",function(){DM_Widget_Form.focus_id=input.id});if(/rule_ajaxchecker/.test(input.className)){var timeoutKey=input.id+"_checktimeout",checker=function(){DM_Form_Validator.ajaxchecker(that)};$input.on("keyup",function(ev){ev=ev||window.event;var keyCode=ev.keyCode?ev.keyCode:ev.which;if(Keyboard.is_an_input_modifier_key(keyCode)){DM_Widget_Form[timeoutKey]&&clearTimeout(DM_Widget_Form[timeoutKey]);DM_Widget_Form[timeoutKey]=setTimeout(checker,$input.findParamInClass("interval")||500)}});$input.on("paste",function(){DM_Widget_Form[timeoutKey]=setTimeout(checker,100)})}})},populateInputs:function(){this.$inputs=$j(this._metaInputElement).find("input, select, textarea")},initVisibility:function(){var $_metaInputElement=$j(this._metaInputElement),param=$_metaInputElement.findParamsInClass("rule_visible");try{var regexp=/(.*)\-(.*)/;for(var i=0;i<param.length;i++){var values=value=mymatch=mymatch2=null;var mymatch=regexp.exec(param[i]);if(mymatch){var fieldname=mymatch[1],fieldnames=fieldname.split("?");if(fieldnames.length>1&&!$_metaInputElement.hasClassName("visible_and")){this.partialCheck=true}var value=mymatch[2],mymatch2=value.split("?");if(mymatch2){for(var j=0;j<fieldnames.length;j++){if(fieldnames[j]==this.name){var inputToCheck=this}else{var inputToCheck=DM_Form_Inputs.getInstanceByFieldName(this.dm_form,fieldnames[j])}var inputToCheckName=inputToCheck.getName();this.observedInputs[inputToCheckName]={};this.observedInputs[inputToCheckName].values=mymatch2;this.observedInputs[inputToCheckName].visible=false;inputToCheck.observeChange();inputToCheck.register(this);inputToCheck.notify()}}}}}catch(e){}return false},observeChange:function(){if(!this.changeObserved){var that=this;this.$inputs.each(function(){var $this=$j(this);if($this.attr("type").match(/radio|checkbox/)){$this.on("click",function(){that.notify()})}else{$this.on("change",function(){that.notify()})}});this.changeObserved=true}},update:function(observedInput,msg){var visible=true,values=observedInput.getValue(),that=this;this.observedInputs[observedInput.getName()].visible=false;$j.each(values,function(){if(that.observedInputs[observedInput.getName()].values.indexOf(this+"")>=0){that.observedInputs[observedInput.getName()].visible=true}});if(this.partialCheck){visible=false;$j.each(this.observedInputs,function(){visible=visible||this.visible})}else{$j.each(this.observedInputs,function(){visible=visible&&this.visible})}var container=this.getContainer();if(visible){this.visible=true;if(container){container.show()}}else{this.visible=false;if(container){container.hide()}}return},getContainer:function(){var realInput=this.getRealInput(),$realInput=$j(realInput);return((realInput&&$j("#"+realInput.id+"_cont")[0])||(realInput&&$realInput.closest(".form_item")[0])||realInput)},validate:function(){var that=this,result=true,hintResult=true,input=this.$inputs.filter(function(){return $j(this).hasClass("check")})[0]||this.$inputs.get(-1);if($j(input).hasClass("auto_complete")){input=this.$inputs[0]}var rules=$j.grep(input.className.split(" "),function(className){return className.match(/^rule_/)}),hints=$j.grep(input.className.split(" "),function(className){return className.match(/^hint_/)}),visibilityRule=$j.grep(rules,function(className){return className.startsWith("rule_visible")}).length,visible=true;if(visibilityRule){visible=this.visible}if(visible){$j.each(rules,function(){if(result!=true){return}var error=true;try{var fullRule=this.replace("rule_",""),ruleName=fullRule,ruleParams="",pos;if((pos=fullRule.indexOf("-"))>-1){ruleName=fullRule.slice(0,pos);ruleParams=fullRule.slice(pos+1);if(!ruleName.match(/^visible/)){result=eval("DM_Form_Validator."+ruleName)(that.getFilteredValue(),ruleParams);if(!result&&fullRule.match(/^enume/)){error=false}}}else{result=fullRule.match(/^altmultichoice/)?DM_Form_Validator.altmultichoice(that.getRealInput()):result=eval("DM_Form_Validator."+ruleName)(that.getFilteredValue())}}catch(e){}if(!result&&DM_Form_Validator[that.getFormName()]){if(error){var msgHashId=str2hex(ruleName);if(ruleParams&&["character","regex","ajaxchecker"].indexOf(ruleName)!=-1){msgHashId=ruleParams}try{var realInput=that.getRealInput(),$realInput=$j(realInput);if($realInput.hasClass("auto_complete")||$realInput.hasClass("dmco_form_olddate_select")){realInput=that.inputs[0]}DM_Widget_Form.removeInputMsgs(realInput,"info","for_ajaxchecker");that.displayError(DM_Form_Validator[that.getFormName()][realInput.name.replace(/\[.*\]/,"")][ruleName][msgHashId],msgHashId)}catch(e){}}}else{try{DM_Widget_Form.removeInputMsgs(that.getRealInput(),"error",msgHashId)}catch(e){}}})}return result},getFormName:function(){return this.dm_form.getFormName()},getName:function(){return this.getRealInput().name},getValue:function(){var length=this.$inputs.length,result=[];if(this.$inputs[0].type.match(/radio|checkbox/)){this.$inputs.each(function(){if(this.checked){result.push(this.value)}})}else{if(length==1){if(this.$inputs[0].type.match(/radio|checkbox/)){if(this.$inputs[0].checked){result.push(this.$inputs[0].value)}}else{if(this.$inputs[0].tagName.toLowerCase().match(/input|textarea/)){result.push(this.$inputs[0].value)}else{if(this.$inputs[0].tagName.toLowerCase()=="select"){result.push(this.$inputs[0].options[this.$inputs[0].selectedIndex].value)}}}}else{var realInput=this.getRealInput(),$realInput=$j(realInput);if($realInput.hasClass("auto_complete")||$realInput.hasClass("dmco_form_olddate_select")){realInput=this.$inputs[0]}result.push(realInput.value)}}return result},reset:function(){delete (this.value);this.filteredValue=[]},getFilteredValue:function(){var filteredValue=[],filters=$j.grep(this.getRealInput().className.split(" "),function(className){return className.match(/^filter_/)}),values=this.getValue();$j.each(values,function(){var value=this;$j.each(filters,function(index,filter){filter=filter.replace("filter_","");try{value=eval("DM_Form_Filter."+filter)(value.replace("'","'"))}catch(e){}});filteredValue.push(value)});return filteredValue},getRealInput:function(){return this.$inputs.get(-1)},getInputs:function(){return this.$inputs},displayError:function(message,classMatch){var input=this.getRealInput(),realInput=$j(input).next("span.dmco_form_input_info")[0];if(realInput){input=realInput}var $input=$j(input),$cont=$j(input).closest(".form_input");if($input.hasClass("auto_complete")){DM_Widget_PageItem_AutoComplete.storeValues()}if($cont[0]){if($input.hasClass("edit_in_place")){DM_Widget_Page.notify(message,"error")}else{var msgDisplayed=false;classMatch=classMatch?"msg_"+classMatch:classMatch;if(classMatch){$cont.find("div.error_msg").each(function(){var $el=$j(this);if($el.hasClass(classMatch)){$el.html(message);msgDisplayed=true;return false}})}if(!msgDisplayed){$cont.addClass("has_error").append($j('<div class="error_msg '+(classMatch||"")+'">').html(message))}}if($input.hasClass("auto_complete")){DM_Widget_PageItem_AutoComplete.setup(true)}}},displayInfo:function(message,classMatch){var input=this.getRealInput(),realInput=$j(input).next("span.dmco_form_input_info")[0];if(realInput){input=realInput}var $input=$j(input),$cont=$input.closest(".form_input");if($cont[0]){var msgDisplayed=false;classMatch=classMatch?"msg_"+classMatch:classMatch;if(classMatch){$cont.find("div.info_msg").each(function(){var $el=$j(el);if($el.hasClass(classMatch)){$el.html(message);msgDisplayed=true;return false}})}if(!msgDisplayed){$cont.append($j('<div class="info_msg '+(classMatch||"")+'">').html(message))}}}};window.DM_Form_Input=DM_Form_Input})();(function(){var a=function(e){this.form=e;var c=$j(e),d=this,b=c.find('input[name="form_name"]')[0];this.formName=b?b.value:"none";if(c.hasClass("live_check")){this.liveCheck=true}this.fieldsToCheck=[];this.fields=[];c.find(".form_input").each(function(){d.fields.push($j(this).closest(".form_item")[0])});if(this.fields.length){c.on("submit",$j.proxy(this.validate,this)).find(".form_input.check").each(function(){d.fieldsToCheck.push(DM_Form_Inputs.getInstance(d,this))})}};a.prototype={validate:function(d){var f=true,b=$j(this.form);try{$j.each(this.fieldsToCheck,function(){this.reset();f=this.validate()&&f})}catch(h){}if(!f){d.preventDefault();$noticeBox=$j("#notice_box");var c=this.getFormName();if($noticeBox[0]&&DM_Form_Validator[c]&&DM_Form_Validator[c]["error_msg"]){var g=$j('<div class="dmpi_notice dmpi_notice_error">').hide();g.html('<div class="notice_message"><div class="dmco_text">'+DM_Form_Validator[c]["error_msg"]+"</div></div>");$noticeBox.html(g);g.show("fast")}}else{try{if(!b.hasClass("persistent")){DM_Widget_Form.removeForm(this.form)}if(b.data("alreadyObserved")){d.preventDefault();if(!b.hasClass("no_submit")&&!this.form.cancelImmediateSubmit){DM_Ajax.submitForm(this.form)}this.form.cancelImmediateSubmit=false}else{return true}}catch(h){}}d.preventDefault();return false},getFormName:function(){return this.formName},getInputByName:function(c){var b=$j.grep(this.fields,function(e){var d=$j(e).find("#"+c)[0];if(d){return true}return false});return b[0]&&$j(b[0]).find(".form_input")[0]}};window.DM_Form=a})();var DM_Form_Filter={striptags:function(a){return $j.map(a,function(b){if($j.isString(b)){return $j.stripTags(b)}})}};var DM_Form_Validator={error_msg:[],required:function(a){if(a.length>0){var b=$j.map(a,function(c){if(!/^\s*$/.test(unescape(c))){return c}});if(b.length>0){return true}}return false},altmultichoice:function(a){var b=[],c=$j(a);c.find("option").each(function(){b.push(unescape($j(this).val()))});c.val(b);return true},compare:function(b,c){var a=c&&$j("#"+c);if(!a[0]){return false}b=unescape(b);if(b!==a.val()){return false}return true},emailaddress:function(a){return/^([^@]+)@([^@\.]+\.[^@]+)$/.test(unescape(a))},stringlength:function(a,c){if(a.length>0){var b=$j.map(a,function(f){f=unescape(f);var d=true;c=c.split("-");if(f){for(var e=0;e<c.length;e++){var g=c[e].split(":");if(g[0]=="max"){d=(f.length<=parseInt(g[1]))&&d}else{if(g[0]=="min"){d=(f.length>=parseInt(g[1]))&&d}else{if(g[0]=="equal"){d=(f.length==parseInt(g[1]))&&d}else{}}}}}return d});if(b.length>0){return true}}return false},character:function(b,c){b=$j.trim(unescape(b));if(!/^\s*$/.test(b)&&!/^\s*$/.test(c)){c=hex2str(c).split("::");var a="^["+c[1]+"]+$";if(c[0]=="refuse"){a="^[^"+c[1]+"]+$"}return b.match(a)}return true},regex:function(b,c){b=$j.trim(unescape(b));if(!/^\s*$/.test(b)&&!/^\s*$/.test(c)){c=hex2str(c).slice(1,-1);var a=new RegExp(c);return a.test(b)}return true},ajaxchecker:function(dm_form_input){if(!(dm_form_input instanceof DM_Form_Input)){return true}var input=dm_form_input.getRealInput(),ruleParamsMatches=input.className.match(/rule_ajaxchecker-([a-f0-9]+)/),ruleParams=ruleParamsMatches?ruleParamsMatches[1]:"",optionsProviderString=hex2str(ruleParams),options=eval(optionsProviderString),defaultOptions={url:null,pre_validate:function(){return true}};options=$j.extend(defaultOptions,$j.isString(options)?{}:options);if(options.url&&options.pre_validate(input.id)&&dm_form_input.validate()){if(options.url.match(/^\/ajax\//)){ajax_call(options.url.replace(/\/ajax\//,""),"check_input",input.id,$j(input).val(),function(res){var jsonRes=$j.parseJSON(res);if(jsonRes.valid){if(jsonRes.msg){DM_Widget_Form.removeInputMsgs(input,"error");DM_Widget_Form.removeInputMsgs(input,"error","for_ajaxchecker");dm_form_input.displayInfo.call(dm_form_input,jsonRes.msg,"for_ajaxchecker")}}else{var msg=jsonRes.msg||DM_Form_Validator[dm_form_input.getFormName()][input.name.sub(/\[.*\]/,"")]["ajaxchecker"][ruleParams];if(msg){DM_Widget_Form.removeInputMsgs(input,"info","for_ajaxchecker");dm_form_input.displayError.call(dm_form_input,msg,"for_ajaxchecker")}}})}else{}}else{DM_Widget_Form.removeInputMsgs(input,"info","for_ajaxchecker");DM_Widget_Form.removeInputMsgs(input,"error","for_ajaxchecker");if(DM_Widget_Form.focus_id==input.id&&!options.pre_validate(input.id)){DM_Widget_Form.removeInputMsgs(input,"error")}}return true}};var DM_Widget_Form={forms:$H(),initEvents:function(){$j("form.dmco_form").each(function(){var a=$j(this),d=a.find('input[name="form_name"]')[0],b=d?d.value:null;if(a.data("initdone")){return}a.data("initdone",true);if(b){if(!DM_Widget_Form.forms[b]){DM_Widget_Form.forms[b]=new DM_Form(this)}}if(a.hasClass("ajax")){DM_Ajax.addAjaxForm(this)}if(a.hasClass("form_with_confirm")){a.on("submit",function(){return DM_Form[b]&&confirm(DM_Form[b]["confirm"])})}a.find(".link_to_post a").on("click",function(e){e.preventDefault();a.submit()});a.find("textarea.counter, input.counter").each(function(){var f=$j(this);if(!f.next().hasClass("dmco_form_input_info")){var g=f.findParamInClass("count"),e=function(h){return h+"/"+g+" "+DM_Form.charactersUsedLabel};f.after($j('<span class="dmco_form_input_info">')).next().html(e(this.value.length)).prev().on("keyup",function(){var h=$j(this),j=h.next();if(this.value.length>g){j.addClass("error_msg")}else{j.removeClass("error_msg")}j.html(e(this.value.length))})}});var c="placeholder" in document.createElement("input");if(!c){a.find("input[placeholder]").each(function(){var g=$j(this);hint=g.attr("placeholder");if(hint&&!g.prev("span.input_hint")[0]){g.before('<span onclick="$j(this).next().focus();" class="input_hint">'+hint+"</span>");var e=g.prev(),h=function(){if(this.value===""){e.show().removeClass("has_focus")}else{e.hide()}},f=function(){setTimeout(function(){if(this.value!==""){e.hide()}else{e.show()}},50)};g.on("focus",function(){e.addClass("has_focus");if(this.value){e.hide()}}).on("blur",h).on("paste",f).on("keydown",f).on("input",f);if(["username","password"].indexOf(this.name)!=-1){setTimeout(function(){arguments.callee.tries=arguments.callee.tries||0;if(g.val()===""){if(arguments.callee.tries++<30){return setTimeout(arguments.callee,50)}}else{h()}},20)}h()}})}a.find("input[data-focus]").first().focus();a.find("a#cantread").each(function(){$j(this).on("click",function(){$j("#captcha_image").html('<div id="captcha_image" style="background-image:url(/dmcaptcha?rand='+new Date().getTime()+');"></div>')})});a.find("input.switcher").each(function(){var e=$j(this);e.on("click",function(){e.next().val(e.next().val()=="show"?"hide":"show");DM_Form_Inputs.getInstance(DM_Widget_Form.forms[b],e.parent().parent()[0]).notify()})});a.find("input.altmultichoice_action").on("click",function(){var h=$j(this),f=h.findParamInClass("actionType"),g=hex2str(h.findParamInClass("actionTarget")),j=null,e=null;switch(f){case"add":var j=$j("#src_"+g),e=$j("#dst_"+g);break;case"remove":var j=$j("#dst_"+g),e=$j("#src_"+g);break}if(j[0]&&j.find("option")[0]&&j.val().length){j.val().each(function(k){e.prepend(j.find('option[value="'+k+'"]').first().remove())})}});a.find("div.dmco_form_olddate select").each(function(){var k=$j(this),j=k.parent(),e=j.find("select.year"),g=j.find("select.month"),f=j.find("select.day"),h=function(){if(e.val()!=0&&g.val()!=0&&f.val()!=0){var l=new Date();l.setFullYear(parseInt(e.val()),parseInt(g.val()-1),parseInt(f.val()));k.next('input[type="hidden"]').val(l.toDBFormattedString())}else{k.next('input[type="hidden"]').val("")}};h();k.on("change",h)});a.find("input.dmco_form_submit").on("click",function(){$j(this).closest("form").find("div.ss_msg").each(function(){var e=$j(this),f=e.closest("div.form_input");f&&f.removeClass("has_error");e.remove()})})})},removeInputMsgs:function(b,c,a){a=a&&!a.match(/^msg_/)?"msg_"+a:a;$j(b.nodeName.toUpperCase()=="FORM"?b:b.parentNode).find("div."+c+"_msg").each(function(){var d=$j(this);if((!a&&!d.hasClass("msg_for_ajaxchecker"))||(a&&d.hasClass(a))){if(c=="error"){d.closest("div.form_input").removeClass("has_error")}d.remove()}})},removeFormByName:function(a){var c=DM_Widget_Form.forms[a];if(!c){return}var b=c.form;$j(b).off();DM_Form_Inputs.reset(c);delete (DM_Widget_Form.forms[a])},removeForm:function(c){var b=$j(c),a=b.find('input[name="form_name"]')[0];if(!a){return}DM_Widget_Form.removeFormByName(a.value)},initialize:function(){$j(DM_Widget_Form.initEvents)}};DM_Widget_Form.initialize();var DM_Context=function(){this.timeout=1800;this.maxsize=3000;this.list=this.getList();if(this.expire()){this.save()}$j($j.proxy(this.apply,this))};DM_Context.prototype={apply:function(a){this.initEvents(a)},initEvents:function(d){var b="a[data-context]",a=$j.isString(d)?d+" "+b:b,c=this;$j(a).each(function(){if(this.dm_context_observed){return}this.dm_context_observed=true;$j(this).on("click",$j.proxy(c.put,c,this.href.split("#")[0].split("?")[0],this.getAttribute("data-context")))})},getList:function(){var b={},a=getCookie("dm_context");try{if(a){b=$j.parseJSON(unescape(a))}if($j.isArray(b)){b={}}}catch(c){}return b},put:function(b,a){this.list[this.sign(b)]={c:a,t:this.timestamp()};this.reduce();this.save()},save:function(){setCookie("dm_context",this.serialize())},serialize:function(){return escape($j.toJSONString(this.list))},expire:function(){var a=false;for(key in this.list){if(this.list.hasOwnProperty(key)){var b=this.list[key].t;if(!$j.isNumeric(b)||this.timestamp()>(b+this.timeout)){delete (this.list[key]);a=true}}}return a},timestamp:function(){return Math.round(new Date().getTime()/1000)},reduce:function(){while(this.serialize().length>this.maxsize){var a=null;for(key in this.list){if(this.list.hasOwnProperty(key)){if(a==null||this.list[key].t<this.list[a].t){a=key}}}if(!a){break}delete (this.list[a])}},sign:function(a){return this.crc32(a.replace(/[^a-zA-Z0-9_]+/g,""))},crc32:function(f,d){var c="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";if(d==window.undefined){d=0}var g=0,a=0;d=d^(-1);for(var b=0,e=f.length;b<e;b++){g=(d^f.charCodeAt(b))&255;a="0x"+c.substr(g*9,8);d=(d>>>8)^a}return d^(-1)}};var dm_context=new DM_Context();var Sd_Header={canFocusSearch:true,initEvents:function(){$j("#header_search").submit(Sd_Header.onSearchSubmit);$j("#close_super_header").click(Sd_Header.onCloseSuperHeaderClick)},onSearchSubmit:function(){var e=$j("#input_search");var d=new RegExp("^(\\s|\\.)*$","g");if(e.length){if(d.test(e.val())){}else{var a="/relevance/search/"+encodeURIComponent(Request.cleanSearch(e.val()))+"/1";var c=$j("#search_hitmap");a+=c.length?c.val():"";try{if(window.external.msIsSiteMode()){g_ext=window.external;g_ext.msSiteModeCreateJumpList(DM_JumplistSearchLabel);g_ext.msSiteModeAddJumpListItem(e.val(),a,"/images/icons/magnifier.ico","self");g_ext.msSiteModeShowJumplist()}}catch(b){}document.location.href=a}}return false},focusSearchField:function(){if(window.page_has_intersticial||!Sd_Header.canFocusSearch){return}if($$("body.lt_homefeed, body.lt_homemedia").size()){$j("#input_search").focus()}},searchFieldFocusOnLoad:function(){Sd_Header.focusSearchField();if(typeof Sd_Header_search!="undefined"){$j("#input_search").val(Sd_Header_search)}},lockFocus:function(){Sd_Header.canFocusSearch=false},unlockFocus:function(){Sd_Header.canFocusSearch=true},onCloseSuperHeaderClick:function(){setCookie("hideSuperHeader",1,7);$j("#metaheader_style").remove();$j("#top_header_announcement").slideUp("fast");PubSub.publish("dm:close_super_header")},webappRedirect:function(){this.displayName="webappRedirect";var d="use_mobile_version",e="yes",f=3650,b=new Date(),a=b.setDate(b.getDate()+f),c={domain:".dailymotion.com",path:"/",expires:new Date(a)};document.cookie=d+"="+e+(c.expires?"; expires="+c.expires.toUTCString():"")+(c.path?"; path="+c.path:"")+(c.domain?"; domain="+c.domain:"")+(c.secure?"; secure":"");document.location.reload(true)},hideConnectLinkAndFB:function(){if($j(document.body).hasClass("dm_page_html_login")){$j("#login_info").children().eq(0).remove();$j("#login_infos").remove()}},hideAllAfterRegister:function(){$j("#popupContent div.register_form_box").css("width","auto");$j("#popupContent div.register_right_box, #popupContent div.box_sep").hide();$j("form.dmpi_registerform").removeClass("dmpi_registerform")},hideAllAfterLogin:function(){if($j("div.dmpi_loginfull").length){$j("div.dmpi_loginfull").css("width","auto");$j(".fb_signin_cont, #popup_title, #popupContent div.box_sep").hide();$j(".login_form").removeClass("dmpi_login")}},initialize:function(){this.webappRedirect.displayName="webappRedirect";PubSub.subscribe("masscast:intersticial_opened",Sd_Header.lockFocus);PubSub.subscribe("masscast:intersticial_closed",function(){Sd_Header.unlockFocus();Sd_Header.focusSearchField()});$j(function(){Sd_Header.initEvents();Sd_Header.searchFieldFocusOnLoad();Sd_Header.hideConnectLinkAndFB();$(document).observe("dm:intersticial_closed",Sd_Header.focusSearchField)})}};Sd_Header.initialize();var Sd_Footer={initialize:function(){$j(function(){if(navigator.userAgent.toLowerCase().indexOf("firefox")!=-1){$j("#footer_stream").remove()}})}};Sd_Footer.initialize();var DM_LocaleSelector={initEvents:function(){$j("#footer").on("click","#country_selector a.dmco_flag",DM_LocaleSelector.onCountryFlagClick)},onCountryFlagClick:function(){var a=$j(this).findParamInClass("country");var b=$j(this).findParamInClass("language");DM_LocaleSelector.changeLocale(b,a)},initCountrySelectorOnLoad:function(){var c=$j("#country_selector a");var b=document.location.search;var a=document.location.hash;if($j.trim(b)!=""){c.each(function(){$j(this).attr("href",$j(this).attr("href")+b)})}if($j.trim(a)!=""&&typeof DM_LocaleSelector_routeName!="undefined"&&DM_LocaleSelector_routeName=="faq"){c.each(function(){$j(this).attr("href",$j(this).attr("href")+a)})}},changeLocale:function(b,a){if(a){b=b+"_"+a.toUpperCase()}setCookie(DM_LoginCookie,"",-10);setCookie("lang",b,100)},initialize:function(){$j(function(){if($j("#country_selector").size()){DM_LocaleSelector.initEvents();DM_LocaleSelector.initCountrySelectorOnLoad()}})}};DM_LocaleSelector.initialize();var DM_Widget_PageItem_Facebook_Connect={popup:null,logoutAsked:null,doReload:true,enabled:false,debug:false,redirect:"",onLoginCallback:null,customReload:function(){if(DM_Widget_PageItem_Facebook_Connect.DmPendingAction){document.location=decodeURIComponent(DM_Widget_PageItem_Facebook_Connect.DmPendingAction);return}var e="http://"+document.location.hostname+document.location.pathname+document.location.search;if(e.indexOf("fbc=")>0){document.location=e.replace(/fb_source=(.*)&/,"").replace(/fbc=(\d+)/,"fbc="+Math.floor(Math.random()*1000))}else{var f="?";if(e.indexOf("?")>0){f="&"}var d=e+f+"fbc="+Math.floor(Math.random()*1000);document.location=d.replace(/fb_source=(.*)&/,"")}},isFacebookMappedCallback:function(c){log("Connect",'Call "isFacebookMappedCallback"');datas=$j.parseJSON(decodeURIComponent(c));log("Connect",datas);if(typeof DM_Widget_PageItem_Facebook_Connect.onLoginCallback=="function"){DM_Widget_PageItem_Facebook_Connect.onLoginCallback(datas)}var d=(datas.dm_action=="create")?"register":datas.dm_action;switch(datas.state){case"true":log("Connect",'DM Ajax returned "true"');FB.api("/me?fields=id,name,picture&type=square",function(a){if(a&&a.id&&a.picture&&a.name){setCookie("facebook_infos",a.name.escapeUtf8()+"***"+a.picture.data["url"]+"***"+a.id,7);setCookie(DM_LoginCookie,c);PubSub.publish("dm:fb_cookie_updated");Stats_SiteCatalyst.onFacebookScAction(d);HeaderLogin.update()}});break;case"refresh_infos":log("Connect",'DM Ajax returned "refresh_infos"');log("Connect","About to reload the page");FB.api("/me?fields=id,name,picture&type=square",function(a){if(a&&a.id&&a.picture&&a.name){setCookie("facebook_infos",a.name.escapeUtf8()+"***"+a.picture.data["url"]+"***"+a.id,7);setCookie(DM_LoginCookie,c);PubSub.publish("dm:fb_cookie_updated");Stats_SiteCatalyst.onFacebookScAction(d);if(DM_Widget_PageItem_Facebook_Connect.doReload){return DM_Widget_PageItem_Facebook_Connect.customReload()}log("Connect","NO RELOAD because DM_Widget_PageItem_Facebook_Connect.doReload is set to false.")}});break;case"fail":log("Connect",'DM Ajax returned "fail"');break}},followPendingAction:function(){DM_Widget_PageItem_Facebook_Connect.DmPendingAction=window.DmPendingAction||null},resetLoginParams:function(){DM_Widget_PageItem_Facebook_Connect.loginParams=null},onLoginFacebook:function(c,d){log("Connect",'Call "onLoginFacebook"');deleteCookie("fb_autologin_disabled");if(c){DM_Widget_PageItem_Facebook_Connect.onLoginCallback=typeof c=="function"?c:DM_Widget_PageItem_Facebook_Connect.followPendingAction}if(typeof d=="function"){d()}else{DM_Widget_PageItem_Facebook_Connect.resetLoginParams()}log("Connect",'FB ajax call : "FB.login"');FB.login(DM_Widget_PageItem_Facebook_Connect.handleOnLoginFacebookResponse,{scope:"email"})},handleOnLoginFacebookResponse:function(b){if(b.authResponse){window.DM_Widget_Popup&&DM_Widget_Popup.close();log("Connect",'User logged on FB and linked with "Daily FB Connect App"');PubSub.publish("dm:fb_logged",true);log("Connect",'Make DM ajax call to "facebook login"');return ajax_call("facebook","login",$j.toJSONString(DM_Widget_PageItem_Facebook_Connect.loginParams),DM_Widget_PageItem_Facebook_Connect.isFacebookMappedCallback)}log("Connect","User cancelled login")},disconnect:function(b){if(b=="unknown"){PubSub.publish("dm:fb_unlogged")}else{if(b=="not_authorized"){PubSub.publish("dm:fb_not_authorized")}}deleteCookie("facebook_infos")},removePermissions:function(b){FB.api("/me/permissions","DELETE",function(a){if(a){if(a.error&&a.error.type=="OAuthException"){DM_Widget_PageItem_Facebook_Connect.onLoginFacebook(function(){DM_Widget_PageItem_Facebook_Connect.doReload=false;DM_Widget_PageItem_Facebook_Connect.removePermissions(b)})}else{b()}}})},handleSessionResponse:function(e){log("Connect",e);if(typeof e.authResponse=="undefined"||!e.authResponse){log("Connect","User is not logged on Facebook OR has not authorized application");return DM_Widget_PageItem_Facebook_Connect.disconnect(e.status)}log("Connect","User is logged on Facebook");var f=getCookie("facebook_infos");if(f){f=decodeURIComponent(f);var d=f.split("***")[2];if(e.authResponse.userID!=d){DM_Widget_PageItem_Facebook_Connect.disconnect(e.status);return}}FB.api("/me/permissions",function(b){if(!b.data[0].email){log("Connect","User has not accept all permissons");DM_Widget_PageItem_Facebook_Connect.disconnect("not_authorized");return}log("Connect","User approves email permission");log("Connect",'User logged on FB and linked with "Daily FB Connect App"');PubSub.publish("dm:fb_logged",false);var a=$j("div.dmpi_loginfull").length||($j("#login_infos").length&&!$j("#fb_login_id").length);if(a&&DM_Widget_PageItem_Facebook_Connect_AUTOLOGIN&&!getCookie("fb_autologin_disabled")){log("Connect","User is logged on FB, but header has no FB infos");log("Connect",'Make DM ajax call to "facebook login"');ajax_call("facebook","login",null,DM_Widget_PageItem_Facebook_Connect.isFacebookMappedCallback)}})},init:function(b){log("Connect",'Call "DM_Widget_PageItem_Facebook_Connect.init"');FB.init({appId:DM_Widget_PageItem_Facebook_Connect_APP_ID,status:true,cookie:true,xfbml:true,oauth:true});if(b){log("Connect","FB Script was late")}log("Connect","About to check FB user status");FB.getLoginStatus(DM_Widget_PageItem_Facebook_Connect.handleSessionResponse)},isFacebookScriptLoaded:function(){return(typeof FBScriptLoaded!="undefined"&&FBScriptLoaded)},initialize:function(b){$j(function(){log("Connect",'Call "DM_Widget_PageItem_Facebook_Connect.initialize"');if(DM_Widget_PageItem_Facebook_Connect.isFacebookScriptLoaded()){log("Connect","FB script is loaded");DM_Widget_PageItem_Facebook_Connect.init(b)}else{FBConnectInit=false;log("Connect","FB script is NOT loaded yet")}})}};DM_Widget_PageItem_Facebook_Connect.initialize();var DM_Widget_PageItem_Notice={initEvents:function(){$j("div.dmpi_notice").each(function(){var a=$j(this);if(a.hasClass("appear")&&!a.is(":visible")){a.fadeToggle(700)}}).on("click","div.close_notice",DM_Widget_PageItem_Notice.onClose).on("click","div.permanent_close_notice",DM_Widget_PageItem_Notice.onPermanentClose)},onClose:function(){$j(this).closest(".dmpi_notice").fadeToggle(400)},onPermanentClose:function(a){$j(this).closest(".dmpi_notice").fadeToggle(400);setCookie($j(this).findParamInClass("name"),"true",365)},initialize:function(){$j(function(){DM_Widget_PageItem_Notice.initEvents()})}};DM_Widget_PageItem_Notice.initialize();var DM_Widget_PageItem_Search={version:5,autocomplete_enabled:"0",language:"en",historyCounter:0,onSelectSuggestion:function(a){var b=DM_Widget_PageItem_Search.autocomplete;if(a.length==6){b.updateShadow();b.updateInput(a[4]>0?b.inputValue.slice(0,a[4])+a[0]:a[0]);b.ignoreValueChange=true}},checkUserHistory:function(c){var b=c.typedValue;if(localStorage&&localStorage.hasOwnProperty("search_history")&&b.length>1){var d=JSON.parse(localStorage.getItem("search_history"));var a=0;$j(d).each(function(e,f){if(f.substring(0,b.length)==b){DM_Widget_PageItem_Search.checkDuplicateValue(f);c.suggestions.splice(a,0,[f,0,0,[[b.length,f.length-b.length]],0,false]);a++}if(a==2){DM_Widget_PageItem_Search.historyCounter=a;return false}});DM_Widget_PageItem_Search.historyCounter=a}},checkDuplicateValue:function(a){$j(DM_Widget_PageItem_Search.autocomplete.suggestions).each(function(c,b){if(b[0]==a){DM_Widget_PageItem_Search.autocomplete.suggestions.splice(c,1);return false}})},suggest:function(){var d=DM_Widget_PageItem_Search.autocomplete;if(d.suggestions.length===0){d.updateShadow();log("Search","no suggestions to display, hide container");d.hide();return}var c=[];var a="";c.push('<div class="suggestions foreground">');DM_Widget_PageItem_Search.checkUserHistory(d);$j(d.suggestions).each(function(h,m){a="";boldString="";var n=0,l=m[3];for(var g=0;g<l.length;g++){var k=l[g];if(n<k[0]){a+=m[0].slice(n,k[0])}n=k[0]+k[1];boldString=m[0].slice(k[0],n);a+="<b>"+boldString+"</b>"}if(n<m[0].length){a+=m[0].slice(n)}var o=d.selectedIndex===h?"selected":"";o=DM_Widget_PageItem_Search.historyCounter>0?"history":o;if(DM_Widget_PageItem_Search.historyCounter>0){DM_Widget_PageItem_Search.historyCounter--}c.push('<div class="',o,'"',' onclick="Autocomplete.instances[',d.instanceId,"].onSelect(",h,')"',' onmouseover="Autocomplete.instances[',d.instanceId,"].activate(",h,')">','<span class="suggestion" id="suggestion_',h,'"',">",a,"</span>");c.push('<div class="clear_suggestion"></div></div>');$j(d.inputRuler).html(m[4]>0?d.inputValue.slice(0,m[4]).replace(/ /g,"&nbsp;"):"");if(h===0){if(m[5]||!boldString){d.updateShadow()}else{d.updateShadow(d.inputValue+boldString)}}else{if(h==9){return false}}});c.push("</div>");$j(d.container).html(c.join("")).show();var b=$j(d.el),f=$j(d.el).position(),e={left:f.left+"px",width:$j(d.el).outerWidth()+"px"};if(d.inputRuler&&$j(d.inputRuler).width()!==0){e.width="auto";$j(d.container)[0].offsetLeft=$j(d.inputRuler).width()}$j(d.container).css(e);$j(d.el).addClass("no_border_bottom_left_radius")},postConfigureSearchField:function(c){var a=$j("<div>").attr("id","input_ruler"),b=$j(c.el);c.inputRuler=a[0];b.after(a.css({position:"absolute",visibility:"hidden",padding:0,margin:0,"font-size":b.css("font-size"),"font-family":b.css("font-family")}))},initialize:function(){$j(function(){if(DM_Widget_PageItem_Search_autocomplete_enabled==1){var b="/json/complete/"+DM_Widget_PageItem_Search_language,a=$j("#input_search");if(a[0]){(function(){if(!window.page_has_intersticial){DM_Widget_PageItem_Search.autocomplete=new Autocomplete("input_search",{allowRefineLocally:false,serviceUrl:b,deferRequestBy:10,maxChars:30,postConfigureSearchField:DM_Widget_PageItem_Search.postConfigureSearchField,cleanStringOnValueChange:false,cleanStringOnProcessResponse:false,withShadow:true,withIframeLayer:true,onSelectSuggestion:DM_Widget_PageItem_Search.onSelectSuggestion,suggest:DM_Widget_PageItem_Search.suggest})}else{setTimeout(arguments.callee,500)}})()}}})}};DM_Widget_PageItem_Search.initialize();var Autocomplete=function(c,d){this.instanceId=Autocomplete.instances.push(this)-1;this.searchFieldId=c;this.suggestionsId="autocomplete_"+c;this.container=null;this.suggestions=[];this.$iframeLayer=null;this.selectedIndex=-1;this.boundKiller=null;this.ignoreValueChange=false;this.cachedResponse=[];this.onChangeInterval=null;this.typedValue="";this.inputValue="";this.lastTypedValue="";this.refineLocally=false;this.dataValue=null;this.shadowTimeout=null;this.options={serviceUrl:"",autoSubmit:true,minChars:1,maxChars:0,deferRequestBy:0,showInfo:true,autoPosition:false,appendMode:false,allowRefineLocally:true,suggestMax:10,headerOffset:36,suggestHeight:20,postConfigureSearchField:null,withShadow:false,withIframeLayer:false,cleanStringOnValueChange:true,cleanStringOnProcessResponse:true,processResponse:null,suggest:null,onKeyUp:null,suggestionsProvider:null};for(option in d){if(!d.hasOwnProperty(option)){continue}if(option in this){this[option]=d[option];delete (d[option])}}$j.extend(this.options,d);this.configureSearchField()};Autocomplete.prototype={version:3,configureSearchField:function(){log("Autocomplete","configureSearchField()");var d=$j("#"+this.searchFieldId);this.el=d[0];this.el.setAttribute("autocomplete","off");d.on("keydown",$j.proxy(this.onKeyDown,this)).on("keyup",$j.proxy(this.onKeyUp,this)).on("blur",$j.proxy(this.enablekiller,this));if(this.options.withShadow){var c=d.position();$shadowEl=$j('<input id="input_search_shadow" type="text"/>').show().css({left:c.left+"px",top:c.top+"px",width:d.width("width")+"px"});this.shadowEl=$shadowEl[0];d.addClass("has_shadow").after($shadowEl)}if(this.options.postConfigureSearchField&&typeof this.options.postConfigureSearchField==="function"){this.options.postConfigureSearchField(this)}},createSuggestionsContainer:function(){log("Autocomplete","createSuggestionsContainer()");var d=$j("<div>"),e={display:"none"},f=$j(this.el);if(this.options.withIframeLayer){this.$iframeLayer=$j('<iframe class="search_iframe_layer">')}d.addClass("autocomplete").attr("id",this.suggestionsId);if(this.options.autoPosition){e.top=(f.position().top+f.height()+parseInt(f.css("padding-top"),10)+parseInt(f.css("padding-bottom"),10)+2)+"px"}f.after(d.css(e));if(this.options.withIframeLayer){f.before(this.$iframeLayer.css("top",d.css("top")))}this.container=$j("#"+this.suggestionsId)[0]},onKeyDown:function(b){if(this.options.withShadow){if(this.shadowEl.value.indexOf(this.el.value+String.fromCharCode(b.keyCode).toLowerCase())===-1){this.updateShadow()}}if((!this.container||!$j(this.container).is(":visible"))&&b.keyCode!==Keyboard.ENTER){if(this.options.withShadow&&b.keyCode===Keyboard.TAB){b.preventDefault()}return}switch(b.keyCode){case Keyboard.ESCAPE:this.el.value=this.inputValue;this.hide();break;case Keyboard.ENTER:if(!this.options.autoSubmit){b.preventDefault()}this.onSelect(this.selectedIndex);break;case Keyboard.ARROW_UP:this.moveUp();break;case Keyboard.ARROW_DOWN:this.moveDown();break;case Keyboard.TAB:if(this.options.withShadow){b.preventDefault();this.onSelect(0,true)}break;case Keyboard.BACKSPACE:case 32:this.updateShadow();default:return}b.preventDefault()},onKeyUp:function(b){switch(b.keyCode){case Keyboard.ARROW_UP:case Keyboard.ARROW_DOWN:case Keyboard.ENTER:return;default:break}clearInterval(this.onChangeInterval);this.ignoreValueChange=false;if(this.typedValue!==this.el.value.toLowerCase()){if(this.options.deferRequestBy>0){this.onChangeInterval=setInterval($j.proxy(this.onValueChange,this),this.options.deferRequestBy)}else{this.onValueChange()}}},enablekiller:function(b){if(this.boundKiller===null){this.boundKiller=$j.proxy(this.killer,this);$j(document).on("click",this.boundKiller)}},disablekiller:function(){if(this.boundKiller!==null){$j(document).off("click",this.boundKiller);this.boundKiller=null}},killer:function(b){if(!$j(b.target).closest("#"+this.suggestionsId)[0]&&!$j(b.target).closest("#"+this.searchFieldId)[0]){this.hide();this.disablekiller()}},hide:function(){this.selectedIndex=-1;if(this.container){$j(this.container).hide();if(this.options.withIframeLayer){$j(this.$iframeLayer).hide()}$j("#input_search").removeClass("no_border_bottom_left_radius")}},updateInput:function(h,f){log("Autocomplete","update input text with new value",h);if(this.options.appendMode&&!f){var g=this.el.value.split(" "),j=g[g.length-1],k=new RegExp(j+"$");this.el.value=this.el.value.replace(k,h)}else{this.el.value=h}this.updateShadow(this.el.value)},moveUp:function(){this.updateShadow();if(this.selectedIndex===-1){this.selectedIndex=this.suggestions.length;this.activate(this.selectedIndex-1);this.updateInput(this.suggestions[this.selectedIndex][0]);return}if(this.selectedIndex===0){$j(this.container).find(".selected").removeClass("selected");this.selectedIndex=-1;this.updateInput(this.inputValue,true);return}this.activate(this.selectedIndex-1);this.updateInput(this.suggestions[this.selectedIndex][0])},moveDown:function(){this.updateShadow();if(this.selectedIndex===(this.suggestions.length-1)){$j(this.container).find(".selected").removeClass("selected");this.selectedIndex=-1;this.updateInput(this.inputValue,true);return}this.activate(this.selectedIndex+1);this.updateInput(this.suggestions[this.selectedIndex][0])},onValueChange:function(){clearInterval(this.onChangeInterval);this.lastTypedValue=this.typedValue.toLowerCase();this.typedValue=this.el.value.toLowerCase();this.inputValue=this.el.value;this.selectedIndex=-1;log("Autocomplete","onValueChange(), new value",this.typedValue);if(!$j("#"+this.suggestionsId)[0]){this.createSuggestionsContainer()}if(this.ignoreValueChange){this.ignoreValueChange=false;return}if(this.options.cleanStringOnValueChange){this.typedValue=this.cleansSearchString(this.typedValue)}if(this.typedValue.blank()||this.typedValue.length<this.options.minChars||(this.options.maxChars&&this.typedValue.length>this.options.maxChars)){log("Autocomplete","typed value empty || < minChars || > maxChars");this.hide();this.updateShadow()}else{this.getSuggestions()}},onSelect:function(d,f){var e=this.suggestions[d]||[this.cleansSearchString(this.el.value)];if(this.options.onSelectSuggestion&&typeof this.options.onSelectSuggestion==="function"){this.options.onSelectSuggestion(e,this.suggestions,f)}else{if(e[0]){this.updateShadow();this.updateInput(e[0]);this.ignoreValueChange=true}}this.hide();if(this.options.autoSubmit&&$j(this.el).closest("form")[0]&&!f){$j(this.el).closest("form").submit();this.addRequestsToLocalStorage(e[0])}},addRequestsToLocalStorage:function(d){if(localStorage){if(localStorage.hasOwnProperty("search_history")){var c=JSON.parse(localStorage.getItem("search_history"));if($j.inArray(d,c)>-1){c.splice($j.inArray(d,c),1)}c.unshift(d);if(c.length>50){c.pop()}}else{var c=[];c.push(d)}localStorage.setItem("search_history",JSON.stringify(c))}},getSuggestions:function(){log("Autocomplete","getSuggestions() for value",this.typedValue);if($j.isArray(this.cachedResponse[encodeURIComponent(this.accentsTidy(this.typedValue))])){this.truncateSuggestions(this.cachedResponse[encodeURIComponent(this.accentsTidy(this.typedValue))]);log("Autocomplete","found cached response for value",this.typedValue,this.suggestions);this._suggest()}else{if(this.refineLocally&&this.options.allowRefineLocally){if(!this.lastTypedValue.match(/^\s*$/)&&this.el.value.toLowerCase().indexOf(this.lastTypedValue)===0){this.suggestions=$j(this.suggestions).grep(function(b){return this.accentsTidy(b[0]).indexOf(this.accentsTidy(this.typedValue))===0},this);this.cachedResponse[encodeURIComponent(this.accentsTidy(this.typedValue))]=this.suggestions;this._suggest();return}else{this.refineLocally=false}}this.suggestionsProvider()}},suggestionsProvider:function(){var c=getCookie("dailymotion_auth"),d=this.options.serviceUrl+"/"+encodeURIComponent(this.typedValue)+(c?"?"+c:"");$j.getJSON(d).always($j.proxy(this.processResponse,this,d))},_suggest:function(){this.suggest();if(this.options.withIframeLayer){this.$iframeLayer.show().css({left:$j(this.container).css("left"),width:$j(this.container).outerWidth()+"px",height:$j(this.container).outerHeight()+"px"})}},suggest:function(){log("Autocomplete","suggest() results for value",this.typedValue);if(this.suggestions.length===0){this.updateShadow();log("Autocomplete","no suggestions to display, hide container");this.hide();return}var h=[];var k="";h.push('<div class="suggestions background foreground">');var j=this;$j(this.suggestions).each(function(b,a){if(b===0){j.updateShadow(a[0])}k=a[0];h.push((j.selectedIndex===b?'<div class="selected"':"<div"),' onclick="Autocomplete.instances[',j.instanceId,"].onSelect(",b,')"',' onmouseover="Autocomplete.instances[',j.instanceId,"].activate(",b,')">','<span class="suggestion" id="suggestion_',b,'"',">",k,"</span>");h.push('<div class="clear_suggestion"></div></div>')});h.push("</div>");$j(this.container).html(h.join("")).show();if(this.searchFieldId=="input_search"){$j("#input_search").addClass("no_border_bottom_left_radius")}var f=$j("#"+this.searchFieldId),g=f.position();$j(this.container).css({left:g.left+"px",width:f.width()+"px"})},processResponse:function(n,o,h,j){var k=n.substring(n.lastIndexOf("/")+1,n.length);if(k.indexOf("?")!=-1){k=k.substring(0,k.indexOf("?"))}log("Autocomplete","processResponse()",o);this.cachedResponse[encodeURIComponent(this.accentsTidy(this.typedValue))]=o;this.truncateSuggestions(o);if(this.suggestions.length<10&&this.options.allowRefineLocally){this.refineLocally=true}var l=this.el.value.toLowerCase(),m=this.options.cleanStringOnProcessResponse?this.cleansSearchString(l):l;if(k===encodeURIComponent(m)){this._suggest()}},truncateSuggestions:function(f){this.suggestions=f;var g=$j("html");if(g.hasClass("win")&&(g.hasClass("webkit")||g.hasClass("ie"))){var h=$j("#main_player")||$j(".dmpi_video_playerv4"),k=h[0];if(k){var j=h.offset().top-$j("#header").offset().top-this.options.headerOffset;this.options.suggestMax=Math.floor(j/this.options.suggestHeight);if(!$j(document.body).hasClass("dm_page_html_video")){this.options.suggestMax--}}if(this.options.suggestMax<10){this.suggestions=f.slice(this.options.suggestMax-1)}}},activate:function(e){var f;if(this.container&&$j(this.container).is(":visible")){$j(this.container).find(".selected").removeClass("selected");this.selectedIndex=e;var d=$j(this.container).children().children();if(this.selectedIndex!==-1&&d.length>this.selectedIndex){f=d[this.selectedIndex];$j(f).addClass("selected")}}return f},updateShadow:function(d){if(this.options.withShadow){var c=this;clearTimeout(this.shadowTimeout);if(d){this.shadowTimeout=setTimeout(function(){c.shadowEl.value=d;log("Autocomplete","update shadow with value",d)},300)}else{this.shadowEl.value="";log("Autocomplete","update shadow with value",d)}}},cleansSearchString:function(b){return b.replace(/\s{2,}/g," ").replace(/^\s+/g,"").replace(/\//g,"")},accentsTidy:function(b){return b.toLowerCase().replace(/[àáâãäå]/g,"a").replace(/ç/g,"c").replace(/[èéêë]/g,"e").replace(/[ìíîï]/g,"i").replace(/ñ/g,"n").replace(/[òóôõö]/g,"o").replace(/[ùúûü]/g,"u").replace(/[ýÿ]/g,"y")}};Autocomplete.debug=false;Autocomplete.instances=[];var vsZone=null,vsZoneUsed=false,vskeys,vsUrl,cookieEnabled=(function(){setCookieWithFormat("cookie_enabled","y",1,"m");if(getCookie("cookie_enabled")=="y"){return true}return false})();if(cookieEnabled){vsZone=getCookie("vsz")||"";deleteCookie("vsz")}window.DM_Player&&DM_Player.addReadyCallback(VS_onDailymotionPlayerReady);function VS_onDailymotionPlayerReady(b){var a=$j("#"+b)[0];if(a){a.addEventListener("onVideoMetadata","onVSPlayerVideoMetadata")}}function onVSPlayerVideoMetadata(){if(window.logPageViewFromPlayer){vsStat()}}var instrumentActionCounter=[];function instrumentAction(elts,action,type,method){if(!cookieEnabled||!elts||!window.vsRedUrl){return}if(action=="OSU/Send"){return $j.get(vsRedUrl+"log=1&action="+encodeURIComponent(action)+"&country="+encodeURIComponent(vskeys.vs_country)+"&locale="+encodeURIComponent(vskeys.vs_locale))}var i=0,l=elts.length||0,el=elts.nodeType?elts:l?elts[0]:null;do{if(!el||el.is_vs_obs){return}var spa=encodeURIComponent(vskeys.vs_spa),url=vsRedUrl+"log=1&action="+encodeURIComponent(action);if(type=="video"){if(action.indexOf("related/related")===-1){url+="&video="+encodeURIComponent(vskeys.vs_video)+"&videotitle="+encodeURIComponent(vskeys.vs_videotitle)+"&user="+encodeURIComponent(vskeys.vs_user)+"&usertype="+encodeURIComponent(vskeys.vs_usertype)}url+="&actionpage="+encodeURIComponent(vskeys.vs_pagename)+"&country="+encodeURIComponent(vskeys.vs_country);if(typeof spa!="undefined"&&spa!="undefined"){url+="&spa="+spa}if(action.indexOf("related")==0){if(!instrumentActionCounter[action]){instrumentActionCounter[action]=0}instrumentActionCounter[action]++;url+="&spb="+instrumentActionCounter[action]}}if(type=="list"){url+="&experience="+encodeURIComponent(vskeys.vs_experience)+"&actionpage="+encodeURIComponent(vskeys.vs_pagename);var page="0";if("vs_page" in vskeys){page=vskeys.vs_page}url+="&rank="+encodeURIComponent(page+","+i)+"&actionchannel="+encodeURIComponent(vskeys.vs_channel)}var observer={elt:el,url:url,call:function(event){var doRedirect=false;if(this.elt.nodeName=="A"&&$j(this.elt).hasClass("not_ajax")&&this.elt.href.indexOf("javascript")==-1&&this.elt.href.indexOf("#")!=0&&this.elt.target!="_blank"){doRedirect=true;event.stop()}$j.get(this.url).always($j.proxy(function(){var time_out=0;if(typeof method!="undefined"){time_out=300;eval(method)(this.elt)}if(doRedirect){setTimeout($j.proxy(function(){document.location=this.elt.href},this),time_out)}},this))}};$j(el).on("click",$j.proxy(observer.call,observer));el.is_vs_obs=true}while(++i<l&&(el=elts[i]))}function vsStat(e){if(!cookieEnabled){return}var j=$j.extend({},vskeys),h=document,b=e||window.vskeys_extras;if(h.referrer){j.vs_dr=h.referrer}j.vs_dh=location.href;if(vsZone&&!vsZoneUsed){vsZoneUsed=true;j.vs_hitmap=vsZone}j.vs_cb=new Date().getTime();if(b){if(j.vs_pagename&&b["vs_pagename-extra"]){j.vs_pagename+=b["vs_pagename-extra"]}delete (b["vs_pagename-extra"]);for(var m in b){if(b.hasOwnProperty(m)){j[m]=b[m]}}}if(document.body.className.match(/dm_page_html_video\b/)){var g="",l=$j("#tabs a.context_tab_selected");if(l.length){$j(l[0].className.split(/ +/)).each(function(){if(this.match(/^tab_/)){g=this.replace(/^tab_/,"")}})}else{g="related"}j.vs_spd=g}var k=vsUrl;var f=true;for(var a in j){if(!f){k+="&"}k+=a.substr(3)+"="+encodeURIComponent(j[a]);f=false}ping(k,"vs")}function vsContextInstrument(a){if(document.body.className.match(/dm_page_html_videos\b|dm_page_html_daily50\b|dm_page_html_video\b/)){if($j("#dmpi_video_tools")[0]&&a&&!arguments.callee["doneTools"+a]){arguments.callee["doneTools"+a]=true;$j(a+" a").each(function(){var c=this.className.match(/\btool_([^\b\s]+)\b/),d=c&&c.length==2?"video/"+c[1].replace(/_/g,"/"):null;if(d){instrumentAction(this,d,"video")}})}}if(document.body.className.match(/dm_page_html_video\b/)){if(a=="#related"){if(!arguments.callee.doneRelated&&$j("#related div.dmpi_video_relatedlist")[0]){arguments.callee.doneRelated=true;instrumentAction($j("#all_videos")[0],"related/related/all","video")}}else{if(!arguments.callee.doneTabs&&$j("#player_page_tabs_nav")[0]){arguments.callee.doneTabs=true;$j("#player_page_tabs_nav span").each(function(){var c=this.className.match(/\btab_([^\b\s]+)\b/),d=c&&c.length==2?"video/tabs/"+c[1]:null;if(d){instrumentAction(this,d,"video")}})}if($j("#player_page_tabs")[0]&&a&&a.match(/tab_[a-z]+_content/)&&!arguments.callee["doneTab"+a]){arguments.callee["doneTab"+a]=true;var b=a.match(/tab_([a-z]+)_content/)[1];if(b=="playlists"){instrumentAction($j(a+" a.bottom_right"),"video/tabs/playlists/shownext","video")}else{instrumentAction($j(a+" input.long_button"),"video/tabs/"+b+"/showmore","video");instrumentAction($j(a+" a.bottom_right"),"video/tabs/"+b+"/shownext","video")}}}}$j("#small_embed_link").each(function(){instrumentAction(this,"video/embed","video")})}$j(function(){if(typeof(vskeys)!="undefined"){$j(document).on("mousedown","a[data-vszone]",function(b){var a=$j(this).data("vszone");if(a){setCookieWithFormat("vsz",a,1,"m")}});vsStat();vsContextInstrument();PubSub.subscribe("vs:action",onVsAction)}});function onVsAction(b){if(!cookieEnabled||!window.vsRedUrl){return}var a=vsRedUrl+"log=1&action="+encodeURIComponent(b);if(vskeys.vs_pagename){a+="&actionpage="+encodeURIComponent(vskeys.vs_pagename)}if(vskeys.vs_country){a+="&country="+encodeURIComponent(vskeys.vs_country)}ping(a,"vs")}function vsSimpleCall(b){if(!cookieEnabled||!window.vsRedUrl){return}if(b.indexOf("/lang/")>0){b=b.substr(b.indexOf("/lang/")+6,2)}else{b="All"}var a=vsRedUrl+"log=1&action=selectcomment/"+b;a+="&Video="+encodeURIComponent(vskeys.vs_video);a+="&Videotitle="+encodeURIComponent(vskeys.vs_videotitle);a+="&user="+encodeURIComponent(vskeys.vs_user);a+="&usertype="+encodeURIComponent(vskeys.vs_usertype);a+="&actionpage="+encodeURIComponent(vskeys.vs_pagename);a+="&spa="+encodeURIComponent(vskeys.vs_spa);$j.get(a)}var Stats_SiteCatalyst={onScAction:function(g){if("SiteCatalyst" in window){var f=window.SiteCatalyst.getInstance();var d=g.context;var c=g.label;switch(d){case"ajax home":case"ligue1":var a=c.pageName?c.pageName:f.pageName;var b=c.type?c.type:c;ajax_call("sitecatalyst","get_ajax_page_code",a,b,function(h){if(h){$j("#sitecatalyst").html(h)}});break;case"ticker":switch(c.action){case"minimize":f.events="event52";f.linkTrackVars="events";f.linkTrackEvents="event52";f.tl(this,"o",c.name);break;case"subscribe":break}break;case"subscription":var e=c.action+" "+c.type;if(c.action=="subscribe"){f.eVar40=e;f.events="event2";f.linkTrackVars="eVar40,events";f.linkTrackEvents="event2";f.tl(this,"o",e)}else{if(c.action=="unsubscribe"){f.eVar40=e;f.events="event3";f.linkTrackVars="eVar40,events";f.linkTrackEvents="event3";f.tl(this,"o",e)}}break;case"login":f.eVar39=c;f.events="event27";f.linkTrackVars="eVar39,events";f.linkTrackEvents="event27";f.tl(this,"o",c);break;case"register":f.eVar41=c;f.events="event26";f.linkTrackVars="eVar41,events";f.linkTrackEvents="event26";f.tl(this,"o",c);break;case"watchlater":f.eVar12="Add to Watch Later list";f.eVar25=f.eVar13=c.title;f.events="event33,event35";f.linkTrackVars="eVar12,eVar13,events";f.linkTrackEvents="event33,event35";f.tl(this,"o","Add to Watch Later list");break;case"upload":var e=c.type;if(c.status=="request"){f.eVar65=e;f.events="event32";f.linkTrackVars="eVar65,events";f.linkTrackEvents="event32";f.tl(this,"o",e+" upload request")}else{if(c.status=="start"){f.eVar65=e;f.events="event49";f.linkTrackVars="eVar65,events";f.linkTrackEvents="event49";f.tl(this,"o",e+" upload start")}else{if(c.status=="success"){f.eVar65=e;f.events="event25";f.linkTrackVars="eVar65,events";f.linkTrackEvents="event25";f.tl(this,"o",e+" upload success")}else{if(c.status=="save"){f.eVar65=e;f.events="event51";f.linkTrackVars="eVar65,events";f.linkTrackEvents="event51";f.tl(this,"o",e+" upload form save")}}}}break}}},onUserPageScAction:function(){if("SiteCatalyst" in window){var a=window.SiteCatalyst.getInstance();$j(document).on("click",function(b){var c=a.prop18;var d=a.prop19;if($j(b.target).closest(".dmpi_user_tools .icon_export")[0]){a.eVar21=c;a.eVar22=d;a.events="event40";a.linkTrackVars="eVar21,eVar22,events";a.linkTrackEvents="event40";a.tl(this,"o","Promote a user")}else{if($j(b.target).closest(".dmpi_user_tools .icon_jukebox")[0]){a.eVar21=c;a.eVar22=d;a.events="event38";a.linkTrackVars="eVar21,eVar22,events";a.linkTrackEvents="event38";a.tl(this,"o","Create a Jukebox")}else{if($j(b.target).closest(".dmpi_user_tools .icon_film")[0]){a.eVar21=c;a.eVar22=d;a.events="event39";a.linkTrackVars="eVar21,eVar22,events";a.linkTrackEvents="event39";a.tl(this,"o","Create a Videowall")}}}})}},onVideoPageScAction:function(){if("SiteCatalyst" in window){var a=window.SiteCatalyst.getInstance();$j(document).on("click",function(f){var c=a.prop22;if($j(f.target).closest(".dmpi_abuse .dmco_form_submit")[0]){var h=$j("#comment").val();if(h>=10&&h<=400){a.eVar12="Report a video";a.eVar25=a.eVar13=c;a.events="event33,event43";a.linkTrackVars="eVar12,eVar13,events";a.linkTrackEvents="event33,event43";a.tl(this,"o","Report a video")}}else{if($j(f.target).closest(".sd_video_socialbuttons .embed")[0]){a.eVar12="Use Embed Video Panel";a.eVar25=a.eVar13=c;a.events="event33,event41";a.linkTrackVars="eVar12,eVar13,events";a.linkTrackEvents="event33,event41";a.tl(this,"o","Use Embed Video Panel")}else{if($j(f.target).closest(".sd_video_tools .tool_moveto_bookmark span").hasClass("favorite")){a.eVar12="Add to favorites";a.eVar25=a.eVar13=c;a.events="event33,event34";a.linkTrackVars="eVar12,eVar13,events";a.linkTrackEvents="event33,event34";a.tl(this,"o","Add to favorites")}else{if($j(f.target).closest(".dmpi_playlist_create .dmco_form_submit")[0]){a.eVar12="Create a playlist";a.eVar25=a.eVar13=c;a.events="event33,event28";a.linkTrackVars="eVar12,eVar13,events";a.linkTrackEvents="event33,event28";a.tl(this,"o","Create a playlist")}else{if($j(f.target).closest(".dmpi_video_tools_playlistadd .playlist_list .add")[0]){a.eVar12="Add to playlist";a.eVar25=a.eVar13=c;a.events="event33,event29";a.linkTrackVars="eVar12,eVar13,events";a.linkTrackEvents="event33,event29";a.tl(this,"o","Add to playlist")}else{if($j(f.target).closest(".sd_video_tools .tool_moveto_watchlater")[0]){a.eVar12="Add to Watch Later list";a.eVar25=a.eVar13=c;a.events="event33,event35";a.linkTrackVars="eVar12,eVar13,events";a.linkTrackEvents="event33,event35";a.tl(this,"o","Add to Watch Later list")}else{var e=$j(f.target).closest(".dmpi_video_tools_addorinvite.contest .group_list .dmco_link");if(e[0]){var g=true,d=e.siblings("form");if(d[0]){g=d.find("input").prop("checked")?true:false}if(!e.hasClass("remove_video_from_group")&&g){a.eVar12="Add to contest";a.eVar25=a.eVar13=c;a.events="event33,event37";a.linkTrackVars="eVar12,eVar13,events";a.linkTrackEvents="event33,event37";a.tl(this,"o","Add to contest")}}else{var b=$j(f.target).closest(".dmpi_video_tools_addorinvite .group_list .dmco_link");if(b[0]){var g=true,d=b.siblings("form");if(d[0]){g=d.find("input").prop("checked")?true:false}if(!b.hasClass("remove_video_from_group")&&g){a.eVar12="Add to group";a.eVar25=a.eVar13=c;a.events="event33,event36";a.linkTrackVars="eVar12,eVar13,events";a.linkTrackEvents="event33,event36";a.tl(this,"o","Add to group")}}}}}}}}}})}},onFacebookScAction:function(a){PubSub.publish("sc:action",{context:a,label:"facebook "+a})},initialize:function(){$j(function(){PubSub.subscribe("sc:action",Stats_SiteCatalyst.onScAction)})}};Stats_SiteCatalyst.initialize();var TimeTracker=function(a){if(a){this.bucket_=a.sort(this.sortNumber)}else{this.bucket_=TimeTracker.DEFAULT_BUCKET}};TimeTracker.prototype.startTime_;TimeTracker.prototype.stopTime_;TimeTracker.prototype.bucket_;TimeTracker.DEFAULT_BUCKET=[100,500,1500,2500,5000];TimeTracker.prototype._getTimeDiff=function(){return(this.stopTime_-this.startTime_)};TimeTracker.prototype.sortNumber=function(d,c){return(d-c)};TimeTracker.prototype._recordStartTime=function(a){if(a!=undefined){this.startTime_=a}else{this.startTime_=(new Date()).getTime()}};TimeTracker.prototype._recordEndTime=function(a){if(a!=undefined){this.stopTime_=a}else{this.stopTime_=(new Date()).getTime()}};TimeTracker.prototype._track=function(f,a,c){var e;if(a!=undefined&&a.length!=0){e=f._createEventTracker(a)}else{e=f._createEventTracker("TimeTracker")}var d;var b;for(d=0;d<this.bucket_.length;d++){if((this._getTimeDiff())<this.bucket_[d]){if(d==0){b="0-"+(this.bucket_[0]);break}else{b=this.bucket_[d-1]+"-"+(this.bucket_[d]-1);break}}}if(!b){b=this.bucket_[d-1]+"+"}e._trackEvent(b,c,this._getTimeDiff())};TimeTracker.prototype._setHistogramBuckets=function(a){this.bucket_=a.sort(this.sortNumber)};var DM_Widget_PageItem_Video_Preview={item:null,container:null,sprite1:null,sprite2:null,state:0,step:0,total:0,timer:-1,infosTimer:null,flyoutTimer:null,flyoutEnabled:!/dm_page_html_videos\b/.test(document.body.className)||$j("#dual_list").hasClass("grid_view"),flyoutPositions:[],flyoutElts:[],initEvents:function(b){DM_Widget_PageItem_Video_Preview.$videoListItems=null;var a=b?$j(b+" div.dmpi_video_preview"):$j("div.dmpi_video_preview");a.each(function(){if(this.observed){return}this.observed=true;$j(this).on({mouseenter:DM_Widget_PageItem_Video_Preview.onPreviewEnter,mouseleave:DM_Widget_PageItem_Video_Preview.onPreviewLeave}).on("click","span.js-wl_chkbx",DM_Widget_PageItem_Video_Preview.addToWatchLater)})},onPreviewEnter:function(b){var a=this;DM_Widget_PageItem_Video_Preview.overTO=setTimeout(function(){var d=$j(a),c=d.find("div.psprite");if(c[0]){DM_Widget_PageItem_Video_Preview.onSpriteOver(c)}if(d.data("flyout")){DM_Widget_PageItem_Video_Preview.showFlyout(d)}DM_Widget_PageItem_Video_Preview.overTO=null},200)},onPreviewLeave:function(b){if(DM_Widget_PageItem_Video_Preview.overTO){clearTimeout(DM_Widget_PageItem_Video_Preview.overTO);DM_Widget_PageItem_Video_Preview.overTO=null;return}var c=$j(this);var a=c.find("div.psprite"),d=c.data("flyout");if(a[0]){DM_Widget_PageItem_Video_Preview.onSpriteOut(a)}if(d){DM_Widget_PageItem_Video_Preview.hideFlyout(c)}},onSpriteOver:function(a){DM_Widget_PageItem_Video_Preview.$psprite=a;DM_Widget_PageItem_Video_Preview.state=0;DM_Widget_PageItem_Video_Preview.total=a.hasClass("pmode8")?8:4;window.clearTimeout(DM_Widget_PageItem_Video_Preview.timer);DM_Widget_PageItem_Video_Preview.timer=window.setTimeout(function(){DM_Widget_PageItem_Video_Preview.spriteAnimate()},0)},onSpriteOut:function(a){window.clearTimeout(DM_Widget_PageItem_Video_Preview.timer);if(DM_Widget_PageItem_Video_Preview.$container){DM_Widget_PageItem_Video_Preview.$container.remove();DM_Widget_PageItem_Video_Preview.$container=null}},spriteAnimate:function(){switch(this.state){case 0:var b=0;if(typeof DM_Widget_PageItem_Video_Preview_SpriteOffset!="undefined"){b=DM_Widget_PageItem_Video_Preview_SpriteOffset}this.resizerEnabled=$j("#bodyall").hasClass("resizer_enabled");this.$img=this.$psprite.parent().find("img");this.path=this.$img.data("spr");this.itemWidth=this.$psprite.width();this.itemHeight=this.$psprite.height();this.previewHeight=this.$img.height();this.spriteStep=Math.floor(this.itemWidth*120/160);this.spriteHeight=this.spriteStep*this.total;this.spriteTopOffset=Math.floor((this.spriteStep-this.itemHeight)/2);this.$container=$j('<div id="psprite_container">').css({position:"absolute",overflow:"hidden",top:-(this.spriteTopOffset+b)+"px",left:b+"px",width:this.itemWidth+"px",height:(this.itemHeight+this.spriteTopOffset)+"px",display:"none"});this.$sprite2=$j('<img src="'+this.path+'" data-spriteid="2">').css({position:"absolute",border:"none",marginTop:0,width:this.itemWidth+"px",height:this.spriteHeight+"px",display:"none"});this.$psprite.before(this.$container.append(this.$sprite2));this.state++;break;case 1:var a=this.$sprite2[0];if(a.complete||(typeof(a.naturalWidth)!="undefined"&&a.naturalWidth!==0)){this.$sprite1=$j('<img src="'+this.path+'" data-spriteid="1">').css({position:"absolute",border:"none",marginTop:0,width:this.itemWidth+"px",height:this.spriteHeight+"px",display:"none"});this.$container.prepend(this.$sprite1).css({display:"block"});this.state++;this.step=0;this.$sprite2.fadeIn(400)}break;case 2:this.step++;if(this.step>=this.total){this.step=0}this.$sprite1.show().css({opacity:1});if(DM_Widget_PageItem_Video_Preview.step%2){this.$sprite1.css({top:"-"+(this.step*this.spriteStep)+"px"});this.$sprite2.fadeOut(400)}else{this.$sprite2.css({top:"-"+(this.step*this.spriteStep)+"px"}).fadeIn(400)}break}this.timer=window.setTimeout(function(){DM_Widget_PageItem_Video_Preview.spriteAnimate()},this.state==1?50:1000)},showFlyout:function(a){if(!DM_Widget_PageItem_Video_Preview.flyoutEnabled){return}DM_Widget_PageItem_Video_Preview.infosTimer=window.setTimeout(function(){DM_Widget_PageItem_Video_Preview.displayFlyout(a)},300)},hideFlyout:function(a){if(!DM_Widget_PageItem_Video_Preview.flyoutEnabled){return}DM_Widget_PageItem_Video_Preview.removeFlyout();window.clearTimeout(DM_Widget_PageItem_Video_Preview.infosTimer);DM_Widget_PageItem_Video_Preview.infosTimer=null},activateFlyout:function(){DM_Widget_PageItem_Video_Preview.flyoutEnabled=true},deactivateFlyout:function(){DM_Widget_PageItem_Video_Preview.flyoutEnabled=false},removeFlyout:function(b){var a=$j("#video_flyout_box");if(a[0]){if(b||DM_Widget_PageItem_Video_Preview.flyoutElts.indexOf(b)==-1){a.remove();DM_Widget_PageItem_Video_Preview.flyoutElts.clear()}}},getFlyoutPositionForItem:function(d){DM_Widget_PageItem_Video_Preview.nbItemsPerLine=(DM_Widget_PageItem_Video_Preview.nbItemsPerLine||(Math.floor(d.parent().width()/d.width())));var c=DM_Widget_PageItem_Video_Preview.nbItemsPerLine,b=[0,3];if(c==1){b=[]}var e=d.find(".dmpi_video_preview"),a=DM_Widget_PageItem_Video_Preview.getVideoListItems().index(e)+1;if(b.indexOf(a%c)!=-1){return"left"}return"right"},displayFlyout:function(g){if(DM_Widget_PageItem_Video_Preview.flyoutElts.indexOf(g)==-1){var e=g.width()+12,d=0,f="left",k=g.closest(".dmpi_video_item");if(DM_Widget_PageItem_Video_Preview.getFlyoutPositionForItem(k)=="left"){e=-321;f="right"}if($j.layout!="gecko"){d=$j(window).scrollTop()}var j='<div class="video_flyout_box_content">'+k.html()+'<div class="stem_'+f+'"></div></div>',a=$j('<div id="video_flyout_box" class="background">');a.html(j);var c=g.offset();a.css({left:c.left+e+"px",top:c.top+"px"});var h=a.find("div.dmpi_video_description")[0];if(h&&h.innerHTML.blank()&&window.DM_Widget_PageItem_Video_Preview_NO_DESCRIPTION){$j(h).html(DM_Widget_PageItem_Video_Preview_NO_DESCRIPTION).addClass("foreground2")}var b=a.find("div.dmco_date");if(b[0]){b.addClass("foreground")}$j(document.body).prepend(a);DM_Widget_PageItem_Video_Preview.flyoutElts.push(a,g)}},getVideoListItems:function(){if(!DM_Widget_PageItem_Video_Preview.$videoListItems){DM_Widget_PageItem_Video_Preview.$videoListItems=$j(".dmpi_video_preview[data-flyout]");if(/dm_page_html_user\b|dm_page_html_hub\b/.test(document.body.className)){DM_Widget_PageItem_Video_Preview.$videoListItems=DM_Widget_PageItem_Video_Preview.$videoListItems.add("div.dmpi_video_empty[data-flyout]")}}return DM_Widget_PageItem_Video_Preview.$videoListItems},addToWatchLater:function(c,f){if(c){c.stopPropagation();c.preventDefault()}var b=$j(this);if(f){if(!b.hasClass("remove")){ajax_call("watchlater","add_to_watchlater",f,function(g){DM_Widget_Page.notify($j.parseJSON(g).watchlater_status,"page");b.addClass("remove");if(!b.hasClass("name")){$el.remove()}})}else{ajax_call("watchlater","remove_to_watchlater",f,function(g){b.removeClass("remove");if(!b.hasClass("name")){el.remove()}})}}else{if(!b.data("watched")){var d=b.closest("a"),e=d[0].id||d.findParamInClass("id"),a=d.attr("title");ajax_call("watchlater","add_to_watchlater",e,function(g){b.fadeOut(500,function(){d.next(".duration").css({"margin-top":"25px"});b.removeAttr("style").addClass("wl_done icon-check").removeClass("wl_chkbx").show()});DM_Widget_Page.notify(g.evalJSON(true).watchlater_status,"page");PubSub.publish("sc:action",{context:"watchlater",label:{title:a},});b.data("watched",true)})}}},initialize:function(){$j(function(){if(!window.Sd_Video_PreviewTwig){DM_Widget_PageItem_Video_Preview.initEvents()}})}};DM_Widget_PageItem_Video_Preview.initialize();(function(a){a.tiny=a.tiny||{};a.tiny.scrollbar={options:{axis:"y",wheel:40,scroll:true,lockscroll:true,size:"auto",sizethumb:"auto",invertscroll:false,callbacks:{}}};a.fn.tinyscrollbar=function(d){var c=a.extend({},a.tiny.scrollbar.options,d);this.each(function(){a(this).data("tsb",new b(a(this),c))});return this};a.fn.tinyscrollbar_update=function(c){var d=a(this).data("tsb");if(d){return d.update(c)}return false};function b(u,h){var m=this,x=u,l={obj:a(".viewport",u)},j={obj:a(".overview",u)},e={obj:a(".scrollbar",u)},o={obj:a(".track",e.obj)},t={obj:a(".thumb",e.obj)},n=h.axis==="x",q=n?"left":"top",z=n?"Width":"Height",v=0,C={start:0,now:0},r={},f="ontouchstart" in document.documentElement;function c(){m.update();w();return m}this.update=function(D){l[h.axis]=l.obj[0]["offset"+z];j[h.axis]=j.obj[0]["scroll"+z];j.ratio=l[h.axis]/j[h.axis];e.obj.toggleClass("disable",j.ratio>=1);o[h.axis]=h.size==="auto"?l[h.axis]:h.size;t[h.axis]=Math.min(o[h.axis],Math.max(0,(h.sizethumb==="auto"?(o[h.axis]*j.ratio):h.sizethumb)));e.ratio=h.sizethumb==="auto"?(j[h.axis]/o[h.axis]):(j[h.axis]-l[h.axis])/(o[h.axis]-t[h.axis]);v=(D==="relative"&&j.ratio<=1)?Math.min((j[h.axis]-l[h.axis]),Math.max(0,v)):0;v=(D==="bottom"&&j.ratio<=1)?(j[h.axis]-l[h.axis]):isNaN(parseInt(D,10))?v:parseInt(D,10);A()};function A(){var D=z.toLowerCase();t.obj.css(q,v/e.ratio);j.obj.css(q,-v);r.start=t.obj.offset()[q];e.obj.css(D,o[h.axis]);o.obj.css(D,o[h.axis]);t.obj.css(D,t[h.axis])}function w(){if(!f){t.obj.bind("mousedown",k);o.obj.bind("mouseup",y)}else{l.obj[0].ontouchstart=function(D){if(1===D.touches.length){k(D.touches[0]);D.stopPropagation()}}}if(h.scroll&&window.addEventListener){x[0].addEventListener("DOMMouseScroll",B,false);x[0].addEventListener("mousewheel",B,false);x[0].addEventListener("MozMousePixelScroll",function(D){D.preventDefault()},false)}else{if(h.scroll){x[0].onmousewheel=B}}}function k(E){a("body").addClass("noSelect");var D=parseInt(t.obj.css(q),10);r.start=n?E.pageX:E.pageY;C.start=D=="auto"?0:D;if(!f){a(document).bind("mousemove",y);a(document).bind("mouseup",g);t.obj.bind("mouseup",g)}else{document.ontouchmove=function(F){F.preventDefault();y(F.touches[0])};document.ontouchend=g}}function B(F){if(j.ratio<1){var E=F||window.event,D=E.wheelDelta?E.wheelDelta/120:-E.detail/3;v-=D*h.wheel;v=Math.min((j[h.axis]-l[h.axis]),Math.max(0,v));t.obj.css(q,v/e.ratio);j.obj.css(q,-v);if(h.lockscroll||(v!==(j[h.axis]-l[h.axis])&&v!==0)){E=a.event.fix(E);E.preventDefault()}s()}}function y(D){if(j.ratio<1){if(h.invertscroll&&f){C.now=Math.min((o[h.axis]-t[h.axis]),Math.max(0,(C.start+(r.start-(n?D.pageX:D.pageY)))))}else{C.now=Math.min((o[h.axis]-t[h.axis]),Math.max(0,(C.start+((n?D.pageX:D.pageY)-r.start))))}v=C.now*e.ratio;j.obj.css(q,-v);t.obj.css(q,C.now);s()}}function g(){a("body").removeClass("noSelect");a(document).unbind("mousemove",y);a(document).unbind("mouseup",g);t.obj.unbind("mouseup",g);document.ontouchmove=document.ontouchend=null}function d(){if(j.obj.offset().top+j.obj.height()<=l.obj.offset().top+l.obj.height()){return true}return false}function s(){for(var D in h.callbacks){if(typeof h.callbacks[D]!=="function"){return}if(D==="onContentEndReached"){if(d()){h.callbacks[D]()}}}}return c()}}(jQuery));var Sd_Ticker={maximizedByClick:false,feedPageEmpty:false,feedPage:1,pageCountBeforeFoldingFriends:5,feedPageOnGoingCall:false,needsFeedData:true,needsFriendsData:true,isFBLogged:false,needsFadeOutId:null,isMouseDown:false,width:220,widthThreshold:1280,bottomBarHeight:36,callToFBConnectHeight:240,titleHeight:36,feedPercent:60,friendPercent:40,isScrollbarVisible:false,$clickedScrollbar:null,cache:{enable:true,suffix:null,feedKey:"ticker_feed",friendsKey:"ticker_friends",fbFriendsKey:"ticker_fbFriends",get:function(b){if(!Sd_Ticker.cache.isAvailable()){return null}return localStorage.getItem(b+Sd_Ticker.cache.suffix)},set:function(f,e,g){if(!Sd_Ticker.cache.isAvailable()){return null}try{localStorage.setItem(f+Sd_Ticker.cache.suffix,$j.toJSONString({data:e,expire:new Date().getTime()+g}))}catch(h){Sd_Ticker.log("error while doing localStorage.setItem");Sd_Ticker.log(h)}return null},clear:function(){var d=[];for(var c=0;c<localStorage.length;c++){if(localStorage.key(c).match(/^ticker/)!==null){d.push(localStorage.key(c))}}for(c=0;c<d.length;c++){localStorage.removeItem(d[c])}Sd_Ticker.log("Ticker cache cleared.")},supports_html5_storage:function(){try{return"localStorage" in window&&window.localStorage!==null}catch(b){return false}},isAvailable:function(){return Sd_Ticker.cache.supports_html5_storage()&&Sd_Ticker.cache.enable===true}},showTooltip:function(w){var q=$j(this),u=$j.parseJSON(q.attr("data-tooltip")),o=q.offset().top-w.data.container.offset().top,m="";price="";u.vszone="ticker-tooltip-"+u.type;u.desc=$j("<div>").html($j("<div>").html(u.desc).text()).text();if(u.type=="user.joinGroup"||u.type=="user.subscribeUser"){m='<div class="counter"><%=data.counter%></div>'}if(u.price!==null){price='<div class="pricetag"><%=data.price%></div>'}var s='<div id="ticker_tooltip" class="<%=data.objclass.toLowerCase()%> <%=data.type.replace(\'.\', \'_\')%>"><div class="arrow"></div><div class="media clearfix">%%sublayout%%</div></div>',n='<div class="media main clearfix"><a href="<%=data.link%>" data-vszone="<%=data.vszone%>" class="<%=(data.objclass.toLowerCase() == "dm_video" ? "imgblock" : "img")%>" style="width:<%=data.image.width%>px; height:<%=data.image.height%>px;"><img src="<%=data.image.url%>" width="<%=data.image.width%>" height="<%=data.image.height%>" alt="" />'+price+'<div class="play"></div><div class="live">LIVE</div></a><div class="bd"><a href="<%=data.link%>" data-vszone="<%=data.vszone%>" class="tooltip_title"><%=data.title%></a>'+m+"</div></div>%%tpl%%",l='<div class="media main clearfix"><% for (var i = 0; data.videos && i < data.videos.length; i++) { %><a href="<%=data.videos[i].link%>" data-vszone="<%=data.vszone%>" class="img"><img src="<%=data.videos[i].image.url%>" width="<%=data.videos[i].image.width%>" height="<%=data.videos[i].image.height%>" alt="" /><div class="play"></div></a><% } %><div class="bd"><a href="<%=data.link%>" class="name" data-vszone="<%=data.vszone%>"><%=data.title%></a></div></div>%%tpl%%',t=n,r=null;switch(u.type){case"user.joinGroup":case"user.subscribeUser":r='<div class="tpl subscribe"><div id="subscribe_button_ph"></div></div>';break;case"user.addComment":r='<div class="tpl comment"><div class="desc"><%=data.desc%></div><div class="media clearfix"><a href="<%=data.poster_link%>" class="img"><img src="<%=data.poster_avatar.url%>" width="<%=data.poster_avatar.width%>" height="<%=data.poster_avatar.height%>" alt="" /></a><div class="bd clearfix"><div class="message"><div class="comment"><%=data.comment%></div><div class="date_created"><%=data.date_created%></div></div></div></div></div>';break;case"user.rateVideo":r='<div class="tpl"><div class="desc"><%=data.desc%></div><div class="date_created"><%=data.date_created%></div><div class="action"><%=data.action%></div></div>';break;case"user.addVideoToPlaylist":t=l;r='<div class="tpl"><div class="counter"><%=data.counter%></div><div class="date_created"><%=data.date_created%></div></div>';break;default:r='<div class="tpl"><div class="desc"><%=data.desc%></div><div class="date_created"><%=data.date_created%></div></div>';break}Sd_Ticker.removeTooltip();w.data.container.append($j.tmpl(s.replace("%%sublayout%%",t).replace("%%tpl%%",r),u));var v=$j("#ticker_tooltip");if(u.type==="user.subscribeUser"){v.find("#subscribe_button_ph").replaceWith(q.find(".subscribe_button").clone())}v.css({top:o+"px"})},handleFeedItemClick:function(){document.location.href=$j.parseJSON($j(this).attr("data-tooltip")).link},loadFeedNextPage:function(){if(Sd_Ticker.feedPageEmpty){return}if(Sd_Ticker.feedPageOnGoingCall===true){return}Sd_Ticker.feedPageOnGoingCall=true;Sd_Ticker.feedPage++;$j("#feed_page_loader").addClass("loading");DM_WidgetV3.get("/controller/Shared_Ticker","#feed_page_ph",null,{feed:1,"feed-page":Sd_Ticker.feedPage},function(b){$j("#feed_page_loader").removeClass("loading");if(b.responseText===""){Sd_Ticker.feedPageEmpty=true;return}Sd_Ticker.feedPageOnGoingCall=false;$j("#scrollable_feed_section").tinyscrollbar_update("relative");if(Sd_Ticker.needsFeedRefill()){Sd_Ticker.loadFeedNextPage()}})},handleCloseFBCall:function(){setCookie("tchfb","1",7);$j("#fbc_call").remove();Sd_Ticker.setActivitiesHeight();Sd_Ticker.cache.clear()},removeTooltip:function(){$j("#ticker_tooltip").remove()},setMaximized:function(){var b=$j("#ticker");if($j(window).width()<=Sd_Ticker.widthThreshold){b.addClass("medium");$j("#bodyall").removeClass("tickermaxi");PubSub.publish("ticker:mediumized")}else{b.removeClass("medium");$j("#bodyall").addClass("tickermaxi");PubSub.publish("ticker:maximized",Sd_Ticker.maximizedByClick)}b.removeClass("minimized");deleteCookie("tickermini");if(Sd_Ticker.needsFeedData){Sd_Ticker.getFeed()}else{Sd_Ticker.setActivitiesHeight(false)}if(Sd_Ticker.needsFriendsData){Sd_Ticker.getFriends()}else{Sd_Ticker.setActivitiesHeight(false)}},setMinimized:function(b){$j("#ticker").addClass("minimized").removeClass("medium");$j("#bodyall").removeClass("tickermaxi");if(b){setCookie("tickermini","1","365")}PubSub.publish("ticker:minimized")},toggleSize:function(){if($j("#ticker").hasClass("minimized")){Sd_Ticker.maximizedByClick=true;Sd_Ticker.setMaximized()}else{Sd_Ticker.setMinimized(true);Sd_Ticker.maximizedByClick=false;var b="Minimize ticker "+($j(window).width()>=1280?"more than 1280":"less than 1280");PubSub.publish("sc:action",{context:"ticker",label:{action:"minimize",name:b}})}},initSize:function(){if(getCookie("tickermini")||$j(window).width()<=Sd_Ticker.widthThreshold||Sd_Ticker.needHide()){Sd_Ticker.setMinimized(false)}else{Sd_Ticker.setMaximized()}},needsFriendsFolding:function(){return localStorage.getItem("page_count")>Sd_Ticker.pageCountBeforeFoldingFriends},setActivitiesHeight:function(m,g){if(typeof g==="undefined"){g=false}var j=null;var l=null;if($j("#ticker").hasClass("medium")){j=Math.round(document.viewport.getHeight()*(3/4))}else{j=document.viewport.getHeight()}if(!g){if(Sd_Ticker.needsFriendsFolding()){Sd_Ticker.setFriendPercentSize(0);l=j-(Sd_Ticker.titleHeight*2+Sd_Ticker.bottomBarHeight)}else{if($j("#fbc_call").length!==0&&$j(window).width()>Sd_Ticker.widthThreshold){Sd_Ticker.setFeedPercentSize(100);l=j-(Sd_Ticker.callToFBConnectHeight+Sd_Ticker.titleHeight+Sd_Ticker.bottomBarHeight)}else{if($j("#friend_section").length===0){Sd_Ticker.setFeedPercentSize(100);l=j-(Sd_Ticker.titleHeight+Sd_Ticker.bottomBarHeight)}else{Sd_Ticker.setFeedPercentSize(60);l=j-(Sd_Ticker.titleHeight*2+Sd_Ticker.bottomBarHeight)}}}}else{l=j-(Sd_Ticker.titleHeight*2+Sd_Ticker.bottomBarHeight)}var h=Math.round(l*Sd_Ticker.feedPercent/100);var k=Math.round(l*Sd_Ticker.friendPercent/100);$j("#activities_cont").css("height",(j-Sd_Ticker.bottomBarHeight)+"px");if(m){$j("#feed_section").animate({height:h+"px"},{step:$j.proxy(Sd_Ticker.resizeScrollbar,$j("#scrollable_feed_section"))});if($j("#friend_section").length){$j("#friend_section").animate({height:k+"px"},{step:$j.proxy(Sd_Ticker.resizeScrollbar,$j("#scrollable_friend_section"))})}}else{if($j("#feed_section").length){$j("#feed_section").css("height",h+"px");Sd_Ticker.resizeScrollbar.apply($j("#scrollable_feed_section"))}if($j("#friend_section").length){$j("#friend_section").css("height",k+"px");Sd_Ticker.resizeScrollbar.apply($j("#scrollable_friend_section"))}}},resizeScrollbar:function(){this.tinyscrollbar_update("relative")},needHide:function(){return Sd_Ticker.mc_right_visible},handleWindowResize:function(b){if(getCookie("tickermini")){return}if($j(window).width()<=Sd_Ticker.widthThreshold||Sd_Ticker.needHide()){if(!Sd_Ticker.maximizedByClick){Sd_Ticker.setMinimized(false)}}else{Sd_Ticker.setMaximized();Sd_Ticker.maximizedByClick=false}if(Sd_Ticker.needsFeedRefill()){Sd_Ticker.loadFeedNextPage()}},handleClickOnFriend:function(g){var e=$j(g.target),h="";g.stopPropagation();if(e.hasClass("sd_user_subscribe")||e.closest(".sd_user_subscribe").length){PubSub.publish("sc:action",{context:"ticker",label:{action:"subscribe",name:"Subscribed"}});var f=e.closest(".media.friend");f.find(".opacity_handler").remove();f.find(".addto_small").remove();f.find(".checked_sign").show();$j("#feed_reloaded").show();Sd_Ticker.cache.clear();Sd_Ticker.getFeed();return}if(e.find("a.img").length){h=e.find("a.img").attr("href")}else{if(e.closest(".media.friend").find("a.img").length){h=e.closest(".media.friend").find("a.img").attr("href")}}if(h.length){document.location.href=h}},handleClickOnFeedTitle:function(){Sd_Ticker.setMinimized(true)},setFriendPercentSize:function(f,d,e){Sd_Ticker.feedPercent=100-f;Sd_Ticker.friendPercent=f},setFeedPercentSize:function(f,d,e){Sd_Ticker.feedPercent=f;Sd_Ticker.friendPercent=100-f},handleClickOnFriendTitle:function(d){var c=Sd_Ticker.friendPercent===0?40:0;if(c>0){localStorage.setItem("page_count",0)}else{localStorage.setItem("page_count",Sd_Ticker.pageCountBeforeFoldingFriends)}Sd_Ticker.setFriendPercentSize(c);Sd_Ticker.setActivitiesHeight(true,true)},handleMouseenterScrollbar:function(d){if(Sd_Ticker.isScrollbarVisible===true&&Sd_Ticker.needsFadeOutId!==null){clearTimeout(Sd_Ticker.needsFadeOutId);return}var c=$j(this);if($j(d.currentTarget).hasClass("scrollable_content")){Sd_Ticker.needsFadeOutId=setTimeout(function(){return Sd_Ticker.fadeOut(c)},1000)}Sd_Ticker.fadeIn(c)},handleMouseleaveScrollbar:function(){if(Sd_Ticker.isScrollbarVisible===false||Sd_Ticker.isMouseDown===true){return}Sd_Ticker.fadeOut($j(this));Sd_Ticker.isScrollbarVisible=false},handleMousedownScrollbar:function(b){b.stopPropagation();Sd_Ticker.$clickedScrollbar=$j(this);Sd_Ticker.isMouseDown=true;$j(document).on("mouseup",Sd_Ticker.handleMouseupScrollbar)},handleMouseupScrollbar:function(c){var d=$j(c.target);Sd_Ticker.isMouseDown=false;if(!d.hasClass("track")&&!d.hasClass("thumb")){Sd_Ticker.fadeOut(Sd_Ticker.$clickedScrollbar);Sd_Ticker.isScrollbarVisible=false}$j(document).off("mouseup",Sd_Ticker.handleMouseupScrollbar)},toggleFriendOpacity:function(){$j(this).siblings(".opacity_handler").toggle()},fadeOut:function(b){b.animate({opacity:0});Sd_Ticker.isScrollbarVisible=false},fadeIn:function(b){b.animate({opacity:1});Sd_Ticker.isScrollbarVisible=true},getFeedCallback:function(e){if(e!==null){Sd_Ticker.cache.set(Sd_Ticker.cache.feedKey,e.responseText,120000)}var f=$j("#ticker"),g=$j("#feed_scrollbar"),h=$j("#scrollable_feed_section");h.tinyscrollbar({sizethumb:50,callbacks:{onContentEndReached:Sd_Ticker.loadFeedNextPage}});Sd_Ticker.setActivitiesHeight(false);if(!$j("html").hasClass("ie")){h.on("mouseenter",$j.proxy(Sd_Ticker.handleMouseenterScrollbar,g));g.on({mouseenter:Sd_Ticker.handleMouseenterScrollbar,mouseleave:Sd_Ticker.handleMouseleaveScrollbar,mousedown:Sd_Ticker.handleMousedownScrollbar,mousedown:Sd_Ticker.removeTooltip});g.find(".thumb").on("mousedown",$j.proxy(Sd_Ticker.handleMousedownScrollbar,g)).on("mousedown",Sd_Ticker.removeTooltip)}f.on("mouseenter",".media.feed",{container:$j("#scrollable_feed_section")},Sd_Ticker.showTooltip).on("click",".media.feed",Sd_Ticker.handleFeedItemClick);h.on("mouseleave",Sd_Ticker.removeTooltip);$j("#feed_title").on("click",Sd_Ticker.handleClickOnFeedTitle);$j("#fbc_call_close").on("click",Sd_Ticker.handleCloseFBCall);$j("#feed_reloaded").hide();if(Sd_Ticker.needsFeedRefill()){Sd_Ticker.loadFeedNextPage()}},getFriendsCallback:function(f){if(f!==null){Sd_Ticker.cache.set(Sd_Ticker.cache.friendsKey,f.responseText,120000)}var d=$j("#friend_scrollbar"),e=$j("#scrollable_friend_section");e.tinyscrollbar({sizethumb:50});Sd_Ticker.setActivitiesHeight(false);if(!$j("html").hasClass("ie")){e.on("mouseenter",$j.proxy(Sd_Ticker.handleMouseenterScrollbar,d));d.on("mouseenter",Sd_Ticker.handleMouseenterScrollbar).on("mouseleave",Sd_Ticker.handleMouseleaveScrollbar).on("mousedown",Sd_Ticker.handleMousedownScrollbar);d.find(".thumb").on("mousedown",$j.proxy(Sd_Ticker.handleMousedownScrollbar,d))}$j("#friend_title").on("click",Sd_Ticker.handleClickOnFriendTitle);$j("#ticker .media.friend").on("click",Sd_Ticker.handleClickOnFriend);$j("#ticker .media.friend .addto_small").on("mouseenter",Sd_Ticker.toggleFriendOpacity).on("mouseleave",Sd_Ticker.toggleFriendOpacity)},getFeed:function(){var b=Sd_Ticker.cache.get(Sd_Ticker.cache.feedKey);Sd_Ticker.needsFeedData=false;if(b){b=b.evalJSON();if(b.expire>=new Date().getTime()){if($j("#feed_placeholder").length){$j("#feed_placeholder").replaceWith(b.data)}Sd_Ticker.getFeedCallback(null);return}}DM_WidgetV3.get("/controller/Shared_Ticker","#feed_placeholder",null,{feed:1},Sd_Ticker.getFeedCallback)},getFriends:function(){if(!Sd_Ticker.isFBLogged){return}var b=Sd_Ticker.cache.get(Sd_Ticker.cache.fbFriendsKey);Sd_Ticker.needsFriendsData=false;if(b){Sd_Ticker.getFriendsOnDM(b)}else{FB.api("/me/friends?fields=id,name,picture",function(a){if(!a||a.error){return}Sd_Ticker.cache.set(Sd_Ticker.cache.fbFriendsKey,a,86400000);Sd_Ticker.getFriendsOnDM(a)})}},getFriendsOnDM:function(d){var c=Sd_Ticker.cache.get(Sd_Ticker.cache.friendsKey);if(c){c=c.evalJSON();if(c.expire>=new Date().getTime()){if($j("#friends_placeholder").length){$j("#friends_placeholder").replaceWith(c.data)}Sd_Ticker.getFriendsCallback(null);return}}DM_WidgetV3.get("/controller/Shared_Ticker","#friends_placeholder",null,{friends:1,data:$j.toJSONString({data:d.data})},Sd_Ticker.getFriendsCallback,"post")},log:function(b){if(typeof console==="undefined"){return}if(DM_Environment==="prod"){return}console.log(b)},needsFeedRefill:function(){if($j("#feed_empty_message").length>0){return false}return $j("#feed_section").height()>$j("#feed_section .overview").height()},onMasscastStatus:function(c,d){if(c!="Right"){return}if(d=="handled"){Sd_Ticker.mc_right_visible=true;Sd_Ticker.initSize()}},initialize:function(){PubSub.subscribe("masscast:position_status",Sd_Ticker.onMasscastStatus);var b=parseInt(localStorage.getItem("page_count"),10)||0;localStorage.setItem("page_count",++b);$j(function(){if(typeof Sd_Ticker_enabled==="undefined"){return}if(!Sd_Ticker_enabled||top!==self){return}if(getCookie("login_infos")!==null){Sd_Ticker.cache.suffix="_"+getCookie("login_infos").evalJSON().login}else{Sd_Ticker.cache.suffix="_anon"}if(typeof Request.getQueryParams(document.location.search).fbc!=="undefined"){Sd_Ticker.cache.clear()}$j(window).on("resize",Sd_Ticker.handleWindowResize);PubSub.subscribe("dm:fb_logged",function(){return Sd_Ticker.isFBLogged=true});$j("#minimize, #maximize").on("click",Sd_Ticker.toggleSize);Sd_Ticker.initSize();if(!getCookie("tickermini")&&!$j("#ticker").hasClass("minimized")){PubSub.subscribe("dm:fb_logged",function(){Sd_Ticker.getFriends()})}if(typeof DM_KeyHandler!=="undefined"){DM_KeyHandler.registerAction("tcc",DM_KeyHandler.shift,Sd_Ticker.cache.clear)}})}};Sd_Ticker.initialize();BOOMR_start=new Date().getTime();(function(a){if(a.parent!==a&&document.getElementById("boomr-if-as")&&document.getElementById("boomr-if-as").nodeName.toLowerCase()==="script"){a=a.parent}var e,c,b,f=a.document;if(a.BOOMR===undefined){a.BOOMR={}}BOOMR=a.BOOMR;if(BOOMR.version){return}BOOMR.version="0.9";BOOMR.window=a;e={beacon_url:"",site_domain:a.location.hostname.replace(/.*?([^.]+\.[^.]+)\.?$/,"$1").toLowerCase(),user_ip:"",onloadfired:false,handlers_attached:false,events:{page_ready:[],page_unload:[],dom_loaded:[],visibility_changed:[],before_beacon:[],click:[]},vars:{},disabled_plugins:{},onclick_handler:function(d){var g;if(!d){d=a.event}if(d.target){g=d.target}else{if(d.srcElement){g=d.srcElement}}if(g.nodeType===3){g=g.parentNode}if(g&&g.nodeName.toUpperCase()==="OBJECT"&&g.type==="application/x-shockwave-flash"){return}e.fireEvent("click",g)},fireEvent:function(d,k){var g,j,l;if(!this.events.hasOwnProperty(d)){return false}l=this.events[d];for(g=0;g<l.length;g++){j=l[g];j[0].call(j[2],k,j[1])}return true},addListener:function(g,h,d){if(g.addEventListener){g.addEventListener(h,d,false)}else{if(g.attachEvent){g.attachEvent("on"+h,d)}}}};c={t_start:BOOMR_start,t_end:null,utils:{objectToString:function(j,h){var g=[],d;if(!j||typeof j!=="object"){return j}if(h===undefined){h="\n\t"}for(d in j){if(Object.prototype.hasOwnProperty.call(j,d)){g.push(encodeURIComponent(d)+"="+encodeURIComponent(j[d]))}}return g.join(h)},getCookie:function(d){if(!d){return null}d=" "+d+"=";var g,h;h=" "+f.cookie+";";if((g=h.indexOf(d))>=0){g+=d.length;h=h.substring(g,h.indexOf(";",g));return h}return null},setCookie:function(h,j,d){var k,g,m,l;if(!h||!e.site_domain){return false}k=this.objectToString(j,"&");g=h+"="+k;m=[g,"path=/","domain="+e.site_domain];if(d){l=new Date();l.setTime(l.getTime()+d*1000);l=l.toGMTString();m.push("expires="+l)}if(g.length<4000){f.cookie=m.join("; ");return(k===this.getCookie(h))}return false},getSubCookies:function(j){var h,g,d,m,k={};if(!j){return null}h=j.split("&");if(h.length===0){return null}for(g=0,d=h.length;g<d;g++){m=h[g].split("=");m.push("");k[decodeURIComponent(m[0])]=decodeURIComponent(m[1])}return k},removeCookie:function(d){return this.setCookie(d,{},0)},pluginConfig:function(l,d,j,h){var g,k=0;if(!d||!d[j]){return false}for(g=0;g<h.length;g++){if(d[j][h[g]]!==undefined){l[h[g]]=d[j][h[g]];k++}}return(k>0)}},init:function(g){var j,d,h=["beacon_url","site_domain","user_ip"];if(!g){g={}}for(j=0;j<h.length;j++){if(g[h[j]]!==undefined){e[h[j]]=g[h[j]]}}if(g.log!==undefined){this.log=g.log}if(!this.log){this.log=function(){}}for(d in this.plugins){if(this.plugins.hasOwnProperty(d)){if(g[d]&&g[d].hasOwnProperty("enabled")&&g[d].enabled===false){e.disabled_plugins[d]=1;continue}else{if(e.disabled_plugins[d]){delete e.disabled_plugins[d]}}if(typeof this.plugins[d].init==="function"){this.plugins[d].init(g)}}}if(e.handlers_attached){return this}if(!e.onloadfired&&(g.autorun===undefined||g.autorun!==false)){if(f.readyState&&f.readyState==="complete"){this.setImmediate(BOOMR.page_ready,null,null,BOOMR)}else{if(a.onpagehide||a.onpagehide===null){e.addListener(a,"pageshow",BOOMR.page_ready)}else{e.addListener(a,"load",BOOMR.page_ready)}}}e.addListener(a,"DOMContentLoaded",function(){e.fireEvent("dom_loaded")});(function(){var k=function(){e.fireEvent("visibility_changed")};if(f.webkitVisibilityState){e.addListener(f,"webkitvisibilitychange",k)}else{if(f.msVisibilityState){e.addListener(f,"msvisibilitychange",k)}else{if(f.visibilityState){e.addListener(f,"visibilitychange",k)}}}e.addListener(f,"mouseup",e.onclick_handler);if(!a.onpagehide&&a.onpagehide!==null){e.addListener(a,"unload",function(){BOOMR.window=a=null})}}());e.handlers_attached=true;return this},page_ready:function(){if(e.onloadfired){return this}e.fireEvent("page_ready");e.onloadfired=true;return this},setImmediate:function(h,j,g,k){var d=function(){h.call(k||null,j,g||{});d=null};if(a.setImmediate){a.setImmediate(d)}else{if(a.msSetImmediate){a.msSetImmediate(d)}else{if(a.webkitSetImmediate){a.webkitSetImmediate(d)}else{if(a.mozSetImmediate){a.mozSetImmediate(d)}else{setTimeout(d,10)}}}}},subscribe:function(d,m,g,o){var j,l,n,k;if(!e.events.hasOwnProperty(d)){return this}n=e.events[d];for(j=0;j<n.length;j++){l=n[j];if(l[0]===m&&l[1]===g&&l[2]===o){return this}}n.push([m,g||{},o||null]);if(d==="page_ready"&&e.onloadfired){this.setImmediate(m,null,g,o)}if(d==="page_unload"){k=function(h){if(m){m.call(o,h||a.event,g)}};if(a.onpagehide||a.onpagehide===null){e.addListener(a,"pagehide",k)}else{e.addListener(a,"unload",k)}e.addListener(a,"beforeunload",k)}return this},addVar:function(g,h){if(typeof g==="string"){e.vars[g]=h}else{if(typeof g==="object"){var j=g,d;for(d in j){if(j.hasOwnProperty(d)){e.vars[d]=j[d]}}}}return this},removeVar:function(g){var d,h;if(!arguments.length){return this}if(arguments.length===1&&Object.prototype.toString.apply(g)==="[object Array]"){h=g}else{h=arguments}for(d=0;d<h.length;d++){if(e.vars.hasOwnProperty(h[d])){delete e.vars[h[d]]}}return this},sendBeacon:function(){var h,j,g,d=0;for(h in this.plugins){if(this.plugins.hasOwnProperty(h)){if(e.disabled_plugins[h]){continue}if(!this.plugins[h].is_complete()){return this}}}e.vars.v=BOOMR.version;e.vars.u=f.URL.replace(/#.*/,"");if(a!==window){e.vars["if"]=""}e.fireEvent("before_beacon",e.vars);if(!e.beacon_url){return this}j=[];for(h in e.vars){if(e.vars.hasOwnProperty(h)){d++;j.push(encodeURIComponent(h)+"="+(e.vars[h]===undefined||e.vars[h]===null?"":encodeURIComponent(e.vars[h])))}}j=e.beacon_url+((e.beacon_url.indexOf("?")>-1)?"&":"?")+j.join("&");BOOMR.debug("Sending url: "+j.replace(/&/g,"\n\t"));if(d){g=new Image();g.src=j}return this}};delete BOOMR_start;(function(){var d=function(g){return function(h,j){this.log(h,g,"boomerang"+(j?"."+j:""));return this}};c.debug=d("debug");c.info=d("info");c.warn=d("warn");c.error=d("error")}());if(a.YAHOO&&a.YAHOO.widget&&a.YAHOO.widget.Logger){c.log=a.YAHOO.log}else{if(a.Y&&a.Y.log){c.log=a.Y.log}else{if(typeof console==="object"&&console.log!==undefined){c.log=function(d,g,h){console.log(h+": ["+g+"] "+d)}}}}for(b in c){if(c.hasOwnProperty(b)){BOOMR[b]=c[b]}}BOOMR.plugins=BOOMR.plugins||{}}(window));(function(){BOOMR=BOOMR||{};BOOMR.plugins=BOOMR.plugins||{};var a={complete:false,done:function(){var b=BOOMR.window,f,c,e,d;f=b.performance||b.msPerformance||b.webkitPerformance||b.mozPerformance;if(f&&f.timing&&f.navigation){BOOMR.info("This user agent supports NavigationTiming.","nt");c=f.navigation;e=f.timing;d={nt_red_cnt:c.redirectCount,nt_nav_type:c.type,nt_nav_st:e.navigationStart,nt_red_st:e.redirectStart,nt_red_end:e.redirectEnd,nt_fet_st:e.fetchStart,nt_dns_st:e.domainLookupStart,nt_dns_end:e.domainLookupEnd,nt_con_st:e.connectStart,nt_con_end:e.connectEnd,nt_req_st:e.requestStart,nt_res_st:e.responseStart,nt_res_end:e.responseEnd,nt_domloading:e.domLoading,nt_domint:e.domInteractive,nt_domcontloaded_st:e.domContentLoadedEventStart,nt_domcontloaded_end:e.domContentLoadedEventEnd,nt_domcomp:e.domComplete,nt_load_st:e.loadEventStart,nt_load_end:e.loadEventEnd,nt_unload_st:e.unloadEventStart,nt_unload_end:e.unloadEventEnd};if(e.secureConnectionStart){d.nt_ssl_st=e.secureConnectionStart}if(e.msFirstPaint){d.nt_first_paint=e.msFirstPaint}BOOMR.addVar(d)}if(b.chrome&&b.chrome.loadTimes){e=b.chrome.loadTimes();if(e){d={nt_spdy:(e.wasFetchedViaSpdy?1:0),nt_first_paint:e.firstPaintTime};BOOMR.addVar(d)}}this.complete=true;BOOMR.sendBeacon()}};BOOMR.plugins.NavigationTiming={init:function(){BOOMR.subscribe("page_ready",a.done,null,a);return this},is_complete:function(){return a.complete}}}());(function(a){var c=a.document,b;BOOMR=BOOMR||{};BOOMR.plugins=BOOMR.plugins||{};b={initialized:false,complete:false,timers:{},cookie:"RT",cookie_exp:600,strict_referrer:true,navigationType:0,navigationStart:undefined,responseStart:undefined,t_start:undefined,t_fb_approx:undefined,r:undefined,r2:undefined,setCookie:function(h,e){var g,d=new Date().getTime(),f;if(!this.cookie){return this}f=BOOMR.utils.getSubCookies(BOOMR.utils.getCookie(this.cookie))||{};if(h){f[h]=d}f.r=c.URL.replace(/#.*/,"");if(h==="cl"){if(e){f.nu=e}else{if(f.nu){delete f.nu}}}if(e===false){delete f.nu}BOOMR.debug("Setting cookie "+BOOMR.utils.objectToString(f),"rt");if(!BOOMR.utils.setCookie(this.cookie,f,this.cookie_exp)){BOOMR.error("cannot set start cookie","rt");return this}g=new Date().getTime();if(g-d>50){BOOMR.utils.removeCookie(this.cookie);BOOMR.error("took more than 50ms to set cookie... aborting: "+d+" -> "+g,"rt")}return this},initFromCookie:function(){var d;if(!this.cookie){return}d=BOOMR.utils.getSubCookies(BOOMR.utils.getCookie(this.cookie));if(!d){return}d.s=Math.max(+d.ul||0,+d.cl||0);BOOMR.debug("Read from cookie "+BOOMR.utils.objectToString(d),"rt");if(d.s&&d.r){this.r=d.r;if(!this.strict_referrer||this.r===this.r2||(d.s===+d.cl&&d.nu===c.URL.replace(/#.*/,""))){this.t_start=d.s;if(+d.hd>d.s){this.t_fb_approx=parseInt(d.hd,10)}}else{this.t_start=this.t_fb_approx=undefined}}},checkPreRender:function(){if(!(c.webkitVisibilityState&&c.webkitVisibilityState==="prerender")&&!(c.msVisibilityState&&c.msVisibilityState===3)){return false}BOOMR.plugins.RT.startTimer("t_load",this.navigationStart);BOOMR.plugins.RT.endTimer("t_load");BOOMR.plugins.RT.startTimer("t_prerender",this.navigationStart);BOOMR.plugins.RT.startTimer("t_postrender");BOOMR.subscribe("visibility_changed",BOOMR.plugins.RT.done,null,BOOMR.plugins.RT);return true},initNavTiming:function(){var d,f,e;if(this.navigationStart){return}f=a.performance||a.msPerformance||a.webkitPerformance||a.mozPerformance;if(f&&f.navigation){this.navigationType=f.navigation.type}if(f&&f.timing){d=f.timing}else{if(a.chrome&&a.chrome.csi&&a.chrome.csi().startE){d={navigationStart:a.chrome.csi().startE};e="csi"}else{if(a.gtbExternal&&a.gtbExternal.startE()){d={navigationStart:a.gtbExternal.startE()};e="gtb"}}}if(d){BOOMR.addVar("rt.start",e||"navigation");this.navigationStart=d.navigationStart||d.fetchStart||undefined;this.responseStart=d.responseStart||undefined;if(navigator.userAgent.match(/Firefox\/[78]\./)){this.navigationStart=d.unloadEventStart||d.fetchStart||undefined}}else{BOOMR.warn("This browser doesn't support the WebTiming API","rt")}return},page_unload:function(d){BOOMR.debug("Unload called with "+BOOMR.utils.objectToString(d),"rt");this.setCookie(d.type==="beforeunload"?"ul":"hd")},onclick:function(d){if(!d){return}BOOMR.debug("Click called with "+d.nodeName,"rt");while(d&&d.nodeName.toUpperCase()!=="A"){d=d.parentNode}if(d&&d.nodeName.toUpperCase()==="A"){BOOMR.debug("passing through","rt");this.setCookie("cl",d.href)}},domloaded:function(){BOOMR.plugins.RT.endTimer("t_domloaded")}};BOOMR.plugins.RT={init:function(d){BOOMR.debug("init RT","rt");if(a!==BOOMR.window){a=BOOMR.window;c=a.document}BOOMR.utils.pluginConfig(b,d,"RT",["cookie","cookie_exp","strict_referrer"]);b.initFromCookie();if(b.initialized){return this}b.complete=false;b.timers={};BOOMR.subscribe("page_ready",this.done,null,this);BOOMR.subscribe("dom_loaded",b.domloaded,null,b);BOOMR.subscribe("page_unload",b.page_unload,null,b);BOOMR.subscribe("click",b.onclick,null,b);if(BOOMR.t_start){this.startTimer("boomerang",BOOMR.t_start);this.endTimer("boomerang",BOOMR.t_end);this.endTimer("boomr_fb",BOOMR.t_start)}b.r=b.r2=c.referrer.replace(/#.*/,"");b.initialized=true;return this},startTimer:function(d,e){if(d){if(d==="t_page"){this.endTimer("t_resp",e)}b.timers[d]={start:(typeof e==="number"?e:new Date().getTime())};b.complete=false}return this},endTimer:function(d,e){if(d){b.timers[d]=b.timers[d]||{};if(b.timers[d].end===undefined){b.timers[d].end=(typeof e==="number"?e:new Date().getTime())}}return this},setTimer:function(d,e){if(d){b.timers[d]={delta:e}}return this},done:function(){BOOMR.debug("Called done","rt");var e,g=new Date().getTime(),j={t_done:1,t_resp:1,t_page:1},d=0,h,k,f=[];b.complete=false;b.initFromCookie();b.initNavTiming();if(b.checkPreRender()){return this}if(b.responseStart){this.endTimer("t_resp",b.responseStart);if(b.timers.t_load){this.setTimer("t_page",b.timers.t_load.end-b.responseStart)}else{this.setTimer("t_page",g-b.responseStart)}}else{if(b.timers.hasOwnProperty("t_page")){this.endTimer("t_page")}else{if(b.t_fb_approx){this.endTimer("t_resp",b.t_fb_approx);this.setTimer("t_page",g-b.t_fb_approx)}}}if(b.timers.hasOwnProperty("t_postrender")){this.endTimer("t_postrender");this.endTimer("t_prerender")}if(b.navigationStart){e=b.navigationStart}else{if(b.t_start&&b.navigationType!==2){e=b.t_start;BOOMR.addVar("rt.start","cookie")}else{BOOMR.addVar("rt.start","none");e=undefined}}this.endTimer("t_done",g);BOOMR.removeVar("t_done","t_page","t_resp","r","r2","rt.tstart","rt.bstart","rt.end","t_postrender","t_prerender","t_load");BOOMR.addVar("rt.tstart",e);BOOMR.addVar("rt.bstart",BOOMR.t_start);BOOMR.addVar("rt.end",b.timers.t_done.end);for(h in b.timers){if(b.timers.hasOwnProperty(h)){k=b.timers[h];if(typeof k.delta!=="number"){if(typeof k.start!=="number"){k.start=e}k.delta=k.end-k.start}if(isNaN(k.delta)){continue}if(j.hasOwnProperty(h)){BOOMR.addVar(h,k.delta)}else{f.push(h+"|"+k.delta)}d++}}if(d){BOOMR.addVar("r",b.r);if(b.r2!==b.r){BOOMR.addVar("r2",b.r2)}if(f.length){BOOMR.addVar("t_other",f.join(","))}}b.timers={};b.complete=true;BOOMR.sendBeacon();return this},is_complete:function(){return b.complete}}}(window));(function(){if(!window.BOOMREnabled||(window.BOOMRWaitForPlayer&&(window.videoHasPartnerPlayer||window.flashOK===false))){return}BOOMR.init({beacon_url:window.BOOMRBeaconUrl,log:null,autorun:!window.BOOMRWaitForPlayer});BOOMR.addVar("browser",$j.browser.name);BOOMR.addVar("country",window.DMContext?DMContext.geoip_country:"unknown");BOOMR.addVar("routename",window.DMContext?DMContext.route_name:"unknown");BOOMR.addVar("logged",window.DMContext?DMContext.is_logged:"unknown");BOOMR.addVar("AS",window.DMContext?DMContext.geoip_as:"unknown");BOOMR.subscribe("before_beacon",function(k){var h=["u","v","nt_red_cnt","nt_nav_type","nt_red_st","nt_red_end","nt_spdy","nt_dns_st","nt_dns_end","nt_con_st","nt_con_end","nt_unload_st","nt_unload_end","nt_domloading","nt_domint","nt_fet_st","nt_load_st","nt_domcomp","r","r2","t_other","rt.start","rt.tstart","rt.bstart","rt.end","nt_res_end"];for(var j=0,g=h.length;j<g;j++){BOOMR.removeVar(h[j])}if(k.nt_first_paint&&(k.nt_first_paint+"").match(/\./)){k.nt_first_paint=Math.ceil(k.nt_first_paint*1000)}BOOMR.addVar("t_toppage",dm_times.start);BOOMR.addVar("t_first_domready",dm_times.firstdomready)});if(window.BOOMRWaitForPlayer&&window.DM_Player){BOOMR.addVar("with_ad_call",window.auditudeEnabledForVideo);var d={pageLoaded:false,playerPlaying:false};function f(h){var g=true;d[h]=true;for(p in d){if(!d.hasOwnProperty(p)){continue}g=g&&d[p]}if(g){BOOMR.page_ready()}}function b(){for(var h=0,g=BOOMRPlayerEvents.length;h<g;h++){window.BOOMRPlayer.removeEventListener("on"+BOOMRPlayerEvents[h],'BOOMRProxyPlayerHandler("'+BOOMRPlayerEvents[h]+'")')}delete (window.BOOMRPlayer)}$j(window).on("load",function(){setTimeout(function(){f("pageLoaded")},0)}).on("beforeunload",function(){BOOMR.addVar("t_usergone",new Date().getTime());BOOMR.page_ready()});window.BOOMRProxyPlayerHandler=function(g){return function(h){if(g=="VideoMetadata"){BOOMR.addVar("cell",h.streamInfo?h.streamInfo.cell||"n/a":"n/a");return}if(g=="StateChange"){g=g+"_"+h}BOOMR.addVar("t_"+g,new Date().getTime());if(g=="VideoProgress"){b();f("playerPlaying")}}};for(var c=0,a=BOOMRPlayerEventsQueue.length;c<a;c++){var e=BOOMRPlayerEventsQueue[c];BOOMRProxyPlayerHandler(e[0])(e[1])}}window.bottomBOOMR=function(){BOOMR.addVar("t_env_top",dm_times.env_top);BOOMR.addVar("t_script_bottom",dm_times.script_bottom)}})();var Lt_HomeMedia={locked:true,DmJsApiLoaded:false,ajaxPageName:null,loadingPage:false,loadOffset:-500,loadHeight:0,viewportHeight:0,hasNext:true,currentPage:1,footer:null,pageTopWrapper:null,pageList:null,hasMiddle:true,middleTops:{"1":[0,0]},loadingNewContext:false,opacifying:false,opacified:false,loadOpacity:0.7,loadOpacityDuration:200,updateViewportHeight:function(){Lt_HomeMedia.viewportHeight=$j(window).height()},updateLoadHeight:function(){var b=$j("#next_page");if(b[0]){Lt_HomeMedia.loadHeight=b.offset().top+Lt_HomeMedia.loadOffset}},delayCheckForUpdate:function(){Lt_HomeMedia.checkTimeout&&clearTimeout(Lt_HomeMedia.checkTimeout);if((new Date()).getTime()-(Lt_HomeMedia.checkForUpdate.lastCheckTime||0)>=350){return Lt_HomeMedia.checkForUpdate()}Lt_HomeMedia.checkTimeout=setTimeout(Lt_HomeMedia.checkForUpdate,150)},checkForUpdate:function(){if(Lt_HomeMedia.locked){return}arguments.callee.lastCheckTime=(new Date()).getTime();var b=$j(window).scrollTop();if(!Lt_HomeMedia.loadingPage&&Lt_HomeMedia.hasNext&&Lt_HomeMedia.loadHeight<=(b+Lt_HomeMedia.viewportHeight)){Lt_HomeMedia.loadNextPage()}if(Lt_HomeMedia.hasMiddle){Lt_HomeMedia.adjustMiddlePosition(b)}if(!Lt_HomeMedia.loadingPage&&(Lt_HomeMedia.viewportHeight+b)>=(Lt_HomeMedia.$pageTopWrapper.height()-100)){Lt_HomeMedia.$footer.addClass("show_full")}else{Lt_HomeMedia.$footer.removeClass("show_full")}},masscastPositionStatus:function(c,d){if(c=="Middle"){PubSub.unsubscribe("masscast:position_status",arguments.callee);this.hasMiddle=d=="dismissed"?false:true;this.addBuzzList()}},adjustMiddlePosition:function(j){var r=Lt_HomeMedia.$pageList.offset().top,o=j>=r?j-r:0,l=o+Lt_HomeMedia.viewportHeight,k=0,q=0;for(var n in Lt_HomeMedia.middleTops){if(Lt_HomeMedia.middleTops.hasOwnProperty(n)&&l<=Lt_HomeMedia.middleTops[n][1]){k=Lt_HomeMedia.middleTops[n][0];var m=Lt_HomeMedia.middleTops[n-1||1][0];if(o<m+126){k=m}break}q++}$j("#mc_Middle").css({top:(q<Lt_HomeMedia.currentPage?k:Lt_HomeMedia.middleTops[Lt_HomeMedia.currentPage][0])+"px"})},addMiddleTopValue:function(c){if(c<=5){var d=c==1?0:Lt_HomeMedia.middleTops[c-1][1];Lt_HomeMedia.middleTops[c]=[d,d+$j("#page_"+c).outerHeight()]}},updateMiddleTopValues:function(d){if(!d){return}for(var c in Lt_HomeMedia.middleTops){if(Lt_HomeMedia.middleTops.hasOwnProperty(c)){Lt_HomeMedia.addMiddleTopValue(c)}}},loadNextPage:function(){Lt_HomeMedia.loadingPage=true;$j("#next_page").remove();Lt_HomeMedia.$pageList.append('<div id="home_next_page_ph"><div>');DM_WidgetV3.multiGet(Lt_HomeMedia.ajaxPageName,document.location.pathname,{page:{replace:"#home_next_page_ph",options:{page:Lt_HomeMedia.currentPage+1,hasMiddle:Lt_HomeMedia.hasMiddle,slots:Lt_HomeMedia.currentContexts,version:Lt_HomeMedia_VERSION,with_extra_subscription_block:Lt_HomeMedia.hasExtrasSubscriptionBlock()},canceled:function(){Lt_HomeMedia.loadingPage=false}}})},loadCallback:function(b){$j.extend(Lt_HomeMedia,b);if(window.vsStat){if(Lt_HomeMedia.inEditMode){if(Lt_HomeMedia.currentPage>1){PubSub.publish("vs:action","home-scroll-page-"+Lt_HomeMedia.currentPage)}else{PubSub.publish("vs:action","home-filter-edit")}}else{if(Lt_HomeMedia.currentPage>1){PubSub.publish("vs:action","home-scroll-page-"+Lt_HomeMedia.currentPage)}else{PubSub.publish("vs:action","home-filter")}}}if(window.SiteCatalyst){if(Lt_HomeMedia.currentPage=="undefined"||(typeof Lt_HomeMedia.currentPage!="undefined"&&Lt_HomeMedia.currentPage==1)){if(Lt_HomeMedia.inEditMode){PubSub.publish("sc:action",{context:"ajax home",label:"home media edit"})}else{PubSub.publish("sc:action",{context:"ajax home",label:"home media"})}}}Lt_HomeMedia.hasNext=!!$j("#next_page")[0];Lt_HomeMedia.addMiddleTopValue(Lt_HomeMedia.currentPage);if(Lt_HomeMedia.hasNext){Lt_HomeMedia.updateLoadHeight();Lt_HomeMedia.checkTimeout&&clearTimeout(Lt_HomeMedia.checkTimeout);Lt_HomeMedia.checkForUpdate()}if(!Lt_HomeMedia.hasMiddle&&$j("#page_"+Lt_HomeMedia.currentPage+" div.mc_Middle_ph")[0]){Lt_HomeMedia.addBuzzList(Lt_HomeMedia.currentPage)}},hideSubscriptions:function(){$j("div.sd_homemedia_subscriptionblock").hide()},showSubscriptions:function(){$j("div.sd_homemedia_subscriptionblock").show()},onResize:function(){Lt_HomeMedia.updateViewportHeight();Lt_HomeMedia.delayCheckForUpdate()},onScroll:function(){Lt_HomeMedia.delayCheckForUpdate()},setPageObservers:function(){$j(window).on("resize",Lt_HomeMedia.onResize);$j(window).on("scroll",Lt_HomeMedia.onScroll)},addBuzzList:function(f){if(!this.hasMiddle){if(!f){var d={buzz:{replace:"#mc_Middle",options:{page:1}}};for(var e=2;e<=this.currentPage;e++){d["buzz_"+e]={replace:"#page_"+e+" div.mc_Middle_ph",options:{page:e}}}}else{var d={};d["buzz_"+f]={replace:"#page_"+f+" div.mc_Middle_ph",options:{page:f}}}DM_WidgetV3.multiGet(Lt_HomeMedia.ajaxPageName,document.location.pathname,d)}},resetCurrentHome:function(){DM_WidgetV3.unregisterAjaxCall(Lt_HomeMedia.ajaxPageName+".buzz");DM_WidgetV3.unregisterAjaxCall(Lt_HomeMedia.ajaxPageName+".page");Lt_HomeMedia.$pageList.find("div.sd_homemedia_page").slice(1).remove();Lt_HomeMedia.middleTops={"1":[0,0]}},getNewNineBlockList:function(){var b=Lt_HomeMedia.hasExtrasSubscriptionBlock();DM_WidgetV3.multiGet(Lt_HomeMedia.ajaxPageName,document.location.pathname,{nineblocklist:{update:"div.sd_homemedia_nineblocklist",options:{slots:Lt_HomeMedia.currentContexts,version:Lt_HomeMedia_VERSION,with_extra_subscription_block:b},callback:function(){if(b){Lt_HomeMedia.showSubscriptions()}else{Lt_HomeMedia.hideSubscriptions()}$j(Lt_HomeMedia.$firstBlockList).fadeTo(Lt_HomeMedia.loadOpacityDuration,1,function(){Lt_HomeMedia.opacified=false})}}})},hasExtrasSubscriptionBlock:function(){var b=$j("#nav_usersubscription");return Lt_HomeMedia.isSubscriptionAble&&(!Lt_HomeMedia.currentContexts||Lt_HomeMedia.currentContexts.split(",").length!=1)&&b[0].parentNode.parentNode.id=="active_list"&&!b.hasClass("selected")},setVideosObserver:function(){var b=$j("div.dmpi_bigbox");b.on("mousedown","h3.sd_video_title a.video_title",Lt_HomeMedia.videoTitleClick).on("click","div.sd_video_previewtwig",Lt_HomeMedia.videoPreviewClick).on("click","span.video_context",Lt_HomeMedia.contextClicked)},contextClicked:function(b){if(!Lt_HomeMedia.loadingNewContext){PubSub.publish("homenav:context_update_required",$j(this).data("id"))}},saveBehavior:function(f){var e=$j(f).closest("div.block_item").find("span.video_context"),d;if(e){d=e.data("id").replace(/_/g,".")}if(d&&d!="usersubscription"){ajax_call("home","increment_behavior",d,null)}},videoTitleClick:function(){Lt_HomeMedia.saveBehavior(this)},videoPreviewClick:function(b){if(Lt_HomeMedia.locked){return b.stopPropagation()}Lt_HomeMedia.saveBehavior(this);return true},onNavEditToggle:function(c){var d=true;if(c===true||(Lt_HomeMedia.currentContexts&&Lt_HomeMedia.currentContexts.split(",").length==1)){Lt_HomeMedia.inEditMode=c;Lt_HomeMedia.overflowTimeout&&clearTimeout(Lt_HomeMedia.overflowTimeout);Lt_HomeMedia.$pageList.removeClass("with_overflow").removeClass("no_filter");d=false}else{Lt_HomeMedia.inEditMode=false;Lt_HomeMedia.$pageList.addClass("no_filter");Lt_HomeMedia.overflowTimeout&&clearTimeout(Lt_HomeMedia.overflowTimeout);Lt_HomeMedia.overflowTimeout=setTimeout(function(){Lt_HomeMedia.$pageList.addClass("with_overflow")},1000)}Lt_HomeMedia.updateMiddleTopsTimeout&&clearTimeout(Lt_HomeMedia.updateMiddleTopsTimeout);Lt_HomeMedia.updateMiddleTopsTimeout=setTimeout(function(){Lt_HomeMedia.updateMiddleTopValues(d)},500)},onNavBeforeUpdate:function(){if(Lt_HomeMedia.loadingNewContext){DM_WidgetV3.unregisterAjaxCall(Lt_HomeMedia.ajaxPageName+".nineblocklist")}Lt_HomeMedia.locked=Lt_HomeMedia.loadingNewContext=true;Lt_HomeMedia.resetCurrentHome()},onNavActiveContexts:function(b){Lt_HomeMedia.currentContexts=b.length?$j.toJSONString(b).replace(/_/g,"."):"";Lt_HomeMedia.locked=false;Lt_HomeMedia.checkForUpdate()},onNavUpdated:function(b){Lt_HomeMedia.currentContexts=b.length?$j.toJSONString(b).replace(/_/g,"."):"";if(Lt_HomeMedia.inEditMode||b.length==1){Lt_HomeMedia.overflowTimeout&&clearTimeout(Lt_HomeMedia.overflowTimeout);Lt_HomeMedia.$pageList.removeClass("with_overflow").removeClass("no_filter")}else{Lt_HomeMedia.$pageList.addClass("no_filter");Lt_HomeMedia.overflowTimeout&&clearTimeout(Lt_HomeMedia.overflowTimeout);Lt_HomeMedia.overflowTimeout=setTimeout(function(){Lt_HomeMedia.$pageList.addClass("with_overflow")},1000)}if(!Lt_HomeMedia.opacified&&!Lt_HomeMedia.opacifying){Lt_HomeMedia.opacifying=true;PubSub.publish("homenav:scroll_adjust");Lt_HomeMedia.$firstBlockList.fadeTo(Lt_HomeMedia.loadOpacityDuration,Lt_HomeMedia.loadOpacity,function(){Lt_HomeMedia.opacifying=false;Lt_HomeMedia.opacified=true;Lt_HomeMedia.getNewNineBlockList()});return}Lt_HomeMedia.getNewNineBlockList()},initialize:function(){PubSub.subscribe("masscast:position_status",Lt_HomeMedia.masscastPositionStatus,Lt_HomeMedia);PubSub.subscribe("popup:opened",function(){Lt_HomeMedia.locked=true}).subscribe("popup:closed",function(){Lt_HomeMedia.locked=false}).subscribe("homenav:edit_toggle",Lt_HomeMedia.onNavEditToggle).subscribe("homenav:before_update",Lt_HomeMedia.onNavBeforeUpdate).subscribe("homenav:updated",Lt_HomeMedia.onNavUpdated).subscribe("homenav:active_contexts",Lt_HomeMedia.onNavActiveContexts);$j(function(){Lt_HomeMedia.ajaxPageName=window.Lt_HomeMedia_AJAXPAGENAME;Lt_HomeMedia.$footer=$j("#footer");Lt_HomeMedia.$pageTopWrapper=$j("#topwrapper");Lt_HomeMedia.$pageList=$j("div.sd_homemedia_pagelist").first();var b=Lt_HomeMedia.$pageList.find(".block_featured .sd_video_previewtwig")[0];if(b){b.id="top_featured_video"}Lt_HomeMedia.$firstBlockList=Lt_HomeMedia.$pageList.find("div.sd_homemedia_nineblocklist");Lt_HomeMedia.addMiddleTopValue(Lt_HomeMedia.currentPage);Lt_HomeMedia.isSubscriptionAble=!!$j("#nav_usersubscription")[0];Lt_HomeMedia.inEditMode=false;Lt_HomeMedia.addBuzzList();Lt_HomeMedia.setVideosObserver();Lt_HomeMedia.updateViewportHeight();Lt_HomeMedia.updateLoadHeight();Lt_HomeMedia.setPageObservers()})}};Lt_HomeMedia.initialize();var Sd_HomeNav={editable:false,editing:false,currentContext:null,activeContexts:{},minContextLimit:4,cacheClear:"remove this",setObservers:function(){$j("button.switch_home").on("click",function(a){if($j(this).hasClass("selected")){a.stopPropagation();a.preventDefault();return}document.location=document.location.pathname+(document.location.search?"&":"?")+"mode="+this.id.match(/version_(.*)/)[1]});Sd_HomeNav.editable&&$j("#edit_nav").on("click",function(){var a=$j(this);a.toggleClass("selected");Sd_HomeNav.editing=!Sd_HomeNav.editing;Sd_HomeNav.$nav.toggleClass("edit_mode");Sd_HomeNav.updateOutOfListVisibility();PubSub.publish("homenav:edit_toggle",Sd_HomeNav.editing);if(Sd_HomeNav.hasNewContexts){if(!arguments.callee.called){arguments.callee.called=true;a.find("div.ic_n").remove();Sd_HomeNav.saveContextsConfigurationNow()}if(!Sd_HomeNav.editing&&!arguments.callee.displayed_new_context){arguments.callee.displayed_new_context=true;Sd_HomeNav.hasNewContexts=false;Sd_HomeNav.$outOfListContainer.removeClass("has_new");Sd_HomeNav.$nav.find("a.nav_link[title]").attr("title",null)}}if(Sd_HomeNav.editing){a.attr("title",Sd_HomeNav_UNEDIT_MSG);PubSub.publish("vs:action","edit-home-nav")}else{a.attr("title",Sd_HomeNav_EDIT_MSG)}});var b=$j("div.dmpi_bigbox");b.on("click","a.nav_link, #nav_all",Sd_HomeNav.onItemClick)},onContextUpdateRequired:function(b){if(Sd_HomeNav.currentContext||Sd_HomeNav.editing){return}$j("#nav_"+b).trigger("click")},onScrollAdjust:function(b){if(Sd_HomeNav.$nav.offset().top<=$j(window).scrollTop()){$j("html, body").animate({scrollTop:Sd_HomeNav.$nav.offset().top+"px"},150)}},onItemClick:function(b){PubSub.publish("homenav:before_update");Sd_HomeNav.setNewContext(this);if(b){b.stopPropagation();b.preventDefault()}PubSub.publish("homenav:updated",Sd_HomeNav.getActiveContexts())},setNewContext:function(h){var k=$j(h),l=Sd_HomeNav.currentContext,m=h.id.replace(/^nav_/,"");if(m=="all"){if(Sd_HomeNav.currentContext){$j("#nav_"+Sd_HomeNav.currentContext).removeClass("selected");Sd_HomeNav.currentContext=null;k.addClass("selected")}return}if(Sd_HomeNav.editing&&Sd_HomeNav.$list.hasClass("lock_editable_removal")&&m!="usersubscription"&&Sd_HomeNav.activeContexts[m]){return}if(Sd_HomeNav.currentContext){$j("#nav_"+Sd_HomeNav.currentContext).removeClass("selected");Sd_HomeNav.currentContext=null}if(Sd_HomeNav.editing){if(k.hasClass("active")){var j=k.removeClass("active").parent().remove();j=(window.IEVersion&&window.IEVersion<=9)?j.clone():j;var g=j.find(".action .icon").first();g.removeClass("icon-close").addClass("icon-plus");Sd_HomeNav.$outOfList.append(j);delete (Sd_HomeNav.activeContexts[m]);Sd_HomeNav.checkMinContextLimit()}else{var j=k.addClass("active").parent().remove();j=(window.IEVersion&&window.IEVersion<=9)?j.clone():j;var g=j.find(".action .icon").first();g.removeClass("icon-plus").addClass("icon-close");Sd_HomeNav.$list.append(j);if(m!="usersubscription"){Sd_HomeNav.activeContexts[m]=1}Sd_HomeNav.checkMinContextLimit()}Sd_HomeNav.saveContextsConfiguration();Sd_HomeNav.updateOutOfListVisibility()}else{if(m!=l){k.addClass("selected");$j("#nav_all").removeClass("selected");Sd_HomeNav.currentContext=m}else{$j("#nav_all").addClass("selected")}}},checkMinContextLimit:function(){if(Sd_HomeNav.getActiveContextsKeys().length>Sd_HomeNav.minContextLimit){Sd_HomeNav.$list.removeClass("lock_editable_removal")}else{Sd_HomeNav.$list.addClass("lock_editable_removal")}},saveContextsConfiguration:function(){Sd_HomeNav.contextsSaveTimeout&&clearTimeout(Sd_HomeNav.contextsSaveTimeout);Sd_HomeNav.contextsSaveTimeout=setTimeout(function(){Sd_HomeNav.saveContextsConfigurationNow()},2000)},saveContextsConfigurationNow:function(){ajax_call("home","save_contexts_configuration",Sd_HomeNav.getAllContexts(),null)},getActiveContextsKeys:function(){return $j.map(Sd_HomeNav.activeContexts,function(c,d){return d})},getActiveContexts:function(){var b=Sd_HomeNav.getActiveContextsKeys();return Sd_HomeNav.currentContext?[Sd_HomeNav.currentContext]:Sd_HomeNav.editableContextsTotal==b.length?[]:b},updateActiveContexts:function(){Sd_HomeNav.$list.find("li.editable_context").each(function(){Sd_HomeNav.activeContexts[$j(this).find("a.nav_link")[0].id.replace(/nav_/,"")]=1})},getInactiveContextsCount:function(){var c=0,d=/usersubscription/;Sd_HomeNav.$outOfList.children().each(function(){c+=d.test($j(this).children()[0].id)?0:1});return c},updateOutOfListVisibility:function(){if(Sd_HomeNav.$outOfList.children().length&&Sd_HomeNav.editing){return Sd_HomeNav.$outOfListContainer.show()}Sd_HomeNav.$outOfListContainer.hide()},getAllContexts:function(){var f=/active/,d=[],e=30;Sd_HomeNav.$nav.find("a.nav_link").each(function(){d[parseInt(this.id.replace(/[^0-9]/g,"")||e++)]=f.test(this.className)?"1":"0"});return DMContext.content_version+"*"+d.join(".").replace(/^\./g,"").replace(/\.+/g,".")},initialize:function(){PubSub.subscribe("homenav:context_update_required",Sd_HomeNav.onContextUpdateRequired).subscribe("homenav:scroll_adjust",Sd_HomeNav.onScrollAdjust);$j(function(){Sd_HomeNav.$nav=$j("#home_nav");Sd_HomeNav.$list=$j("#active_list");Sd_HomeNav.editable=!!$j("#edit_nav");Sd_HomeNav.setObservers();Sd_HomeNav.updateActiveContexts();if(Sd_HomeNav.editable){Sd_HomeNav.$outOfList=$j("#inactive_list");Sd_HomeNav.$outOfListContainer=Sd_HomeNav.$outOfList.parent();Sd_HomeNav.editableContextsTotal=Sd_HomeNav.getActiveContextsKeys().length+Sd_HomeNav.getInactiveContextsCount();Sd_HomeNav.hasNewContexts=!!$j("#edit_nav").find("div.ic_n")[0]}Sd_HomeNav.checkMinContextLimit();PubSub.publish("homenav:active_contexts",Sd_HomeNav.getActiveContexts())})}};Sd_HomeNav.initialize();var Sd_Video_PreviewTwig={item:null,container:null,sprite1:null,sprite2:null,state:0,step:0,total:0,timer:-1,infosTimer:null,flyoutTimer:null,flyoutEnabled:!/dm_page_html_videos\b/.test(document.body.className)||$j("#dual_list").hasClass("grid_view"),flyoutPositions:[],flyoutElts:[],initEvents:function(c){Sd_Video_PreviewTwig.$videoListItems=null;var d=c?$j(c+" div.sd_video_previewtwig"):$j("div.sd_video_previewtwig");d.each(function(){if(this.observed){return}this.observed=true;$j(this).on({mouseenter:Sd_Video_PreviewTwig.onPreviewEnter,mouseleave:Sd_Video_PreviewTwig.onPreviewLeave}).on("click","span.js-wl_chkbx",Sd_Video_PreviewTwig.addToWatchLater)})},onPreviewEnter:function(c){var d=this;Sd_Video_PreviewTwig.overTO=setTimeout(function(){var a=$j(d),b=a.find("div.psprite");if(b[0]){Sd_Video_PreviewTwig.onSpriteOver(b)}if(a.data("flyout")){Sd_Video_PreviewTwig.showFlyout(a)}Sd_Video_PreviewTwig.overTO=null},200)},onPreviewLeave:function(e){if(Sd_Video_PreviewTwig.overTO){clearTimeout(Sd_Video_PreviewTwig.overTO);Sd_Video_PreviewTwig.overTO=null;return}var h=$j(this);var f=h.find("div.psprite"),g=h.data("flyout");if(f[0]){Sd_Video_PreviewTwig.onSpriteOut(f)}if(g){Sd_Video_PreviewTwig.hideFlyout(h)}},onSpriteOver:function(b){Sd_Video_PreviewTwig.$psprite=b;Sd_Video_PreviewTwig.state=0;Sd_Video_PreviewTwig.total=b.hasClass("pmode8")?8:4;window.clearTimeout(Sd_Video_PreviewTwig.timer);Sd_Video_PreviewTwig.timer=window.setTimeout(function(){Sd_Video_PreviewTwig.spriteAnimate()},0)},onSpriteOut:function(b){window.clearTimeout(Sd_Video_PreviewTwig.timer);if(Sd_Video_PreviewTwig.$container){Sd_Video_PreviewTwig.$container.remove();Sd_Video_PreviewTwig.$container=null}},spriteAnimate:function(){switch(this.state){case 0:var c=0;if(typeof Sd_Video_PreviewTwig_SpriteOffset!="undefined"){c=Sd_Video_PreviewTwig_SpriteOffset}this.resizerEnabled=$j("#bodyall").hasClass("resizer_enabled");this.$img=this.$psprite.parent().find("img");this.path=this.$img.data("spr");this.itemWidth=this.$psprite.width();this.itemHeight=this.$psprite.height();this.previewHeight=this.$img.height();this.spriteStep=Math.floor(this.itemWidth*120/160);this.spriteHeight=this.spriteStep*this.total;this.spriteTopOffset=Math.floor((this.spriteStep-this.itemHeight)/2);this.$container=$j('<div id="psprite_container">').css({position:"absolute",overflow:"hidden",top:-(this.spriteTopOffset+c)+"px",left:c+"px",width:this.itemWidth+"px",height:(this.itemHeight+this.spriteTopOffset)+"px",display:"none"});this.$sprite2=$j('<img src="'+this.path+'" data-spriteid="2">').css({position:"absolute",border:"none",marginTop:0,width:this.itemWidth+"px",height:this.spriteHeight+"px",display:"none"});this.$psprite.before(this.$container.append(this.$sprite2));this.state++;break;case 1:var d=this.$sprite2[0];if(d.complete||(typeof(d.naturalWidth)!="undefined"&&d.naturalWidth!==0)){this.$sprite1=$j('<img src="'+this.path+'" data-spriteid="1">').css({position:"absolute",border:"none",marginTop:0,width:this.itemWidth+"px",height:this.spriteHeight+"px",display:"none"});this.$container.prepend(this.$sprite1).css({display:"block"});this.state++;this.step=0;this.$sprite2.fadeIn(400)}break;case 2:this.step++;if(this.step>=this.total){this.step=0}this.$sprite1.show().css({opacity:1});if(Sd_Video_PreviewTwig.step%2){this.$sprite1.css({top:"-"+(this.step*this.spriteStep)+"px"});this.$sprite2.fadeOut(400)}else{this.$sprite2.css({top:"-"+(this.step*this.spriteStep)+"px"}).fadeIn(400)}break}this.timer=window.setTimeout(function(){Sd_Video_PreviewTwig.spriteAnimate()},this.state==1?50:1000)},showFlyout:function(b){if(!Sd_Video_PreviewTwig.flyoutEnabled){return}Sd_Video_PreviewTwig.infosTimer=window.setTimeout(function(){Sd_Video_PreviewTwig.displayFlyout(b)},300)},hideFlyout:function(b){if(!Sd_Video_PreviewTwig.flyoutEnabled){return}Sd_Video_PreviewTwig.removeFlyout();window.clearTimeout(Sd_Video_PreviewTwig.infosTimer);Sd_Video_PreviewTwig.infosTimer=null},activateFlyout:function(){Sd_Video_PreviewTwig.flyoutEnabled=true},deactivateFlyout:function(){Sd_Video_PreviewTwig.flyoutEnabled=false},removeFlyout:function(c){var d=$j("#video_flyout_box");if(d[0]){if(c||Sd_Video_PreviewTwig.flyoutElts.indexOf(c)==-1){d.remove();Sd_Video_PreviewTwig.flyoutElts.clear()}}},getFlyoutPositionForItem:function(j){Sd_Video_PreviewTwig.nbItemsPerLine=(Sd_Video_PreviewTwig.nbItemsPerLine||(Math.floor(j.parent().width()/j.width())));var k=Sd_Video_PreviewTwig.nbItemsPerLine,f=[0,3];if(k==1){f=[]}var h=j.find(".sd_video_previewtwig"),g=Sd_Video_PreviewTwig.getVideoListItems().index(h)+1;if(f.indexOf(g%k)!=-1){return"left"}return"right"},displayFlyout:function(n){if(Sd_Video_PreviewTwig.flyoutElts.indexOf(n)==-1){var q=n.width()+12,r=0,o="left",k=n.closest(".dmpi_video_item");if(Sd_Video_PreviewTwig.getFlyoutPositionForItem(k)=="left"){q=-321;o="right"}if($j.layout!="gecko"){r=$j(window).scrollTop()}var l='<div class="video_flyout_box_content">'+k.html()+'<div class="stem_'+o+'"></div></div>',u=$j('<div id="video_flyout_box" class="background">');u.html(l);var s=n.offset();u.css({left:s.left+q+"px",top:s.top+"px"});var m=u.find("div.dmpi_video_description")[0];if(m&&m.innerHTML.blank()&&window.Sd_Video_PreviewTwig_NO_DESCRIPTION){$j(m).html(Sd_Video_PreviewTwig_NO_DESCRIPTION).addClass("foreground2")}var t=u.find("div.dmco_date");if(t[0]){t.addClass("foreground")}$j(document.body).prepend(u);Sd_Video_PreviewTwig.flyoutElts.push(u,n)}},getVideoListItems:function(){if(!Sd_Video_PreviewTwig.$videoListItems){Sd_Video_PreviewTwig.$videoListItems=$j(".sd_video_previewtwig[data-flyout]");if(/dm_page_html_user\b|dm_page_html_hub\b/.test(document.body.className)){Sd_Video_PreviewTwig.$videoListItems=Sd_Video_PreviewTwig.$videoListItems.add("div.dmpi_video_empty[data-flyout]")}}return Sd_Video_PreviewTwig.$videoListItems},addToWatchLater:function(m,j){if(m){m.stopPropagation();m.preventDefault()}var g=$j(this);if(j){if(!g.hasClass("remove")){ajax_call("watchlater","add_to_watchlater",j,function(a){DM_Widget_Page.notify($j.parseJSON(a).watchlater_status,"page");g.addClass("remove");if(!g.hasClass("name")){$el.remove()}})}else{ajax_call("watchlater","remove_to_watchlater",j,function(a){g.removeClass("remove");if(!g.hasClass("name")){el.remove()}})}}else{if(!g.data("watched")){var l=g.closest(".preview_link"),k=l[0].id||l.findParamInClass("id"),h=l.attr("title");ajax_call("watchlater","add_to_watchlater",k,function(a){g.fadeOut(500,function(){l.prev(".duration").css({"margin-top":"25px"});g.removeAttr("style").addClass("wl_done icon-check").removeClass("wl_chkbx").show()});DM_Widget_Page.notify(a.evalJSON(true).watchlater_status,"page");PubSub.publish("sc:action",{context:"watchlater",label:{title:h},});g.data("watched",true)})}}},initialize:function(){$j(function(){importEnv("Sd_Video_PreviewTwig");Sd_Video_PreviewTwig.initEvents()})}};Sd_Video_PreviewTwig.initialize();var DM_Masscast={errorMsg:"FAILED TO REQUEST OAS",outframedPositions:["x11","x28","Top3","x70","Middle1"],assistedOutframedPositions:["x11","Top3","Middle1","x28"],locked:{},lockPosition:function(b){log("Masscast","LOCK Position",b);DM_Masscast.locked[b]=true},getCallForPositions:function(d){var c=masscast_async_call;if(d&&d.length){c=c.replace(/@.+\?/,"@"+d.join(",")+"?")}return c.replace(/\/[^\/]+@/,"/"+(new Date()).getTime()+"@")},callOAS:function(b){log("Masscast","callOAS - arguments :",b);if($j.browser.name=="msie"&&!document.location.hostname.match(/www\./)){if(document.location.hostname.match(/preprod\./)){log("Masscast","Please log in to allow Masscast to proxy call OAS")}masscast_async_call=masscast_async_call.replace("www",document.location.hostname.replace(".dailymotion.com","")).replace("/masscast/","/_masscast/")}$j.get(b?DM_Masscast.getCallForPositions(b):masscast_async_call).done(function(a){DM_Masscast.callOASCallback(a,b)}).fail(function(a,e,f){log("Masscast",DM_Masscast.errorMsg,e,f);PubSub.subscribe("adminpanel:loaded",DM_Masscast.reportError);DM_Masscast.reportError()})},reportError:function(){$j("#masscast_call").prepend('<div><font color="red">'+DM_Masscast.errorMsg+'. Open JS console for details. <a href="#" style="color: red;text-decoration: underline;" onclick="showlog(\'Masscast\'); return false;">Print logs</a> (in JS console).</font></div>')},parseOASResponse:function(q,r){var o={};if(r&&r.length==1){o[r[0]]=q}else{var l=q.split('<!--OAS AD="');if(l[0].strip()==""){l.shift()}if(l.length==1){var k=masscast_async_call.match(/@(.+)\?/);if(k){o[k[1]]=l[0]}}else{for(var n=0,j=l.length;n<j;n++){var m=l[n].indexOf('"-->');o[l[n].slice(0,m)]=l[n].slice(m+4).strip()}}}return o},callOASCallback:function(f,e){log("Masscast","callOASCallback - OASResponse :",f);var d=DM_Masscast.parseOASResponse(f,e);log("Masscast","OASResponse parsed :",d);$j(function(){for(var c in d){if(!d.hasOwnProperty(c)){continue}var j=d[c];try{var b=$j("#mc_"+c);if(DM_Masscast.locked[c]){log("Masscast","Position",c,"is locked, update cancelled.");continue}if(!j||j.match(/\/\/ Default ad/)){b.length&&b.empty().hide();log("Masscast","Position",c,"not found or empty, hide its container from page.");PubSub.publish("masscast:position_status",c,"dismissed");continue}b.length&&b.removeClass("mc_hide");if(DM_Masscast.outframedPositions.indexOf(c)>-1&&j.indexOf("OAS_FORCE_IFRAME")===-1){log("Masscast","Position",c,' is "outframed" and need to be run out of an iframe .');DM_Masscast.handleOutframedPositionCode(c,j);PubSub.publish("masscast:position_status",c,"handled");continue}else{if(!b.length){log("Masscast","Position",c," container not found, do nothing.");PubSub.publish("masscast:position_status",c,"not_found");continue}}DM_Masscast.updatePositionViaIframe(c,j);PubSub.publish("masscast:position_status",c,"handled")}catch(a){log("Masscast","Exception catched while rendering",c,a.message);PubSub.publish("masscast:position_status",c,"error")}}})},handleOutframedPositionCode:function(c,d){if($j.isString(d)){documentWriteBackup=document.write;document.write=function(a){log("Masscast","!!! BEWARE !!!",c,"tried to document.write on an already built page :",a)};(window.execScript||function(a){window["eval"].call(window,a)})(d);document.write=documentWriteBackup}else{log("Masscast","cannot run position",c,"code:",d)}},updatePositionViaIframe:function(r,j){log("Masscast","Update position code",r);var q=$j("#mc_"+r),n=r;if(!q.length){return log("Masscast","Cannot update position via iframe, container not found for ",r)}q.css({height:0}).empty();var k=$j('<iframe class="mc_'+n+'_frame" name="mc_'+r+'" allowtransparency="true" framespacing="0" frameborder="no" scrolling="no"></iframe>');q.append(k);var l=k[0].contentDocument||k[0].contentWindow.document,m="<script>/*"+r+"*/("+DM_Masscast.preCodeInjection.toString()+")(window);<\/script>",o="<script>("+DM_Masscast.postCodeInjection.toString()+")(window);<\/script>";if(j.indexOf("OAS_HTML")===-1){j="<script>"+j+"<\/script>"}l.open().write('<!DOCTYPE html><html><body><style>body { margin:0; padding: 0; text-align:center;}</style><div id="content">'+m+j+o+"</div></body></html>");setTimeout(function(){l.close()},$j.browser.name=="msie"?2000:0)},reloadPositionFrame:function(c){log("Masscast","reloadPositionFrame - frame name",c.name);var d=c.name.replace(/mc_([a-zA-Z0-9]+)/,"$1");log("Masscast","Frame position to reload:",d);DM_Masscast.callOAS([d])},preCodeInjection:function(b){b.masscast_async_call=parent.masscast_async_call;b.inDapIF=true;b.ping=parent.ping;b.masscast={initReload:function(){if(b.reloadTime&&b.parent.DM_Masscast){b.parent.log("Masscast","Frame reload initiated for",b.name,". Reload in",reloadTime,"secs.");setTimeout(function(){b.parent.DM_Masscast.reloadPositionFrame(b)},reloadTime*1000)}},getElementHeight:function(a){return parseInt(parent.$j(a).css("height"),10)},adjustHeight:function(j){var h=masscast.getElementHeight(document.getElementById("content")),g=masscast.getElementHeight(document.body),k=masscast.getElementHeight(frameElement.parentNode),a=(j||0)||h;if(j){document.getElementById("content").style.cssText+="position:absolute;top:0;bottom:0;left:0;right:0;"}frameElement.style.height=a+"px";frameElement.parentNode.style.height="auto";if(a<50&&k>=100){frameElement.style.display="none"}else{frameElement.style.display="block";if(a<50&&g>=100){frameElement.style.height=g+"px"}}},loadDmJs:function(d){var a=b.document.createElement("script");a.type="text/javascript";a.src=b.parent.DM_JS.getRealPath(d);a.async=true;b.document.body.appendChild(a)},render:function(a,d){b[a+"Parameters"]=d;masscast.loadDmJs("/js/gen/lib/masscast/iframed/"+a+".js")}}},postCodeInjection:function(){masscast.initReload();function b(){b.times=b.times||1;if(window.disableAutoHeight){parent.log("Masscast",'"AutoHeight" is disabled for',frameElement.name);return frameElement.parentNode.style.height="auto"}masscast.adjustHeight();if(++b.times<5){setTimeout(b,500)}else{parent.log("Masscast",frameElement.name," iframe height",frameElement.style.height)}}setTimeout(b,150)},onCompanionAdDisplayed:function(b){this.lockPosition(b)},initialize:function(){PubSub.subscribe("masscast:companion_ad_displayed",this.onCompanionAdDisplayed,this);this.callOAS()}};if(window.masscast_async_call){log("Masscast","window.masscast_async_call found",window.masscast_async_call);window.masscast={render:function(d,c){log("Masscast","publish",d,"code for assisted handling");PubSub.publish("masscast:position_"+d,c)}};DM_Masscast.initialize()}else{log("Masscast","window.masscast_async_call not found.")}var DM_Masscast_x28={params:null,domReadyDate:null,onCodeReceived:function(d){var c=((new Date()).getTime()-(this.domReadyDate||new Date()).getTime())/1000;if(c>2){return log("Masscast","Dismiss x28 because it was received more than 2 seconds after DOM ready (",c," secs).")}log("Masscast","Recieved x28 code before DOM ready + 2 secs (",c," secs). Build intersticial.");this.setParams(d);this.build()},setParams:function(b){this.params=$j.isString(b)?(new Function("return "+b))():b},build:function(){if(this.params&&!this.built){this.built=true;window.DM_swftrans_open=this.DM_swftrans_open;window.DM_swftrans_close=this.DM_swftrans_close;window.DM_Intersticiel_close=this.DM_Intersticiel_close;this.hideSiteWrapper();this.addHtml();this.afterHtml();this.setDimmerStyle();this.setClickCommand();this.addPixelTrackers();this.closeTimeout=window.setTimeout(DM_Intersticiel_close,this.params.closeDelay*1000||30000);PubSub.publish("masscast:intersticial_opened")}},addHtml:function(){$j(document.body).prepend(this.getX28Html())},getX28Html:function(){var h="",f="",e="";if(this.params.logoImg){h="background-image: url("+this.params.logoImg+")"}if(this.params.withTopBanner){f='<div class="x28_top_banner" style="background-color: '+this.params.withTopBanner.backgroundColor+';"><div class="x28_top_banner_inner"><div style="'+h+'" id="x28_dimmer_logo" class="no_clkthg"></div><a id="x28_go_to_dm" title="'+(window.DM_Closex28Label||window.DM_CloseLabel||"Close")+'" href="javascript:void(0);" onclick="DM_Intersticiel_close();" class="button medium_size no_clkthg">'+(window.DM_Closex28Label||window.DM_CloseLabel||"Close")+"</a></div></div>"}else{e='<a id="x28_go_to_dm" title="'+(window.DM_Closex28Label||window.DM_CloseLabel||"Close")+'" href="javascript:void(0);" onclick="DM_Intersticiel_close();" class="button medium_size no_clkthg">'+(window.DM_Closex28Label||window.DM_CloseLabel||"Close")+'</a><div id="x28_dimmer_logo" class="no_clkthg" style="'+h+'"></div>'}var g='<div id="x28_dimmer"'+(f?' class="with_banner"':"")+">"+f+'<div id="x28_dimmer_inner">'+e+'<div id="intersticiel_object">';if(this.params.type=="video"){if(window.deconcept&&deconcept.SWFObjectUtil.getPlayerVersion().major!=0){g+='<div id="DM_swftr" style="top: '+this.params.playerTopOffset+'px;"><iframe frameborder="0" width="'+(this.params.playerWidth||620)+'" height="'+(this.params.playerHeight||272)+'" src="http://www.dailymotion.com/embed/video/'+this.params.videoId+"?theme=none&auditude=0&chromeless=1&autoPlay=1&autoMute=1&unmuteOnMouseOver=1&related=0&clickThroughURL="+encodeURIComponent(this.params.clickCommand)+'&clickThroughURLTarget=_blank"></iframe></div>'}else{g+='<a id="x28_fallback" href="'+this.params.fallbackUrl+'" target="_blank"><img src="'+this.params.fallbackUrl+'" border="0" alt=""></a>'}}else{if(this.params.type=="flash"){if(window.deconcept&&deconcept.SWFObjectUtil.getPlayerVersion().major!=0){g+='<div id="DM_swftr" style="top: '+this.params.flashTopOffset+'px;"></div>'}else{g+='<a id="x28_fallback" href="'+this.params.fallbackUrl+'" target="_blank"><img src="'+this.params.fallbackUrl+'" border="0" alt=""></a>'}}else{if(this.params.type=="gif"){}}}g+="</div></div></div>";return g},setClickCommand:function(){$j("#x28_dimmer").on("click",function(b){if(!$j(b.target).hasClass("no_clkthg")){window.open(DM_Masscast_x28.params.clickCommand)}})},setDimmerStyle:function(){var b={};if(this.params.backgroundUrl){b["background-image"]="url("+this.params.backgroundUrl+")"}if(this.params.backgroundColor){b["background-color"]=this.params.backgroundColor}if(this.params.backgroundPosition){b["background-position"]=this.params.backgroundPosition}$j("#x28_dimmer").css(b)},hideSiteWrapper:function(){$j("#topwrapper").hide();$j("#footer").hide()},afterHtml:function(){if(this.params.type=="flash"&&window.deconcept&&deconcept.SWFObjectUtil.getPlayerVersion().major!=0){myswf=new SWFObject(this.params.flashUrl,"flashtrans",this.params.flashWidth,this.params.flashHeight,8,"#000000");myswf.skipDetect=true;myswf.addParam("quality","high");myswf.addParam("wmode","transparent");myswf.addParam("allowscriptaccess","always");myswf.addVariable("clicktag",this.params.clickCommand);myswf.write("DM_swftr")}},addPixelTrackers:function(){if(this.params.pixelsTracking&&this.params.pixelsTracking.length){for(var c=0,d=this.params.pixelsTracking.length;c<d;c++){ping(this.params.pixelsTracking[c],"x28")}}},DM_Intersticiel_close:function(){var b=$j("#x28_dimmer");$j("body").off("click");if(b){b.off("click").remove();$j("#topwrapper").show();$j("#footer").show()}clearTimeout(DM_Masscast_x28.closeTimeout);PubSub.publish("masscast:intersticial_closed")},DM_swftrans_close:function(){$j("#DM_swftr").hide();$j("#DM_backup").show()},DM_swftrans_open:function(){},setDomReadyDate:function(){this.domReadyDate=new Date()},initialize:function(){PubSub.subscribe("masscast:position_x28",this.onCodeReceived,this);PubSub.subscribe("dom:ready",this.setDomReadyDate,this)}};DM_Masscast_x28.initialize();var DM_Masscast_Top3={params:null,translateV1ParamstoV2:function(g){var e={skinName:"name",trackingTag:"tracking_tag",bodyClickUrl:"redirect_url",topBannerLink:"redirect_url",bodyClickUrlThroughTag:"click_count_urls",topBannerLinkThroughTag:"click_count_urls",countingPixel:"display_count_urls",countingPixelAlt:"display_count_urls"};var f={};for(i in e){if(g[i]!=""){var h=e[i];if(i=="bodyClickUrl"){f.body_redirect_enabled=true}if(h.match(/urls/)){if(!f[h]){f[h]=[]}if($j.isArray(g[i])){f[h]=f[h].concat(g[i])}else{f[h].push(g[i])}}else{f[h]=g[i]}}}return f},onCodeReceived:function(b){this.setParams(b);this.build()},setParams:function(b){this.params=$j.isString(b)?(new Function("return "+b))():b},build:function(){log("Top3","Build",this.params);try{if(typeof this.params=="object"){var d=this;this.params=this.translateV1ParamstoV2(this.params);this.params.from_oas=true;PubSub.publish("masscast:loading_top3");$j.getJSON("/controller/Masscast?method=getSkin&method%3Aargs="+encodeURIComponent($j.toJSONString([this.params.name])),function(a){PubSub.publish("masscast:loaded_top3",a,d.params)})}}catch(c){log("Top3","Error while loading skin",c.message,"- skinData:",this.params)}},initialize:function(){PubSub.subscribe("masscast:position_Top3",this.onCodeReceived,this)}};DM_Masscast_Top3.initialize();