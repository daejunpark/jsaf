/*
 bookmark-2.1.0.js
 Copyright (c) 2013 Rakuten.Inc
 Date : 2013-04-05 15:50:17
*/
(function(f,g){if(f.jQuery!==g){jQuery.noConflict();var b=jQuery;b.RJS_Helpers&&b().RJS_Slideshow&&(new function(){var a=this;b.extend(a,{settings:{noready:[0,"Int","^[0-1]$"],maxitem:[4,"Int","^[1-9]$"],minitem:[1,"Int","^[1-9]$"],sid:["","Str","^[a-zA-Z0-9_\\-]{3,64}$"],pagespeed:[100,"Range","0,9999"],opacityspeed:[100,"Range","0,9999"],omitname:[38,"Range","0,100"],imagesize:["80x80","Str","^[1-9]{1}[0-9]{1,2}x[1-9]{1}[0-9]{1,2}"],autoslidetime:[2,"Range","1,99"],autoslideflag:["next","Str","^(next|prev)$"],
autoslide:[0,"Int","^[0-1]$"],autoresize:[0,"Int","^[0-1]$"],impvar:["","Str","^[a-zA-Z0-9_]{3,64}$"],impdisp:["","Str","^[a-zA-Z0-9_]{3,64}$"],impnodisp:["","Str","^[a-zA-Z0-9_]{3,64}$"],verticalmode:[0,"Int","^[1]$"],jsonurl:["","Str","^http(s?)+(:\\/\\/[a-zA-Z0-9_\\-\\.]+)(\\.rakuten\\.co\\.jp\\/)+([a-zA-Z0-9_&=\\?\\-\\.\\/]+)$"],ajaxtimer:[3,"Range","1,99"]},eobj:{config:b("#bookmarkConfig"),existItem:b("#bookmarkExistItemDisplay"),overMaxItem:b("#bookmarkOverMaxItemDisplay"),prototypeItem:b("#prototypeBookmarkItem"),
prevButton:b("#bookmarkPrevButton"),nextButton:b("#bookmarkNextButton"),loading:b("#bookmarkLoading"),altContents:b("#bookmarkAlteredContents"),itemsDisplay:b("#bookmarkItemsDisplay")},status:{error:!1,isTimeout:!1},props:{items:[],itemPrototype:{html:"",height:0,width:0,identifiers:{itemurl:["",/\#ITEMURL\#/g,""],imageele:['<img src="#ITEMIMGURL#" alt="#ITEMIMGALT#" title="#ITEMIMGTITLE#">',/\#ITEMIMGELE\#/g,""],imageurl:["",/\#ITEMIMGURL\#/g,""],imagealt:["",/\#ITEMIMGALT\#/g,""],imagetitle:["",
/\#ITEMIMGTITLE\#/g,""],itemname:["",/\#ITEMNAME\#/g,""],itemprice:["",/\#ITEMPRICE\#/g,""]}}},initialize:function(){a.loadSettings()?1==a.settings.noReady?a.begin():jQuery(document).ready(function(){a.begin()}):a.displayDefaultContents()},loadSettings:function(){a.settings=b.RJS_Helpers.readAttr(a.eobj.config,a.settings);if(""==a.settings.jsonurl||512<a.settings.jsonurl.length)return!1;a.settings.autoslidetime*=1E3;a.settings.ajaxtimer*=1E3;a.eobj.config.remove();return!0},begin:function(){a.getData();
a.status.error=!a.getPrototype()},getData:function(){function d(d){var f,e,c,h;if(a.status.isTimeout)return!1;clearTimeout(i);if(d.code===g||d.num===g)return a.displayDefaultContents(),!1;if("0"!=d.code)return 0>=d.num&&a.regImpressionCode(a.settings.impnodisp),a.displayDefaultContents(),!1;h=d.items.length;if(h<a.settings.minitem)return a.displayDefaultContents(a.settings.impnodisp),!1;f=a.settings.imagesize;for(e=h-1;0<=e;e--){c=d.items[e];c.itemname=b.RJS_Helpers.omitStr(c.itemname,a.settings.omitname,
"¡Ä");c.imageele="";c.imagealt=c.itemname;c.imagetitle=c.itemname;c.imageurl=""!=c.imageurl?b.RJS_Helpers.urlParameter(c.imageurl,{_ex:f}):c.imageurl64;if(""!=a.settings.sid)c.itemurl=b.RJS_Helpers.urlParameter(c.itemurl,{"s-id":a.settings.sid});c.itemprice=a.editItemprice(c.itemprice)}if(!b.browser.msie)for(e=h-1;0<=e;e--)d.items[e].itemname=d.items[e].itemname.split("").join(String.fromCharCode(8203));a.props.items=d.items;if(a.status.error)return a.displayDefaultContents(),!1;a.startSlideshow();
a.regImpressionCode(a.settings.impdisp);return!0}var i;a.status.isTimeout=!1;try{i=setTimeout(function(){a.status.isTimeout=!0;a.displayDefaultContents()},a.settings.ajaxtimer),b.ajax({url:a.settings.jsonurl,cache:!1,dataType:"jsonp",scriptCharset:"euc-jp",timeout:a.settings.ajaxtimer,success:function(a){d(a)},error:function(){a.displayDefaultContents();a.status.isTimeout=!0}})}catch(f){return a.displayDefaultContents(),!1}return!0},editItemprice:function(a){return""!=a&&a!==g?(""+a).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,
"$1,"):a},getPrototype:function(){var a=this.eobj.prototypeItem,b=this.props.itemPrototype;if(0==a.length)return!1;b.width=a.outerWidth();b.height=a.outerHeight();b.html=a.html();if(""==b.html)return!1;a.remove();return!0},startSlideshow:function(){a.eobj.existItem.show();a.eobj.itemsDisplay.RJS_Slideshow(a,{settings:a.settings,itemPrototype:a.props.itemPrototype,eobj:a.eobj,items:a.props.items,itemEvents:a.props.itemEvents,events:{afterFirstRender:a.afterFirstRender,beforeFirstRender:a.beforeFirstRender}})},
regImpressionCode:function(b){return f[a.settings.impvar]===g||""==b?"":f[a.settings.impvar]=b},displayDefaultContents:function(b){a.eobj.loading.remove();a.eobj.altContents.show();a.eobj.existItem.remove();b&&a.regImpressionCode(b)},afterFirstRender:function(a,b){b.props.items.length>a&&b.eobj.overMaxItem.show()},beforeFirstRender:function(a,b){b.eobj.loading.remove();b.eobj.itemsDisplay.show()}})}).initialize()}})(this);
