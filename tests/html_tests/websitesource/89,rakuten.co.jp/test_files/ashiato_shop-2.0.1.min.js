(function(k,j){if(k.jQuery!==j){jQuery.noConflict();var d=jQuery;d.RJS_Helpers&&(new function(){var a=this;d.extend(a,{settings:{noready:[0,"Int","^[0-1]$"],maxitem:[4,"Int","^[1-9]$"],minitem:[1,"Int","^[1-9]$"],rows:[3,"Int","^[1-9]$"],sid:["","Str","^[a-zA-Z0-9_\\-]{3,64}$"],omitname:[38,"Range","0,100"],autoresize:[0,"Int","^[0-1]$"],impvar:["","Str","^[a-zA-Z0-9_]{3,64}$"],impdisp:["","Str","^[a-zA-Z0-9_]{3,64}$"],impnodisp:["","Str","^[a-zA-Z0-9_]{3,64}$"],jsonurl:["","Str","^http(s?)+(:\\/\\/[a-zA-Z0-9_\\-\\.]+)(\\.rakuten\\.co\\.jp\\/)+([a-zA-Z0-9_&=\\?\\-\\.\\/]+)$"],
ajaxtimer:[3,"Range","1,99"]},eobj:{config:d("#ashiatoShopConfig"),existItem:d("#ashiatoShopExistItemDisplay"),overMaxItem:d("#ashiatoShopOverMaxItemDisplay"),prototypeItem:d("#prototypeAshiatoShopItem"),loading:d("#ashiatoShopLoading"),altContents:d("#ashiatoShopAlteredContents"),itemsDisplay:d("#ashiatoShopItemsDisplay")},status:{error:false,isTimeout:false,animation:false},props:{items:[],itemPrototype:{html:"",height:0,width:0,identifiers:{url:["",/\#SHOPURL\#/g,""],shopname:["",/\#SHOPNAME\#/g,
""]}}},pageConf:{maxAllowed:0,currLastElementIndex:0},initialize:function(){if(a.loadSettings())a.settings.noReady===1?a.begin():d(document).ready(function(){a.begin()});else a.displayDefaultContents()},loadSettings:function(){a.settings=d.RJS_Helpers.readAttr(a.eobj.config,a.settings);if(a.settings.jsonurl==""||a.settings.jsonurl.length>512)return false;a.settings.ajaxtimer*=1E3;a.settings.maxitem=Math.floor(a.settings.maxitem/a.settings.rows)*a.settings.rows;a.eobj.config.remove();return true},
begin:function(){a.getData();a.status.error=!a.getPrototype()},getData:function(){function c(b){var h,g,l,i,n="",e;if(a.status.isTimeout)return false;clearTimeout(f);if(b.code===j||b.num===j){a.displayDefaultContents();return false}if(b.code!="0"){if(b.code=="1"||b.code=="8")a.regImpressionCode(a.settings.impnodisp);a.displayDefaultContents();return false}g=b.shops.length;if(g<a.settings.minitem){a.displayDefaultContents(a.settings.impnodisp);return false}if(a.settings.autoresize!==1)g=Math.min(g,
a.settings.maxitem);for(e=g-1;e>=0;e--){h=b.shops[e];if(a.settings.sid!="")h.url=d.RJS_Helpers.urlParameter(h.url,{"s-id":a.settings.sid},false)}if(!d.browser.msie)for(e=g-1;e>=0;e--)b.shops[e].shopname=b.shops[e].shopname.split("").join(String.fromCharCode(8203));a.props.items=b.shops;if(a.status.error){a.displayDefaultContents();return false}b=a.props.itemPrototype.identifiers;n="";for(e=0;e<g;e++){l=a.props.itemPrototype.html;h=a.props.items[e];for(i in b)l=l.replace(b[i][1],h[i]!=j?b[i][0]+h[i]+
b[i][2]:"");n+=l}a.eobj.itemsDisplay.html(n);a.eobj.loading.remove();a.eobj.existItem.show();if(a.settings.autoresize===1){a.renderElements();d(k).resize(function(){a.renderElements()})}a.props.items.length>a.pageConf.currLastElementIndex&&a.eobj.overMaxItem.show();a.regImpressionCode(a.settings.impdisp);return true}var f;a.status.isTimeout=false;try{f=setTimeout(function(){a.status.isTimeout=true;a.displayDefaultContents()},a.settings.ajaxtimer);d.ajax({url:a.settings.jsonurl,cache:false,dataType:"jsonp",
scriptCharset:"euc-jp",timeout:a.settings.ajaxtimer,success:function(b){c(b)},error:function(){a.displayDefaultContents();a.status.isTimeout=true}})}catch(m){a.displayDefaultContents();return false}return true},getPrototype:function(){var c=a.eobj.prototypeItem,f=a.props.itemPrototype;if(c.length==0)return false;f.width=c.outerWidth();f.height=c.outerHeight();f.html=c.html();if(f.html=="")return false;c.remove();return true},renderElements:function(){if(!a.status.animation){var c=a.pageConf,f,m,b;
f=a.eobj.itemsDisplay.width();b=Math.floor(f/a.props.itemPrototype.width)*a.settings.rows;b<a.settings.maxitem&&(b=a.settings.maxitem);if(b!=c.maxAllowed){a.status.animation=true;m=a.eobj.itemsDisplay;f=c.maxAllowed;c.maxAllowed=b;c.currLastElementIndex+=c.maxAllowed-f;m.children(":lt("+c.currLastElementIndex+")").show();m.children(":gt("+(c.currLastElementIndex-1)+")").hide();a.status.animation=false}}},regImpressionCode:function(c){return k[a.settings.impvar]===j||c==""?"":k[a.settings.impvar]=
c},displayDefaultContents:function(c){a.eobj.loading.remove();a.eobj.altContents.show();a.eobj.existItem.remove();c&&a.regImpressionCode(c)}})}).initialize()}})(this);
