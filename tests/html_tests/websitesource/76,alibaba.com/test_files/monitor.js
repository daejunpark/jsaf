var globalImgServer="http://style.alibaba.com";location.protocol==="https:"&&(globalImgServer="https://ipaystyle.alibaba.com");;
(function(){var e=function(){this.param=null,this.config={rate:.1,filterRegular:"googlebot|bingbot|yahoo|baidu",excludedBrowserRegular:"MSIE 5|MSIE 6|MSIE 7",receiverUrl:"stat.gmonitor.aliimg.com/stat.htm",defaultResponseStartTime:150},this.context={isSupportHtml5Timing:!1,responseStartTimestamp:0,documentCompleteTimestamp:0,fullyLoadedTimestamp:0,isValue:undefined},this.timing=null};e.prototype={init:function(e){this.config=e||this.config;var t=this;this.context.isSupportHtml5Timing=t._markResponseStart();if(/MSIE\s6|MSIE\s7|MSIE\s8/i.test(navigator.userAgent)){document.write('<script id="__page_timing_document_complete" defer src="javascript:void(0);"></script>');var n=document.getElementById("__page_timing_document_complete");n.onreadystatechange=function(){if(this.readyState==="complete"){t._markDocumentComplete();if(!t._validate())return;t.context.fullyLoadedTimestamp&&t._send()}}}else document.addEventListener?document.addEventListener("DOMContentLoaded",function(){t._markDocumentComplete();if(!t._validate())return;t.context.fullyLoadedTimestamp&&t._send()},!1):document.attachEvent&&document.attachEvent("onDOMContentLoaded",function(){t._markDocumentComplete();if(!t._validate())return;t.context.fullyLoadedTimestamp&&t._send()});document.addEventListener?window.addEventListener("load",function(){t._markFullyLoaded();if(!t._validate())return;t.context.documentCompleteTimestamp&&t._send()},!1):document.attachEvent&&window.attachEvent("onload",function(){t._markFullyLoaded();if(!t._validate())return;t.context.documentCompleteTimestamp&&t._send()})},_markResponseStart:function(){if(!window.performance||!window.performance.timing)return!1;this.timing=window.performance.timing;var e=this.timing.responseStart;return e?(this.context.responseStartTimestamp=e,!0):!1},_markDocumentComplete:function(){return this.context.documentCompleteTimestamp=(new Date).getTime(),!0},_markFullyLoaded:function(){return this.context.fullyLoadedTimestamp=(new Date).getTime(),!0},_send:function(e){var t={rrt:this._getRRTiming(),dns:this._getDNSTiming(),cnt:this._getConnectTiming(),srt:this._getStartRenderTiming(),fst:this._getFirstPageTiming(),dct:this._getDocumentCompleteTiming(),flt:this._getFullyLoadedTiming(),flv:this._getFlashVersion(),url:this._getPageUrl(),pt:e||this._getPageType()},n=document.createElement("div"),r="page-timing-"+(new Date).getTime();n.innerHTML='<iframe width="0" height="0" id="'+r+'"name="'+r+'" frameBorder="0" style="top: -100%; position: absolute;"></iframe>',document.body.appendChild(n);var i=document.createElement("form");i.style.display="none",i.target=r,i.method="POST",i.action=("https:"===document.location.protocol?"https://":"http://")+(this.config.receiverUrl||errorPostAction);for(var s in t){var o=document.createElement("input");o.type="hidden",o.name=s,o.value=t[s],i.appendChild(o)}var u=document.createElement("input");u.type="submit",u.value="",i.appendChild(u),document.body.appendChild(i),i.submit()},_validate:function(){if(this.context.isValid!==undefined)return this.context.isValid;if(!window.PAGE_TIMING||window.PAGE_TIMING.sent||!this._filter())return this.context.isValid=!1,!1;this.param=window.PAGE_TIMING,window.PAGE_TIMING.sent=!0;var e=this.param.rate||this.config.rate;return this._lottery(e)?(this.context.isValid=!0,!0):(this.context.isValid=!1,!1)},_filter:function(){var e=navigator.userAgent.toLowerCase();return(new RegExp(this.config.filterRegular)).test(e)?!1:(new RegExp(this.config.excludedBrowserRegular)).test(e)?!1:!0},_lottery:function(e){return Math.random()>parseFloat(e)?!1:!0},_getResponseStartTiming:function(){return this.context.isSupportHtml5Timing?this.context.responseStartTimestamp:this.param.startRender-this.config.defaultResponseStartTime},_getRRTiming:function(){return this.context.isSupportHtml5Timing?this.timing.responseStart-this.timing.requestStart:""},_getDNSTiming:function(){return this.context.isSupportHtml5Timing?this.timing.domainLookupEnd-this.timing.domainLookupStart:""},_getConnectTiming:function(){return this.context.isSupportHtml5Timing?this.timing.connectEnd-this.timing.connectStart:""},_getStartRenderTiming:function(){if(!this.context.isSupportHtml5Timing)return"";var e=this.param.startRender;if(e>0){var t=e-this.context.responseStartTimestamp;return t}return""},_getFirstPageTiming:function(){var e=this.param.firstScreen;if(e>0){var t=e-this._getResponseStartTiming();return t}return""},_getDocumentCompleteTiming:function(){var e=this.context.documentCompleteTimestamp;if(e>0){var t=e-this._getResponseStartTiming();return t}return""},_getFullyLoadedTiming:function(){var e=this.context.fullyLoadedTimestamp;if(e>0){var t=e-this._getResponseStartTiming();return t}return""},_getPageType:function(){return this.param.pageType?this.param.pageType:""},_getFlashVersion:function(){var e,t="ShockwaveFlash";if(navigator.plugins&&navigator.mimeTypes.length)e=(navigator.plugins["Shockwave Flash"]||0).description;else if(window.ActiveXObject)try{e=(new ActiveXObject(t+"."+t)).GetVariable("$version")}catch(n){}if(!e)return"";var r=e.match(/(\d)+/g).splice(0,3);return r?(r[2]="rc"+r[2],r.join(".")):""},_getPageUrl:function(){return window.location.href}},(new e).init()})();;
