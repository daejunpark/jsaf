var clip,spinner,$shrinkLink,$shrinkButton,$copyButton,$spinner,$shrinkButton;$(document).ready(function(){clip=null;if(AdFly.awesomeBrowser()&&ZeroClipboard.detectFlashSupport()){clip=new ZeroClipboard();clip.setHandCursor(true);clip.glue([$('#shrink_copy')[0]]);clip.on('complete',function(client,args){onCopy(client,args);});$('#shrink_copy_wrapper').remove();}
spinner=AdFly.createSpinner('loading_spinner');$shrinkLink=$('#shrink_link');$shrinkButton=$('#shrink_submit');$copyButton=$('#shrink_copy');$spinner=$('#loading_spinner');if('#bmlLogin'==window.location.hash&&bmlUrl){window.location='/login?bmlUrl='+ encodeURIComponent(bmlUrl);}
$('#shrink_link').placeholder();$('#shrink_submit').click(doShrink);$('#shrink_another').click(resetShrinker);});function onCopy(client,text){resetShrinker();};function resetShrinker(){$shrinkLink.val('');$shrinkLink.removeAttr('disabled');$copyButton.fadeOut(500,function(){$shrinkButton.fadeIn(500);});}
function doShrink(){function errorOccured(){alert('There was an error while processing your URL. Please make sure the URL you entered is valid and not an adf.ly link.');}
$.ajax({type:'post',url:'/shortener/shorten',data:{_user_id:AdFly.API_ANONYMOUS.USER_ID,_api_key:AdFly.API_ANONYMOUS.API_KEY,url:$.trim($shrinkLink.val())},beforeSend:function(jqXHR,settings){$shrinkLink.val(' ');$shrinkButton.hide();$spinner.show();},error:function(jqXHR,textStatus,errorThrown){errorOccured();},success:function(data,textStatus,jqXHR){if(typeof(data)!='object'||data.errors.length!=0||data.shorts.length!=1){var error=[];if(data.errors.length!=0){for(var i=0;i<data.errors.length;i++){error.push(data.errors[i].message);}
alert(error.join('\n'));}else{errorOccured();}
$shrinkLink.val('');$shrinkLink.removeAttr('disabled');$shrinkButton.show();}else{$shrinkLink.val(data.shorts[0].short_url);if(AdFly.awesomeBrowser()&&ZeroClipboard.detectFlashSupport()){$copyButton.show();clip.setText(data.shorts[0].short_url);clip.setHandCursor(true);}else{$copyButton.hide();$shrinkButton.show();$shrinkLink.removeAttr('disabled');}}
$spinner.hide();}});return false;};